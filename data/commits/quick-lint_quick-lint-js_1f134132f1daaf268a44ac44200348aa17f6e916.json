{
  "metadata": {
    "collection_date": "2026-02-03T20:04:52.471162",
    "repository": "https://github.com/quick-lint/quick-lint-js",
    "repository_name": "quick-lint/quick-lint-js"
  },
  "commit_info": {
    "old_sha": "014b7ef64b4ce4ca3eaddb5e3b8180a8acbcd853",
    "new_sha": "1f134132f1daaf268a44ac44200348aa17f6e916",
    "commit_message": [
      "perf(fe): optimize keyword hash table\n\nImprove the keyword hash table's hash function based on advice from\nyoutube.com/@bunnyboss3707. This new hash function shrinks the table\nfrom 512 entries to 256 entries, reducing dcache pressure and binary\nsize. The new hash function is also computationally simpler because it\nembeds the index modulo operation.\n\nOverall, the new hash table improves jQuery parse performance by about\n0.7% on my Apple M1 machine:\n\n    Benchmark                                     Time             CPU      Time Old      Time New       CPU Old       CPU New\n    --------------------------------------------------------------------------------------------------------------------------\n    benchmark_parse_file_pvalue                 0.0000          0.0000      U Test, Repetitions: 20 vs 20\n    benchmark_parse_file_mean                  -0.0071         -0.0069       1255163       1246265       1254606       1245989\n    benchmark_parse_file_median                -0.0068         -0.0066       1254159       1245689       1253818       1245495\n    benchmark_parse_file_stddev                -0.2331         -0.1686          3228          2475          2762          2296\n    benchmark_parse_file_cv                    -0.2277         -0.1628             0             0             0             0\n    OVERALL_GEOMEAN                            -0.0071         -0.0069             0             0             0             0\n\nOverall, the new hash table hurts jQuery parse performance by about\n0.3% on my Linux 5950X machine:\n\n    Benchmark                                     Time             CPU      Time Old      Time New       CPU Old       CPU New\n    --------------------------------------------------------------------------------------------------------------------------\n    benchmark_parse_file_pvalue                 0.3648          0.3235      U Test, Repetitions: 20 vs 20\n    benchmark_parse_file_mean                  +0.0035         +0.0035       1730709       1736720       1730648       1736663\n    benchmark_parse_file_median                +0.0004         +0.0004       1732678       1733331       1732578       1733257\n    benchmark_parse_file_stddev                +0.0077         +0.0083          9717          9792          9706          9787\n    benchmark_parse_file_cv                    +0.0042         +0.0048             0             0             0             0\n    OVERALL_GEOMEAN                            +0.0035         +0.0035             0             0             0             0\n\nThe new hash function should be much faster with WebAssembly (because\nWebAssembly lacks native 128-bit multiply results), but I did not\nbenchmark."
    ],
    "commit_date": "2023-12-23T04:29:57+00:00",
    "patch": [
      "--- src/quick-lint-js/fe/keyword-lexer.h\n@@ -13,7 +13,7 @@ namespace quick_lint_js {\n struct Keyword_Lexer {\n   using Selection_Type = std::uint32_t;\n   using Hash_Type = std::uint32_t;\n-  using Seed_Type = std::uint64_t;\n+  using Seed_Type = std::uint32_t;\n \n   static constexpr int padding_size = 17;\n \n@@ -71,20 +71,21 @@ struct Keyword_Lexer {\n #endif\n \n   // Step 2 of the hash function for Lexer::identifier_token_type().\n-  static Hash_Type mix(Selection_Type selection, Seed_Type seed) {\n+  //\n+  // The table's size is (1 << table_size_shift).\n+  //\n+  // This function reduces the hash into an index into the hash table. In other\n+  // words, this function returns a number between 0 (inclusive) and\n+  // (1 << table_size_shift) (exclusive).\n+  static Hash_Type mix_and_reduce(Selection_Type selection, Seed_Type seed,\n+                                  Hash_Type table_size_shift) {\n     // This hash function executes quickly, but might produce a lot of\n     // collisions. Collisions are fine, though; collisions just slow down table\n     // generation, not run-time.\n-\n-    // Pierre L\u2019Ecuyer. 1999. Tables of linear congruential generators of\n-    // different sizes and good lattice structure. Mathematics of Computation of\n-    // the American Mathematical Society 68, 225 (1999), 249\u2013260.\n     //\n-    // https://www.ams.org/journals/mcom/1999-68-225/S0025-5718-99-00996-5/S0025-5718-99-00996-5.pdf\n-    std::uint64_t magic = 4292484099903637661ULL;\n-\n-    std::uint64_t x = static_cast<std::uint64_t>(selection) ^ seed;\n-    return static_cast<std::uint32_t>(multiply_u64_get_top_64(x, magic));\n+    // This hash function was suggested by youtube.com/@bunnyboss3707:\n+    // https://www.youtube.com/watch?v=DMQ_HcNSOAI&lc=UgxPDeWYyiAdMsUCV8V4AaABAg\n+    return (selection * seed) >> (32 - table_size_shift);\n   }\n \n   // Compare two strings, 'a' and 'b', each with size 'size'.\n--- src/quick-lint-js/fe/lex-keyword-generated.cpp\n@@ -14,10 +14,11 @@\n \n namespace quick_lint_js {\n namespace {\n-constexpr std::size_t hash_table_size = 512LLU;\n+constexpr std::size_t hash_table_size = 256LLU;\n+constexpr std::size_t hash_table_size_shift = 8LLU;\n constexpr std::size_t string_table_size = 454LLU;\n \n-constexpr Keyword_Lexer::Seed_Type hash_seed = 2166215926LLU;\n+constexpr Keyword_Lexer::Seed_Type hash_seed = 2554672LLU;\n \n struct Entry {\n   std::uint16_t key_index;  // Index into tables::string_table.\n@@ -40,301 +41,144 @@ constexpr Tables_Type tables = {\n             {0, 0, Token_Type::identifier},\n             {0, 0, Token_Type::identifier},\n             {0, 0, Token_Type::identifier},\n-            {61, 4, Token_Type::kw_this},\n-            {0, 0, Token_Type::identifier},\n-            {0, 0, Token_Type::identifier},\n-            {0, 0, Token_Type::identifier},\n-            {88, 6, Token_Type::kw_static},\n-            {0, 0, Token_Type::identifier},\n-            {0, 0, Token_Type::identifier},\n-            {0, 0, Token_Type::identifier},\n+            {301, 7, Token_Type::kw_extends},\n             {0, 0, Token_Type::identifier},\n             {0, 0, Token_Type::identifier},\n             {0, 0, Token_Type::identifier},\n             {0, 0, Token_Type::identifier},\n             {0, 0, Token_Type::identifier},\n             {0, 0, Token_Type::identifier},\n-            {112, 7, Token_Type::kw_require},\n             {253, 10, Token_Type::kw_implements},\n-            {263, 2, Token_Type::kw_if},\n-            {335, 7, Token_Type::kw_declare},\n             {0, 0, Token_Type::identifier},\n-            {142, 7, Token_Type::kw_private},\n+            {314, 4, Token_Type::kw_enum},\n             {0, 0, Token_Type::identifier},\n             {0, 0, Token_Type::identifier},\n             {0, 0, Token_Type::identifier},\n-            {214, 9, Token_Type::kw_intrinsic},\n             {406, 5, Token_Type::kw_async},\n             {0, 0, Token_Type::identifier},\n             {0, 0, Token_Type::identifier},\n-            {401, 5, Token_Type::kw_await},\n-            {0, 0, Token_Type::identifier},\n-            {0, 0, Token_Type::identifier},\n-            {0, 0, Token_Type::identifier},\n-            {0, 0, Token_Type::identifier},\n-            {0, 0, Token_Type::identifier},\n-            {318, 4, Token_Type::kw_else},\n-            {0, 0, Token_Type::identifier},\n-            {0, 0, Token_Type::identifier},\n-            {0, 0, Token_Type::identifier},\n-            {301, 7, Token_Type::kw_extends},\n-            {0, 0, Token_Type::identifier},\n-            {0, 0, Token_Type::identifier},\n-            {0, 0, Token_Type::identifier},\n-            {0, 0, Token_Type::identifier},\n-            {0, 0, Token_Type::identifier},\n-            {0, 0, Token_Type::identifier},\n-            {0, 0, Token_Type::identifier},\n-            {0, 0, Token_Type::identifier},\n-            {0, 0, Token_Type::identifier},\n-            {0, 0, Token_Type::identifier},\n-            {71, 6, Token_Type::kw_switch},\n-            {0, 0, Token_Type::identifier},\n-            {14, 4, Token_Type::kw_void},\n-            {0, 0, Token_Type::identifier},\n-            {0, 0, Token_Type::identifier},\n-            {0, 0, Token_Type::identifier},\n-            {0, 0, Token_Type::identifier},\n-            {0, 0, Token_Type::identifier},\n-            {0, 0, Token_Type::identifier},\n-            {0, 0, Token_Type::identifier},\n-            {429, 8, Token_Type::kw_abstract},\n-            {167, 6, Token_Type::kw_object},\n-            {0, 0, Token_Type::identifier},\n-            {0, 0, Token_Type::identifier},\n-            {0, 0, Token_Type::identifier},\n-            {34, 9, Token_Type::kw_undefined},\n-            {127, 6, Token_Type::kw_public},\n-            {0, 0, Token_Type::identifier},\n-            {149, 7, Token_Type::kw_package},\n-            {0, 0, Token_Type::identifier},\n-            {358, 5, Token_Type::kw_const},\n             {0, 0, Token_Type::identifier},\n             {0, 0, Token_Type::identifier},\n             {0, 0, Token_Type::identifier},\n             {0, 0, Token_Type::identifier},\n             {156, 8, Token_Type::kw_override},\n             {0, 0, Token_Type::identifier},\n-            {0, 0, Token_Type::identifier},\n-            {0, 0, Token_Type::identifier},\n-            {0, 0, Token_Type::identifier},\n-            {0, 0, Token_Type::identifier},\n-            {0, 0, Token_Type::identifier},\n-            {0, 0, Token_Type::identifier},\n-            {82, 6, Token_Type::kw_string},\n-            {0, 0, Token_Type::identifier},\n-            {0, 0, Token_Type::identifier},\n-            {0, 0, Token_Type::identifier},\n-            {0, 0, Token_Type::identifier},\n-            {0, 0, Token_Type::identifier},\n-            {0, 0, Token_Type::identifier},\n-            {308, 6, Token_Type::kw_export},\n-            {0, 0, Token_Type::identifier},\n-            {0, 0, Token_Type::identifier},\n-            {0, 0, Token_Type::identifier},\n-            {0, 0, Token_Type::identifier},\n-            {0, 0, Token_Type::identifier},\n-            {0, 0, Token_Type::identifier},\n-            {0, 0, Token_Type::identifier},\n-            {0, 0, Token_Type::identifier},\n-            {0, 0, Token_Type::identifier},\n-            {0, 0, Token_Type::identifier},\n-            {0, 0, Token_Type::identifier},\n-            {374, 5, Token_Type::kw_catch},\n-            {0, 0, Token_Type::identifier},\n-            {0, 0, Token_Type::identifier},\n-            {0, 0, Token_Type::identifier},\n-            {0, 0, Token_Type::identifier},\n-            {0, 0, Token_Type::identifier},\n-            {0, 0, Token_Type::identifier},\n-            {0, 0, Token_Type::identifier},\n-            {0, 0, Token_Type::identifier},\n-            {0, 0, Token_Type::identifier},\n-            {0, 0, Token_Type::identifier},\n-            {0, 0, Token_Type::identifier},\n-            {0, 0, Token_Type::identifier},\n-            {0, 0, Token_Type::identifier},\n-            {388, 7, Token_Type::kw_boolean},\n-            {0, 0, Token_Type::identifier},\n-            {0, 0, Token_Type::identifier},\n-            {0, 0, Token_Type::identifier},\n-            {0, 0, Token_Type::identifier},\n-            {0, 0, Token_Type::identifier},\n-            {0, 0, Token_Type::identifier},\n-            {0, 0, Token_Type::identifier},\n-            {0, 0, Token_Type::identifier},\n-            {0, 0, Token_Type::identifier},\n-            {0, 0, Token_Type::identifier},\n-            {0, 0, Token_Type::identifier},\n-            {0, 0, Token_Type::identifier},\n-            {0, 0, Token_Type::identifier},\n-            {0, 0, Token_Type::identifier},\n-            {52, 4, Token_Type::kw_true},\n-            {0, 0, Token_Type::identifier},\n-            {0, 0, Token_Type::identifier},\n-            {0, 0, Token_Type::identifier},\n-            {0, 0, Token_Type::identifier},\n-            {0, 0, Token_Type::identifier},\n-            {0, 0, Token_Type::identifier},\n-            {0, 0, Token_Type::identifier},\n+            {179, 4, Token_Type::kw_null},\n             {119, 8, Token_Type::kw_readonly},\n             {0, 0, Token_Type::identifier},\n             {0, 0, Token_Type::identifier},\n             {0, 0, Token_Type::identifier},\n             {0, 0, Token_Type::identifier},\n-            {191, 9, Token_Type::kw_namespace},\n-            {0, 0, Token_Type::identifier},\n-            {0, 0, Token_Type::identifier},\n             {0, 0, Token_Type::identifier},\n             {0, 0, Token_Type::identifier},\n-            {0, 0, Token_Type::identifier},\n-            {0, 0, Token_Type::identifier},\n-            {395, 6, Token_Type::kw_bigint},\n-            {0, 0, Token_Type::identifier},\n-            {0, 0, Token_Type::identifier},\n-            {0, 0, Token_Type::identifier},\n-            {0, 0, Token_Type::identifier},\n-            {0, 0, Token_Type::identifier},\n-            {0, 0, Token_Type::identifier},\n-            {286, 3, Token_Type::kw_for},\n-            {358, 11, Token_Type::kw_constructor},\n-            {0, 0, Token_Type::identifier},\n+            {56, 5, Token_Type::kw_throw},\n             {0, 0, Token_Type::identifier},\n             {0, 0, Token_Type::identifier},\n             {0, 0, Token_Type::identifier},\n             {0, 0, Token_Type::identifier},\n             {0, 0, Token_Type::identifier},\n             {0, 0, Token_Type::identifier},\n-            {322, 6, Token_Type::kw_delete},\n             {328, 7, Token_Type::kw_default},\n+            {63, 2, Token_Type::kw_is},\n+            {52, 4, Token_Type::kw_true},\n             {0, 0, Token_Type::identifier},\n-            {97, 9, Token_Type::kw_satisfies},\n-            {0, 0, Token_Type::identifier},\n-            {0, 0, Token_Type::identifier},\n-            {0, 0, Token_Type::identifier},\n-            {0, 0, Token_Type::identifier},\n-            {0, 0, Token_Type::identifier},\n-            {0, 0, Token_Type::identifier},\n-            {0, 0, Token_Type::identifier},\n-            {209, 5, Token_Type::kw_keyof},\n-            {274, 8, Token_Type::kw_function},\n-            {0, 0, Token_Type::identifier},\n-            {0, 0, Token_Type::identifier},\n-            {0, 0, Token_Type::identifier},\n-            {0, 0, Token_Type::identifier},\n-            {0, 0, Token_Type::identifier},\n-            {0, 0, Token_Type::identifier},\n-            {0, 0, Token_Type::identifier},\n-            {0, 0, Token_Type::identifier},\n-            {0, 0, Token_Type::identifier},\n-            {56, 5, Token_Type::kw_throw},\n-            {0, 0, Token_Type::identifier},\n-            {0, 0, Token_Type::identifier},\n-            {0, 0, Token_Type::identifier},\n-            {0, 0, Token_Type::identifier},\n+            {411, 6, Token_Type::kw_assert},\n             {0, 0, Token_Type::identifier},\n+            {142, 7, Token_Type::kw_private},\n             {0, 0, Token_Type::identifier},\n             {0, 0, Token_Type::identifier},\n             {0, 0, Token_Type::identifier},\n+            {322, 6, Token_Type::kw_delete},\n             {0, 0, Token_Type::identifier},\n             {0, 0, Token_Type::identifier},\n+            {21, 7, Token_Type::kw_unknown},\n             {0, 0, Token_Type::identifier},\n             {0, 0, Token_Type::identifier},\n             {0, 0, Token_Type::identifier},\n-            {232, 10, Token_Type::kw_instanceof},\n             {0, 0, Token_Type::identifier},\n             {0, 0, Token_Type::identifier},\n-            {164, 3, Token_Type::kw_out},\n+            {335, 7, Token_Type::kw_declare},\n             {0, 0, Token_Type::identifier},\n+            {112, 7, Token_Type::kw_require},\n             {0, 0, Token_Type::identifier},\n+            {358, 11, Token_Type::kw_constructor},\n+            {286, 3, Token_Type::kw_for},\n             {0, 0, Token_Type::identifier},\n             {0, 0, Token_Type::identifier},\n             {0, 0, Token_Type::identifier},\n+            {247, 6, Token_Type::kw_import},\n             {0, 0, Token_Type::identifier},\n+            {133, 9, Token_Type::kw_protected},\n+            {318, 4, Token_Type::kw_else},\n             {0, 0, Token_Type::identifier},\n+            {242, 5, Token_Type::kw_infer},\n+            {271, 3, Token_Type::kw_get},\n+            {206, 3, Token_Type::kw_let},\n+            {94, 3, Token_Type::kw_set},\n             {0, 0, Token_Type::identifier},\n-            {49, 3, Token_Type::kw_try},\n+            {371, 2, Token_Type::kw_as},\n             {0, 0, Token_Type::identifier},\n             {0, 0, Token_Type::identifier},\n             {0, 0, Token_Type::identifier},\n+            {88, 6, Token_Type::kw_static},\n+            {43, 4, Token_Type::kw_type},\n             {0, 0, Token_Type::identifier},\n             {0, 0, Token_Type::identifier},\n             {0, 0, Token_Type::identifier},\n             {0, 0, Token_Type::identifier},\n             {0, 0, Token_Type::identifier},\n             {0, 0, Token_Type::identifier},\n             {0, 0, Token_Type::identifier},\n+            {173, 6, Token_Type::kw_number},\n+            {77, 5, Token_Type::kw_super},\n             {0, 0, Token_Type::identifier},\n             {0, 0, Token_Type::identifier},\n             {0, 0, Token_Type::identifier},\n+            {5, 4, Token_Type::kw_with},\n             {0, 0, Token_Type::identifier},\n             {0, 0, Token_Type::identifier},\n             {0, 0, Token_Type::identifier},\n             {18, 3, Token_Type::kw_var},\n             {0, 0, Token_Type::identifier},\n-            {314, 4, Token_Type::kw_enum},\n-            {0, 0, Token_Type::identifier},\n-            {0, 0, Token_Type::identifier},\n-            {47, 2, Token_Type::kw_of},\n-            {0, 0, Token_Type::identifier},\n-            {0, 0, Token_Type::identifier},\n-            {0, 0, Token_Type::identifier},\n-            {0, 0, Token_Type::identifier},\n-            {0, 0, Token_Type::identifier},\n-            {0, 0, Token_Type::identifier},\n-            {0, 0, Token_Type::identifier},\n-            {0, 0, Token_Type::identifier},\n-            {0, 0, Token_Type::identifier},\n-            {0, 0, Token_Type::identifier},\n-            {0, 0, Token_Type::identifier},\n-            {0, 0, Token_Type::identifier},\n-            {0, 0, Token_Type::identifier},\n-            {0, 0, Token_Type::identifier},\n-            {0, 0, Token_Type::identifier},\n-            {0, 0, Token_Type::identifier},\n-            {0, 0, Token_Type::identifier},\n-            {0, 0, Token_Type::identifier},\n-            {0, 0, Token_Type::identifier},\n-            {0, 0, Token_Type::identifier},\n-            {0, 0, Token_Type::identifier},\n-            {0, 0, Token_Type::identifier},\n-            {0, 0, Token_Type::identifier},\n-            {0, 0, Token_Type::identifier},\n-            {0, 0, Token_Type::identifier},\n-            {0, 0, Token_Type::identifier},\n-            {0, 0, Token_Type::identifier},\n-            {0, 0, Token_Type::identifier},\n-            {0, 0, Token_Type::identifier},\n-            {0, 0, Token_Type::identifier},\n-            {0, 0, Token_Type::identifier},\n-            {0, 0, Token_Type::identifier},\n+            {214, 9, Token_Type::kw_intrinsic},\n             {0, 0, Token_Type::identifier},\n             {0, 0, Token_Type::identifier},\n             {0, 0, Token_Type::identifier},\n+            {274, 8, Token_Type::kw_function},\n+            {421, 8, Token_Type::kw_accessor},\n             {0, 0, Token_Type::identifier},\n+            {418, 3, Token_Type::kw_any},\n+            {164, 3, Token_Type::kw_out},\n             {0, 0, Token_Type::identifier},\n             {0, 0, Token_Type::identifier},\n             {0, 0, Token_Type::identifier},\n             {0, 0, Token_Type::identifier},\n             {0, 0, Token_Type::identifier},\n             {0, 0, Token_Type::identifier},\n             {0, 0, Token_Type::identifier},\n+            {39, 2, Token_Type::kw_in},\n+            {374, 5, Token_Type::kw_catch},\n+            {127, 6, Token_Type::kw_public},\n             {0, 0, Token_Type::identifier},\n             {0, 0, Token_Type::identifier},\n+            {209, 5, Token_Type::kw_keyof},\n             {0, 0, Token_Type::identifier},\n             {0, 0, Token_Type::identifier},\n+            {61, 4, Token_Type::kw_this},\n             {0, 0, Token_Type::identifier},\n+            {97, 9, Token_Type::kw_satisfies},\n             {0, 0, Token_Type::identifier},\n             {0, 0, Token_Type::identifier},\n             {0, 0, Token_Type::identifier},\n             {0, 0, Token_Type::identifier},\n             {0, 0, Token_Type::identifier},\n             {0, 0, Token_Type::identifier},\n             {0, 0, Token_Type::identifier},\n+            {43, 6, Token_Type::kw_typeof},\n             {0, 0, Token_Type::identifier},\n-            {63, 2, Token_Type::kw_is},\n             {0, 0, Token_Type::identifier},\n             {0, 0, Token_Type::identifier},\n+            {358, 5, Token_Type::kw_const},\n             {0, 0, Token_Type::identifier},\n             {28, 6, Token_Type::kw_unique},\n             {0, 0, Token_Type::identifier},\n@@ -343,57 +187,29 @@ constexpr Tables_Type tables = {\n             {0, 0, Token_Type::identifier},\n             {0, 0, Token_Type::identifier},\n             {0, 0, Token_Type::identifier},\n-            {411, 6, Token_Type::kw_assert},\n-            {0, 0, Token_Type::identifier},\n-            {179, 4, Token_Type::kw_null},\n-            {0, 0, Token_Type::identifier},\n-            {0, 0, Token_Type::identifier},\n-            {0, 0, Token_Type::identifier},\n-            {0, 0, Token_Type::identifier},\n-            {0, 0, Token_Type::identifier},\n-            {0, 0, Token_Type::identifier},\n-            {0, 0, Token_Type::identifier},\n-            {0, 0, Token_Type::identifier},\n-            {0, 0, Token_Type::identifier},\n-            {0, 0, Token_Type::identifier},\n-            {0, 0, Token_Type::identifier},\n-            {0, 0, Token_Type::identifier},\n-            {0, 0, Token_Type::identifier},\n-            {0, 0, Token_Type::identifier},\n-            {0, 0, Token_Type::identifier},\n-            {0, 0, Token_Type::identifier},\n-            {5, 4, Token_Type::kw_with},\n-            {0, 0, Token_Type::identifier},\n-            {0, 0, Token_Type::identifier},\n-            {0, 0, Token_Type::identifier},\n-            {0, 0, Token_Type::identifier},\n-            {0, 0, Token_Type::identifier},\n-            {0, 0, Token_Type::identifier},\n-            {0, 0, Token_Type::identifier},\n-            {0, 0, Token_Type::identifier},\n-            {0, 0, Token_Type::identifier},\n-            {0, 0, Token_Type::identifier},\n-            {0, 0, Token_Type::identifier},\n-            {0, 0, Token_Type::identifier},\n             {0, 0, Token_Type::identifier},\n             {0, 0, Token_Type::identifier},\n             {0, 0, Token_Type::identifier},\n             {0, 0, Token_Type::identifier},\n             {0, 0, Token_Type::identifier},\n+            {379, 4, Token_Type::kw_case},\n+            {296, 5, Token_Type::kw_false},\n             {0, 0, Token_Type::identifier},\n             {0, 0, Token_Type::identifier},\n             {0, 0, Token_Type::identifier},\n-            {289, 7, Token_Type::kw_finally},\n             {0, 0, Token_Type::identifier},\n             {0, 0, Token_Type::identifier},\n             {0, 0, Token_Type::identifier},\n+            {47, 2, Token_Type::kw_of},\n             {0, 0, Token_Type::identifier},\n             {0, 0, Token_Type::identifier},\n             {0, 0, Token_Type::identifier},\n             {0, 0, Token_Type::identifier},\n+            {383, 5, Token_Type::kw_break},\n+            {65, 6, Token_Type::kw_symbol},\n             {0, 0, Token_Type::identifier},\n             {0, 0, Token_Type::identifier},\n-            {247, 6, Token_Type::kw_import},\n+            {34, 9, Token_Type::kw_undefined},\n             {0, 0, Token_Type::identifier},\n             {0, 0, Token_Type::identifier},\n             {0, 0, Token_Type::identifier},\n@@ -402,40 +218,26 @@ constexpr Tables_Type tables = {\n             {0, 0, Token_Type::identifier},\n             {350, 8, Token_Type::kw_continue},\n             {0, 0, Token_Type::identifier},\n-            {0, 0, Token_Type::identifier},\n-            {0, 0, Token_Type::identifier},\n-            {0, 0, Token_Type::identifier},\n-            {296, 5, Token_Type::kw_false},\n-            {379, 4, Token_Type::kw_case},\n-            {0, 0, Token_Type::identifier},\n-            {0, 0, Token_Type::identifier},\n-            {0, 0, Token_Type::identifier},\n-            {0, 0, Token_Type::identifier},\n-            {0, 0, Token_Type::identifier},\n-            {0, 0, Token_Type::identifier},\n-            {0, 0, Token_Type::identifier},\n-            {0, 0, Token_Type::identifier},\n-            {0, 0, Token_Type::identifier},\n-            {0, 0, Token_Type::identifier},\n-            {0, 0, Token_Type::identifier},\n-            {0, 0, Token_Type::identifier},\n-            {0, 0, Token_Type::identifier},\n-            {0, 0, Token_Type::identifier},\n+            {289, 7, Token_Type::kw_finally},\n             {0, 0, Token_Type::identifier},\n             {0, 0, Token_Type::identifier},\n             {0, 0, Token_Type::identifier},\n             {0, 0, Token_Type::identifier},\n             {0, 0, Token_Type::identifier},\n+            {395, 6, Token_Type::kw_bigint},\n             {0, 0, Token_Type::identifier},\n             {0, 0, Token_Type::identifier},\n             {0, 0, Token_Type::identifier},\n+            {263, 2, Token_Type::kw_if},\n+            {14, 4, Token_Type::kw_void},\n             {0, 0, Token_Type::identifier},\n             {0, 0, Token_Type::identifier},\n             {0, 0, Token_Type::identifier},\n+            {388, 7, Token_Type::kw_boolean},\n             {0, 0, Token_Type::identifier},\n+            {282, 4, Token_Type::kw_from},\n             {0, 0, Token_Type::identifier},\n-            {65, 6, Token_Type::kw_symbol},\n-            {200, 6, Token_Type::kw_module},\n+            {0, 5, Token_Type::kw_yield},\n             {0, 0, Token_Type::identifier},\n             {0, 0, Token_Type::identifier},\n             {0, 0, Token_Type::identifier},\n@@ -444,111 +246,54 @@ constexpr Tables_Type tables = {\n             {0, 0, Token_Type::identifier},\n             {0, 0, Token_Type::identifier},\n             {0, 0, Token_Type::identifier},\n+            {9, 5, Token_Type::kw_while},\n             {0, 0, Token_Type::identifier},\n             {0, 0, Token_Type::identifier},\n+            {71, 6, Token_Type::kw_switch},\n             {0, 0, Token_Type::identifier},\n             {0, 0, Token_Type::identifier},\n-            {133, 9, Token_Type::kw_protected},\n+            {149, 7, Token_Type::kw_package},\n             {0, 0, Token_Type::identifier},\n             {0, 0, Token_Type::identifier},\n+            {232, 10, Token_Type::kw_instanceof},\n             {0, 0, Token_Type::identifier},\n             {183, 3, Token_Type::kw_new},\n             {0, 0, Token_Type::identifier},\n             {0, 0, Token_Type::identifier},\n-            {0, 0, Token_Type::identifier},\n-            {94, 3, Token_Type::kw_set},\n-            {0, 0, Token_Type::identifier},\n-            {0, 0, Token_Type::identifier},\n-            {271, 3, Token_Type::kw_get},\n-            {0, 0, Token_Type::identifier},\n-            {206, 3, Token_Type::kw_let},\n+            {429, 8, Token_Type::kw_abstract},\n+            {200, 6, Token_Type::kw_module},\n+            {167, 6, Token_Type::kw_object},\n             {0, 0, Token_Type::identifier},\n             {0, 0, Token_Type::identifier},\n+            {223, 9, Token_Type::kw_interface},\n+            {122, 2, Token_Type::kw_do},\n             {0, 0, Token_Type::identifier},\n-            {39, 2, Token_Type::kw_in},\n             {0, 0, Token_Type::identifier},\n             {369, 5, Token_Type::kw_class},\n             {0, 0, Token_Type::identifier},\n-            {0, 0, Token_Type::identifier},\n-            {0, 0, Token_Type::identifier},\n-            {421, 8, Token_Type::kw_accessor},\n-            {0, 0, Token_Type::identifier},\n-            {106, 6, Token_Type::kw_return},\n-            {371, 2, Token_Type::kw_as},\n-            {0, 0, Token_Type::identifier},\n+            {191, 9, Token_Type::kw_namespace},\n             {342, 8, Token_Type::kw_debugger},\n-            {0, 0, Token_Type::identifier},\n             {186, 5, Token_Type::kw_never},\n             {0, 0, Token_Type::identifier},\n-            {0, 0, Token_Type::identifier},\n-            {383, 5, Token_Type::kw_break},\n-            {223, 9, Token_Type::kw_interface},\n-            {0, 0, Token_Type::identifier},\n-            {43, 6, Token_Type::kw_typeof},\n-            {0, 0, Token_Type::identifier},\n-            {0, 0, Token_Type::identifier},\n-            {0, 0, Token_Type::identifier},\n-            {0, 0, Token_Type::identifier},\n-            {9, 5, Token_Type::kw_while},\n-            {0, 0, Token_Type::identifier},\n-            {0, 0, Token_Type::identifier},\n-            {122, 2, Token_Type::kw_do},\n-            {0, 0, Token_Type::identifier},\n-            {0, 0, Token_Type::identifier},\n-            {0, 0, Token_Type::identifier},\n-            {0, 0, Token_Type::identifier},\n-            {418, 3, Token_Type::kw_any},\n-            {0, 0, Token_Type::identifier},\n-            {0, 0, Token_Type::identifier},\n-            {0, 0, Token_Type::identifier},\n-            {0, 0, Token_Type::identifier},\n-            {0, 0, Token_Type::identifier},\n-            {242, 5, Token_Type::kw_infer},\n+            {106, 6, Token_Type::kw_return},\n             {265, 6, Token_Type::kw_global},\n             {0, 0, Token_Type::identifier},\n-            {0, 0, Token_Type::identifier},\n-            {0, 0, Token_Type::identifier},\n-            {0, 0, Token_Type::identifier},\n-            {0, 0, Token_Type::identifier},\n-            {0, 0, Token_Type::identifier},\n-            {0, 0, Token_Type::identifier},\n-            {0, 0, Token_Type::identifier},\n-            {0, 0, Token_Type::identifier},\n-            {0, 0, Token_Type::identifier},\n+            {308, 6, Token_Type::kw_export},\n             {0, 0, Token_Type::identifier},\n             {0, 0, Token_Type::identifier},\n             {411, 7, Token_Type::kw_asserts},\n+            {401, 5, Token_Type::kw_await},\n             {0, 0, Token_Type::identifier},\n             {0, 0, Token_Type::identifier},\n             {0, 0, Token_Type::identifier},\n+            {49, 3, Token_Type::kw_try},\n+            {82, 6, Token_Type::kw_string},\n             {0, 0, Token_Type::identifier},\n             {0, 0, Token_Type::identifier},\n             {0, 0, Token_Type::identifier},\n             {0, 0, Token_Type::identifier},\n             {0, 0, Token_Type::identifier},\n             {0, 0, Token_Type::identifier},\n-            {0, 0, Token_Type::identifier},\n-            {0, 0, Token_Type::identifier},\n-            {0, 0, Token_Type::identifier},\n-            {0, 0, Token_Type::identifier},\n-            {0, 0, Token_Type::identifier},\n-            {0, 0, Token_Type::identifier},\n-            {0, 0, Token_Type::identifier},\n-            {0, 0, Token_Type::identifier},\n-            {21, 7, Token_Type::kw_unknown},\n-            {0, 0, Token_Type::identifier},\n-            {0, 0, Token_Type::identifier},\n-            {0, 0, Token_Type::identifier},\n-            {0, 0, Token_Type::identifier},\n-            {282, 4, Token_Type::kw_from},\n-            {0, 0, Token_Type::identifier},\n-            {0, 0, Token_Type::identifier},\n-            {0, 5, Token_Type::kw_yield},\n-            {77, 5, Token_Type::kw_super},\n-            {0, 0, Token_Type::identifier},\n-            {0, 0, Token_Type::identifier},\n-            {43, 4, Token_Type::kw_type},\n-            {173, 6, Token_Type::kw_number},\n         },\n \n     .string_table =\n@@ -631,14 +376,14 @@ constexpr Tables_Type tables = {\n // clang-format on\n }\n \n-Token_Type Lexer::identifier_token_type(String8_View identifier) {\n+[[gnu::noinline]] Token_Type Lexer::identifier_token_type(\n+    String8_View identifier) {\n   std::size_t identifier_size = identifier.size();\n \n   Keyword_Lexer::Selection_Type selection =\n       Keyword_Lexer::select(identifier.data(), identifier_size);\n-  Keyword_Lexer::Hash_Type hash = Keyword_Lexer::mix(selection, hash_seed);\n-  Keyword_Lexer::Hash_Type index =\n-      static_cast<Keyword_Lexer::Hash_Type>(hash % hash_table_size);\n+  Keyword_Lexer::Hash_Type index = Keyword_Lexer::mix_and_reduce(\n+      selection, hash_seed, hash_table_size_shift);\n \n   const Entry& e = tables.hash_table[index];\n   const Char8* e_key = &tables.string_table[e.key_index];\n--- tools/generate-lex-keyword.cpp\n@@ -120,9 +120,11 @@ class Table_Seed {\n \n   void next() { this->seed_ += 1; }\n \n- private:\n-  // Arbitrary.\n-  Keyword_Lexer::Seed_Type seed_ = 0x811c9dc5;  // FNV-1a 32-bit basis.\n+ public:\n+  // This number is arbitrary. However (at least at the time I am writing this\n+  // comment) this seed makes the hash table generation work first try, so use\n+  // this good seed to speed up table generation.\n+  Keyword_Lexer::Seed_Type seed_ = 2'554'672U;\n };\n \n struct Hash_Table {\n@@ -145,7 +147,11 @@ struct Hash_Table {\n     }\n   };\n \n+  explicit Hash_Table(std::uint32_t table_size_shift)\n+      : entries(1 << table_size_shift), table_size_shift(table_size_shift) {}\n+\n   std::vector<Table_Entry> entries;\n+  std::uint32_t table_size_shift;\n   std::uint32_t current_generation = 0;\n   Table_Seed seed;\n \n@@ -154,10 +160,8 @@ struct Hash_Table {\n     for (std::string_view key : keys) {\n       Keyword_Lexer::Selection_Type selection =\n           Keyword_Lexer::select(key.data(), key.size());\n-      Keyword_Lexer::Hash_Type hash =\n-          Keyword_Lexer::mix(selection, this->seed.get());\n-      Keyword_Lexer::Hash_Type index =\n-          static_cast<Keyword_Lexer::Hash_Type>(hash % this->entries.size());\n+      Keyword_Lexer::Hash_Type index = Keyword_Lexer::mix_and_reduce(\n+          selection, this->seed.get(), this->table_size_shift);\n       Table_Entry& entry = this->entries[index];\n       if (entry.is_taken(this->current_generation)) {\n         return false;\n@@ -169,29 +173,29 @@ struct Hash_Table {\n };\n \n Hash_Table make_hash_table(const std::vector<std::string_view>& keys) {\n-  constexpr int attempts_per_table_size = 80'000;\n-  constexpr std::size_t max_table_size = 1024;\n+  constexpr int attempts_per_table_size = 5'000'000;\n+  constexpr std::uint32_t min_table_size_shift = 8;\n+  constexpr std::uint32_t max_table_size_shift = 8;\n \n-  std::size_t table_size = bit_ceil(keys.size());\n+  std::uint32_t table_size_shift = min_table_size_shift;\n   for (;;) {\n-    Hash_Table t;\n-    t.entries.resize(table_size);\n+    Hash_Table t(table_size_shift);\n     for (int attempt = 0; attempt < attempts_per_table_size; ++attempt) {\n       if (t.try_fill(keys)) {\n         return t;\n       }\n       t.seed.next();\n     }\n \n-    std::size_t next_table_size = table_size * 2;\n-    if (next_table_size > max_table_size) {\n+    std::uint32_t next_table_size_shift = table_size_shift + 1;\n+    if (next_table_size_shift > max_table_size_shift) {\n       std::fprintf(stderr,\n                    \"error: failed to generate table; gave up after trying \"\n-                   \"table size %zu\\n\",\n-                   table_size);\n+                   \"table size %llu\\n\",\n+                   1ULL << table_size_shift);\n       std::exit(1);\n     }\n-    table_size = next_table_size;\n+    table_size_shift = next_table_size_shift;\n   }\n }\n \n@@ -253,6 +257,9 @@ namespace {\n   out.append_literal(u8\"constexpr std::size_t hash_table_size = \"_sv);\n   out.append_decimal_integer(t.entries.size());\n   out.append_literal(u8\"LLU;\\n\"_sv);\n+  out.append_literal(u8\"constexpr std::size_t hash_table_size_shift = \"_sv);\n+  out.append_decimal_integer(t.table_size_shift);\n+  out.append_literal(u8\"LLU;\\n\"_sv);\n   out.append_literal(u8\"constexpr std::size_t string_table_size = \"_sv);\n   out.append_decimal_integer(strings.data.size());\n   out.append_literal(u8\"LLU;\\n\"_sv);\n@@ -325,14 +332,14 @@ struct Tables_Type {\n       u8R\"(\n }\n \n-Token_Type Lexer::identifier_token_type(String8_View identifier) {\n+[[gnu::noinline]] Token_Type Lexer::identifier_token_type(\n+    String8_View identifier) {\n   std::size_t identifier_size = identifier.size();\n \n   Keyword_Lexer::Selection_Type selection =\n       Keyword_Lexer::select(identifier.data(), identifier_size);\n-  Keyword_Lexer::Hash_Type hash = Keyword_Lexer::mix(selection, hash_seed);\n-  Keyword_Lexer::Hash_Type index =\n-      static_cast<Keyword_Lexer::Hash_Type>(hash % hash_table_size);\n+  Keyword_Lexer::Hash_Type index = Keyword_Lexer::mix_and_reduce(\n+      selection, hash_seed, hash_table_size_shift);\n \n   const Entry& e = tables.hash_table[index];\n   const Char8* e_key = &tables.string_table[e.key_index];"
    ],
    "files_changed": [
      {
        "filename": "src/quick-lint-js/fe/keyword-lexer.h",
        "status": "modified",
        "additions": 12,
        "deletions": 11,
        "changes": 23,
        "patch": "@@ -13,7 +13,7 @@ namespace quick_lint_js {\n struct Keyword_Lexer {\n   using Selection_Type = std::uint32_t;\n   using Hash_Type = std::uint32_t;\n-  using Seed_Type = std::uint64_t;\n+  using Seed_Type = std::uint32_t;\n \n   static constexpr int padding_size = 17;\n \n@@ -71,20 +71,21 @@ struct Keyword_Lexer {\n #endif\n \n   // Step 2 of the hash function for Lexer::identifier_token_type().\n-  static Hash_Type mix(Selection_Type selection, Seed_Type seed) {\n+  //\n+  // The table's size is (1 << table_size_shift).\n+  //\n+  // This function reduces the hash into an index into the hash table. In other\n+  // words, this function returns a number between 0 (inclusive) and\n+  // (1 << table_size_shift) (exclusive).\n+  static Hash_Type mix_and_reduce(Selection_Type selection, Seed_Type seed,\n+                                  Hash_Type table_size_shift) {\n     // This hash function executes quickly, but might produce a lot of\n     // collisions. Collisions are fine, though; collisions just slow down table\n     // generation, not run-time.\n-\n-    // Pierre L\u2019Ecuyer. 1999. Tables of linear congruential generators of\n-    // different sizes and good lattice structure. Mathematics of Computation of\n-    // the American Mathematical Society 68, 225 (1999), 249\u2013260.\n     //\n-    // https://www.ams.org/journals/mcom/1999-68-225/S0025-5718-99-00996-5/S0025-5718-99-00996-5.pdf\n-    std::uint64_t magic = 4292484099903637661ULL;\n-\n-    std::uint64_t x = static_cast<std::uint64_t>(selection) ^ seed;\n-    return static_cast<std::uint32_t>(multiply_u64_get_top_64(x, magic));\n+    // This hash function was suggested by youtube.com/@bunnyboss3707:\n+    // https://www.youtube.com/watch?v=DMQ_HcNSOAI&lc=UgxPDeWYyiAdMsUCV8V4AaABAg\n+    return (selection * seed) >> (32 - table_size_shift);\n   }\n \n   // Compare two strings, 'a' and 'b', each with size 'size'."
      },
      {
        "filename": "src/quick-lint-js/fe/lex-keyword-generated.cpp",
        "status": "modified",
        "additions": 75,
        "deletions": 330,
        "changes": 405,
        "patch": "@@ -14,10 +14,11 @@\n \n namespace quick_lint_js {\n namespace {\n-constexpr std::size_t hash_table_size = 512LLU;\n+constexpr std::size_t hash_table_size = 256LLU;\n+constexpr std::size_t hash_table_size_shift = 8LLU;\n constexpr std::size_t string_table_size = 454LLU;\n \n-constexpr Keyword_Lexer::Seed_Type hash_seed = 2166215926LLU;\n+constexpr Keyword_Lexer::Seed_Type hash_seed = 2554672LLU;\n \n struct Entry {\n   std::uint16_t key_index;  // Index into tables::string_table.\n@@ -40,301 +41,144 @@ constexpr Tables_Type tables = {\n             {0, 0, Token_Type::identifier},\n             {0, 0, Token_Type::identifier},\n             {0, 0, Token_Type::identifier},\n-            {61, 4, Token_Type::kw_this},\n-            {0, 0, Token_Type::identifier},\n-            {0, 0, Token_Type::identifier},\n-            {0, 0, Token_Type::identifier},\n-            {88, 6, Token_Type::kw_static},\n-            {0, 0, Token_Type::identifier},\n-            {0, 0, Token_Type::identifier},\n-            {0, 0, Token_Type::identifier},\n+            {301, 7, Token_Type::kw_extends},\n             {0, 0, Token_Type::identifier},\n             {0, 0, Token_Type::identifier},\n             {0, 0, Token_Type::identifier},\n             {0, 0, Token_Type::identifier},\n             {0, 0, Token_Type::identifier},\n             {0, 0, Token_Type::identifier},\n-            {112, 7, Token_Type::kw_require},\n             {253, 10, Token_Type::kw_implements},\n-            {263, 2, Token_Type::kw_if},\n-            {335, 7, Token_Type::kw_declare},\n             {0, 0, Token_Type::identifier},\n-            {142, 7, Token_Type::kw_private},\n+            {314, 4, Token_Type::kw_enum},\n             {0, 0, Token_Type::identifier},\n             {0, 0, Token_Type::identifier},\n             {0, 0, Token_Type::identifier},\n-            {214, 9, Token_Type::kw_intrinsic},\n             {406, 5, Token_Type::kw_async},\n             {0, 0, Token_Type::identifier},\n             {0, 0, Token_Type::identifier},\n-            {401, 5, Token_Type::kw_await},\n-            {0, 0, Token_Type::identifier},\n-            {0, 0, Token_Type::identifier},\n-            {0, 0, Token_Type::identifier},\n-            {0, 0, Token_Type::identifier},\n-            {0, 0, Token_Type::identifier},\n-            {318, 4, Token_Type::kw_else},\n-            {0, 0, Token_Type::identifier},\n-            {0, 0, Token_Type::identifier},\n-            {0, 0, Token_Type::identifier},\n-            {301, 7, Token_Type::kw_extends},\n-            {0, 0, Token_Type::identifier},\n-            {0, 0, Token_Type::identifier},\n-            {0, 0, Token_Type::identifier},\n-            {0, 0, Token_Type::identifier},\n-            {0, 0, Token_Type::identifier},\n-            {0, 0, Token_Type::identifier},\n-            {0, 0, Token_Type::identifier},\n-            {0, 0, Token_Type::identifier},\n-            {0, 0, Token_Type::identifier},\n-            {0, 0, Token_Type::identifier},\n-            {71, 6, Token_Type::kw_switch},\n-            {0, 0, Token_Type::identifier},\n-            {14, 4, Token_Type::kw_void},\n-            {0, 0, Token_Type::identifier},\n-            {0, 0, Token_Type::identifier},\n-            {0, 0, Token_Type::identifier},\n-            {0, 0, Token_Type::identifier},\n-            {0, 0, Token_Type::identifier},\n-            {0, 0, Token_Type::identifier},\n-            {0, 0, Token_Type::identifier},\n-            {429, 8, Token_Type::kw_abstract},\n-            {167, 6, Token_Type::kw_object},\n-            {0, 0, Token_Type::identifier},\n-            {0, 0, Token_Type::identifier},\n-            {0, 0, Token_Type::identifier},\n-            {34, 9, Token_Type::kw_undefined},\n-            {127, 6, Token_Type::kw_public},\n-            {0, 0, Token_Type::identifier},\n-            {149, 7, Token_Type::kw_package},\n-            {0, 0, Token_Type::identifier},\n-            {358, 5, Token_Type::kw_const},\n             {0, 0, Token_Type::identifier},\n             {0, 0, Token_Type::identifier},\n             {0, 0, Token_Type::identifier},\n             {0, 0, Token_Type::identifier},\n             {156, 8, Token_Type::kw_override},\n             {0, 0, Token_Type::identifier},\n-            {0, 0, Token_Type::identifier},\n-            {0, 0, Token_Type::identifier},\n-            {0, 0, Token_Type::identifier},\n-            {0, 0, Token_Type::identifier},\n-            {0, 0, Token_Type::identifier},\n-            {0, 0, Token_Type::identifier},\n-            {82, 6, Token_Type::kw_string},\n-            {0, 0, Token_Type::identifier},\n-            {0, 0, Token_Type::identifier},\n-            {0, 0, Token_Type::identifier},\n-            {0, 0, Token_Type::identifier},\n-            {0, 0, Token_Type::identifier},\n-            {0, 0, Token_Type::identifier},\n-            {308, 6, Token_Type::kw_export},\n-            {0, 0, Token_Type::identifier},\n-            {0, 0, Token_Type::identifier},\n-            {0, 0, Token_Type::identifier},\n-            {0, 0, Token_Type::identifier},\n-            {0, 0, Token_Type::identifier},\n-            {0, 0, Token_Type::identifier},\n-            {0, 0, Token_Type::identifier},\n-            {0, 0, Token_Type::identifier},\n-            {0, 0, Token_Type::identifier},\n-            {0, 0, Token_Type::identifier},\n-            {0, 0, Token_Type::identifier},\n-            {374, 5, Token_Type::kw_catch},\n-            {0, 0, Token_Type::identifier},\n-            {0, 0, Token_Type::identifier},\n-            {0, 0, Token_Type::identifier},\n-            {0, 0, Token_Type::identifier},\n-            {0, 0, Token_Type::identifier},\n-            {0, 0, Token_Type::identifier},\n-            {0, 0, Token_Type::identifier},\n-            {0, 0, Token_Type::identifier},\n-            {0, 0, Token_Type::identifier},\n-            {0, 0, Token_Type::identifier},\n-            {0, 0, Token_Type::identifier},\n-            {0, 0, Token_Type::identifier},\n-            {0, 0, Token_Type::identifier},\n-            {388, 7, Token_Type::kw_boolean},\n-            {0, 0, Token_Type::identifier},\n-            {0, 0, Token_Type::identifier},\n-            {0, 0, Token_Type::identifier},\n-            {0, 0, Token_Type::identifier},\n-            {0, 0, Token_Type::identifier},\n-            {0, 0, Token_Type::identifier},\n-            {0, 0, Token_Type::identifier},\n-            {0, 0, Token_Type::identifier},\n-            {0, 0, Token_Type::identifier},\n-            {0, 0, Token_Type::identifier},\n-            {0, 0, Token_Type::identifier},\n-            {0, 0, Token_Type::identifier},\n-            {0, 0, Token_Type::identifier},\n-            {0, 0, Token_Type::identifier},\n-            {52, 4, Token_Type::kw_true},\n-            {0, 0, Token_Type::identifier},\n-            {0, 0, Token_Type::identifier},\n-            {0, 0, Token_Type::identifier},\n-            {0, 0, Token_Type::identifier},\n-            {0, 0, Token_Type::identifier},\n-            {0, 0, Token_Type::identifier},\n-            {0, 0, Token_Type::identifier},\n+            {179, 4, Token_Type::kw_null},\n             {119, 8, Token_Type::kw_readonly},\n             {0, 0, Token_Type::identifier},\n             {0, 0, Token_Type::identifier},\n             {0, 0, Token_Type::identifier},\n             {0, 0, Token_Type::identifier},\n-            {191, 9, Token_Type::kw_namespace},\n-            {0, 0, Token_Type::identifier},\n-            {0, 0, Token_Type::identifier},\n             {0, 0, Token_Type::identifier},\n             {0, 0, Token_Type::identifier},\n-            {0, 0, Token_Type::identifier},\n-            {0, 0, Token_Type::identifier},\n-            {395, 6, Token_Type::kw_bigint},\n-            {0, 0, Token_Type::identifier},\n-            {0, 0, Token_Type::identifier},\n-            {0, 0, Token_Type::identifier},\n-            {0, 0, Token_Type::identifier},\n-            {0, 0, Token_Type::identifier},\n-            {0, 0, Token_Type::identifier},\n-            {286, 3, Token_Type::kw_for},\n-            {358, 11, Token_Type::kw_constructor},\n-            {0, 0, Token_Type::identifier},\n+            {56, 5, Token_Type::kw_throw},\n             {0, 0, Token_Type::identifier},\n             {0, 0, Token_Type::identifier},\n             {0, 0, Token_Type::identifier},\n             {0, 0, Token_Type::identifier},\n             {0, 0, Token_Type::identifier},\n             {0, 0, Token_Type::identifier},\n-            {322, 6, Token_Type::kw_delete},\n             {328, 7, Token_Type::kw_default},\n+            {63, 2, Token_Type::kw_is},\n+            {52, 4, Token_Type::kw_true},\n             {0, 0, Token_Type::identifier},\n-            {97, 9, Token_Type::kw_satisfies},\n-            {0, 0, Token_Type::identifier},\n-            {0, 0, Token_Type::identifier},\n-            {0, 0, Token_Type::identifier},\n-            {0, 0, Token_Type::identifier},\n-            {0, 0, Token_Type::identifier},\n-            {0, 0, Token_Type::identifier},\n-            {0, 0, Token_Type::identifier},\n-            {209, 5, Token_Type::kw_keyof},\n-            {274, 8, Token_Type::kw_function},\n-            {0, 0, Token_Type::identifier},\n-            {0, 0, Token_Type::identifier},\n-            {0, 0, Token_Type::identifier},\n-            {0, 0, Token_Type::identifier},\n-            {0, 0, Token_Type::identifier},\n-            {0, 0, Token_Type::identifier},\n-            {0, 0, Token_Type::identifier},\n-            {0, 0, Token_Type::identifier},\n-            {0, 0, Token_Type::identifier},\n-            {56, 5, Token_Type::kw_throw},\n-            {0, 0, Token_Type::identifier},\n-            {0, 0, Token_Type::identifier},\n-            {0, 0, Token_Type::identifier},\n-            {0, 0, Token_Type::identifier},\n+            {411, 6, Token_Type::kw_assert},\n             {0, 0, Token_Type::identifier},\n+            {142, 7, Token_Type::kw_private},\n             {0, 0, Token_Type::identifier},\n             {0, 0, Token_Type::identifier},\n             {0, 0, Token_Type::identifier},\n+            {322, 6, Token_Type::kw_delete},\n             {0, 0, Token_Type::identifier},\n             {0, 0, Token_Type::identifier},\n+            {21, 7, Token_Type::kw_unknown},\n             {0, 0, Token_Type::identifier},\n             {0, 0, Token_Type::identifier},\n             {0, 0, Token_Type::identifier},\n-            {232, 10, Token_Type::kw_instanceof},\n             {0, 0, Token_Type::identifier},\n             {0, 0, Token_Type::identifier},\n-            {164, 3, Token_Type::kw_out},\n+            {335, 7, Token_Type::kw_declare},\n             {0, 0, Token_Type::identifier},\n+            {112, 7, Token_Type::kw_require},\n             {0, 0, Token_Type::identifier},\n+            {358, 11, Token_Type::kw_constructor},\n+            {286, 3, Token_Type::kw_for},\n             {0, 0, Token_Type::identifier},\n             {0, 0, Token_Type::identifier},\n             {0, 0, Token_Type::identifier},\n+            {247, 6, Token_Type::kw_import},\n             {0, 0, Token_Type::identifier},\n+            {133, 9, Token_Type::kw_protected},\n+            {318, 4, Token_Type::kw_else},\n             {0, 0, Token_Type::identifier},\n+            {242, 5, Token_Type::kw_infer},\n+            {271, 3, Token_Type::kw_get},\n+            {206, 3, Token_Type::kw_let},\n+            {94, 3, Token_Type::kw_set},\n             {0, 0, Token_Type::identifier},\n-            {49, 3, Token_Type::kw_try},\n+            {371, 2, Token_Type::kw_as},\n             {0, 0, Token_Type::identifier},\n             {0, 0, Token_Type::identifier},\n             {0, 0, Token_Type::identifier},\n+            {88, 6, Token_Type::kw_static},\n+            {43, 4, Token_Type::kw_type},\n             {0, 0, Token_Type::identifier},\n             {0, 0, Token_Type::identifier},\n             {0, 0, Token_Type::identifier},\n             {0, 0, Token_Type::identifier},\n             {0, 0, Token_Type::identifier},\n             {0, 0, Token_Type::identifier},\n             {0, 0, Token_Type::identifier},\n+            {173, 6, Token_Type::kw_number},\n+            {77, 5, Token_Type::kw_super},\n             {0, 0, Token_Type::identifier},\n             {0, 0, Token_Type::identifier},\n             {0, 0, Token_Type::identifier},\n+            {5, 4, Token_Type::kw_with},\n             {0, 0, Token_Type::identifier},\n             {0, 0, Token_Type::identifier},\n             {0, 0, Token_Type::identifier},\n             {18, 3, Token_Type::kw_var},\n             {0, 0, Token_Type::identifier},\n-            {314, 4, Token_Type::kw_enum},\n-            {0, 0, Token_Type::identifier},\n-            {0, 0, Token_Type::identifier},\n-            {47, 2, Token_Type::kw_of},\n-            {0, 0, Token_Type::identifier},\n-            {0, 0, Token_Type::identifier},\n-            {0, 0, Token_Type::identifier},\n-            {0, 0, Token_Type::identifier},\n-            {0, 0, Token_Type::identifier},\n-            {0, 0, Token_Type::identifier},\n-            {0, 0, Token_Type::identifier},\n-            {0, 0, Token_Type::identifier},\n-            {0, 0, Token_Type::identifier},\n-            {0, 0, Token_Type::identifier},\n-            {0, 0, Token_Type::identifier},\n-            {0, 0, Token_Type::identifier},\n-            {0, 0, Token_Type::identifier},\n-            {0, 0, Token_Type::identifier},\n-            {0, 0, Token_Type::identifier},\n-            {0, 0, Token_Type::identifier},\n-            {0, 0, Token_Type::identifier},\n-            {0, 0, Token_Type::identifier},\n-            {0, 0, Token_Type::identifier},\n-            {0, 0, Token_Type::identifier},\n-            {0, 0, Token_Type::identifier},\n-            {0, 0, Token_Type::identifier},\n-            {0, 0, Token_Type::identifier},\n-            {0, 0, Token_Type::identifier},\n-            {0, 0, Token_Type::identifier},\n-            {0, 0, Token_Type::identifier},\n-            {0, 0, Token_Type::identifier},\n-            {0, 0, Token_Type::identifier},\n-            {0, 0, Token_Type::identifier},\n-            {0, 0, Token_Type::identifier},\n-            {0, 0, Token_Type::identifier},\n-            {0, 0, Token_Type::identifier},\n+            {214, 9, Token_Type::kw_intrinsic},\n             {0, 0, Token_Type::identifier},\n             {0, 0, Token_Type::identifier},\n             {0, 0, Token_Type::identifier},\n+            {274, 8, Token_Type::kw_function},\n+            {421, 8, Token_Type::kw_accessor},\n             {0, 0, Token_Type::identifier},\n+            {418, 3, Token_Type::kw_any},\n+            {164, 3, Token_Type::kw_out},\n             {0, 0, Token_Type::identifier},\n             {0, 0, Token_Type::identifier},\n             {0, 0, Token_Type::identifier},\n             {0, 0, Token_Type::identifier},\n             {0, 0, Token_Type::identifier},\n             {0, 0, Token_Type::identifier},\n             {0, 0, Token_Type::identifier},\n+            {39, 2, Token_Type::kw_in},\n+            {374, 5, Token_Type::kw_catch},\n+            {127, 6, Token_Type::kw_public},\n             {0, 0, Token_Type::identifier},\n             {0, 0, Token_Type::identifier},\n+            {209, 5, Token_Type::kw_keyof},\n             {0, 0, Token_Type::identifier},\n             {0, 0, Token_Type::identifier},\n+            {61, 4, Token_Type::kw_this},\n             {0, 0, Token_Type::identifier},\n+            {97, 9, Token_Type::kw_satisfies},\n             {0, 0, Token_Type::identifier},\n             {0, 0, Token_Type::identifier},\n             {0, 0, Token_Type::identifier},\n             {0, 0, Token_Type::identifier},\n             {0, 0, Token_Type::identifier},\n             {0, 0, Token_Type::identifier},\n             {0, 0, Token_Type::identifier},\n+            {43, 6, Token_Type::kw_typeof},\n             {0, 0, Token_Type::identifier},\n-            {63, 2, Token_Type::kw_is},\n             {0, 0, Token_Type::identifier},\n             {0, 0, Token_Type::identifier},\n+            {358, 5, Token_Type::kw_const},\n             {0, 0, Token_Type::identifier},\n             {28, 6, Token_Type::kw_unique},\n             {0, 0, Token_Type::identifier},\n@@ -343,57 +187,29 @@ constexpr Tables_Type tables = {\n             {0, 0, Token_Type::identifier},\n             {0, 0, Token_Type::identifier},\n             {0, 0, Token_Type::identifier},\n-            {411, 6, Token_Type::kw_assert},\n-            {0, 0, Token_Type::identifier},\n-            {179, 4, Token_Type::kw_null},\n-            {0, 0, Token_Type::identifier},\n-            {0, 0, Token_Type::identifier},\n-            {0, 0, Token_Type::identifier},\n-            {0, 0, Token_Type::identifier},\n-            {0, 0, Token_Type::identifier},\n-            {0, 0, Token_Type::identifier},\n-            {0, 0, Token_Type::identifier},\n-            {0, 0, Token_Type::identifier},\n-            {0, 0, Token_Type::identifier},\n-            {0, 0, Token_Type::identifier},\n-            {0, 0, Token_Type::identifier},\n-            {0, 0, Token_Type::identifier},\n-            {0, 0, Token_Type::identifier},\n-            {0, 0, Token_Type::identifier},\n-            {0, 0, Token_Type::identifier},\n-            {0, 0, Token_Type::identifier},\n-            {5, 4, Token_Type::kw_with},\n-            {0, 0, Token_Type::identifier},\n-            {0, 0, Token_Type::identifier},\n-            {0, 0, Token_Type::identifier},\n-            {0, 0, Token_Type::identifier},\n-            {0, 0, Token_Type::identifier},\n-            {0, 0, Token_Type::identifier},\n-            {0, 0, Token_Type::identifier},\n-            {0, 0, Token_Type::identifier},\n-            {0, 0, Token_Type::identifier},\n-            {0, 0, Token_Type::identifier},\n-            {0, 0, Token_Type::identifier},\n-            {0, 0, Token_Type::identifier},\n             {0, 0, Token_Type::identifier},\n             {0, 0, Token_Type::identifier},\n             {0, 0, Token_Type::identifier},\n             {0, 0, Token_Type::identifier},\n             {0, 0, Token_Type::identifier},\n+            {379, 4, Token_Type::kw_case},\n+            {296, 5, Token_Type::kw_false},\n             {0, 0, Token_Type::identifier},\n             {0, 0, Token_Type::identifier},\n             {0, 0, Token_Type::identifier},\n-            {289, 7, Token_Type::kw_finally},\n             {0, 0, Token_Type::identifier},\n             {0, 0, Token_Type::identifier},\n             {0, 0, Token_Type::identifier},\n+            {47, 2, Token_Type::kw_of},\n             {0, 0, Token_Type::identifier},\n             {0, 0, Token_Type::identifier},\n             {0, 0, Token_Type::identifier},\n             {0, 0, Token_Type::identifier},\n+            {383, 5, Token_Type::kw_break},\n+            {65, 6, Token_Type::kw_symbol},\n             {0, 0, Token_Type::identifier},\n             {0, 0, Token_Type::identifier},\n-            {247, 6, Token_Type::kw_import},\n+            {34, 9, Token_Type::kw_undefined},\n             {0, 0, Token_Type::identifier},\n             {0, 0, Token_Type::identifier},\n             {0, 0, Token_Type::identifier},\n@@ -402,40 +218,26 @@ constexpr Tables_Type tables = {\n             {0, 0, Token_Type::identifier},\n             {350, 8, Token_Type::kw_continue},\n             {0, 0, Token_Type::identifier},\n-            {0, 0, Token_Type::identifier},\n-            {0, 0, Token_Type::identifier},\n-            {0, 0, Token_Type::identifier},\n-            {296, 5, Token_Type::kw_false},\n-            {379, 4, Token_Type::kw_case},\n-            {0, 0, Token_Type::identifier},\n-            {0, 0, Token_Type::identifier},\n-            {0, 0, Token_Type::identifier},\n-            {0, 0, Token_Type::identifier},\n-            {0, 0, Token_Type::identifier},\n-            {0, 0, Token_Type::identifier},\n-            {0, 0, Token_Type::identifier},\n-            {0, 0, Token_Type::identifier},\n-            {0, 0, Token_Type::identifier},\n-            {0, 0, Token_Type::identifier},\n-            {0, 0, Token_Type::identifier},\n-            {0, 0, Token_Type::identifier},\n-            {0, 0, Token_Type::identifier},\n-            {0, 0, Token_Type::identifier},\n+            {289, 7, Token_Type::kw_finally},\n             {0, 0, Token_Type::identifier},\n             {0, 0, Token_Type::identifier},\n             {0, 0, Token_Type::identifier},\n             {0, 0, Token_Type::identifier},\n             {0, 0, Token_Type::identifier},\n+            {395, 6, Token_Type::kw_bigint},\n             {0, 0, Token_Type::identifier},\n             {0, 0, Token_Type::identifier},\n             {0, 0, Token_Type::identifier},\n+            {263, 2, Token_Type::kw_if},\n+            {14, 4, Token_Type::kw_void},\n             {0, 0, Token_Type::identifier},\n             {0, 0, Token_Type::identifier},\n             {0, 0, Token_Type::identifier},\n+            {388, 7, Token_Type::kw_boolean},\n             {0, 0, Token_Type::identifier},\n+            {282, 4, Token_Type::kw_from},\n             {0, 0, Token_Type::identifier},\n-            {65, 6, Token_Type::kw_symbol},\n-            {200, 6, Token_Type::kw_module},\n+            {0, 5, Token_Type::kw_yield},\n             {0, 0, Token_Type::identifier},\n             {0, 0, Token_Type::identifier},\n             {0, 0, Token_Type::identifier},\n@@ -444,111 +246,54 @@ constexpr Tables_Type tables = {\n             {0, 0, Token_Type::identifier},\n             {0, 0, Token_Type::identifier},\n             {0, 0, Token_Type::identifier},\n+            {9, 5, Token_Type::kw_while},\n             {0, 0, Token_Type::identifier},\n             {0, 0, Token_Type::identifier},\n+            {71, 6, Token_Type::kw_switch},\n             {0, 0, Token_Type::identifier},\n             {0, 0, Token_Type::identifier},\n-            {133, 9, Token_Type::kw_protected},\n+            {149, 7, Token_Type::kw_package},\n             {0, 0, Token_Type::identifier},\n             {0, 0, Token_Type::identifier},\n+            {232, 10, Token_Type::kw_instanceof},\n             {0, 0, Token_Type::identifier},\n             {183, 3, Token_Type::kw_new},\n             {0, 0, Token_Type::identifier},\n             {0, 0, Token_Type::identifier},\n-            {0, 0, Token_Type::identifier},\n-            {94, 3, Token_Type::kw_set},\n-            {0, 0, Token_Type::identifier},\n-            {0, 0, Token_Type::identifier},\n-            {271, 3, Token_Type::kw_get},\n-            {0, 0, Token_Type::identifier},\n-            {206, 3, Token_Type::kw_let},\n+            {429, 8, Token_Type::kw_abstract},\n+            {200, 6, Token_Type::kw_module},\n+            {167, 6, Token_Type::kw_object},\n             {0, 0, Token_Type::identifier},\n             {0, 0, Token_Type::identifier},\n+            {223, 9, Token_Type::kw_interface},\n+            {122, 2, Token_Type::kw_do},\n             {0, 0, Token_Type::identifier},\n-            {39, 2, Token_Type::kw_in},\n             {0, 0, Token_Type::identifier},\n             {369, 5, Token_Type::kw_class},\n             {0, 0, Token_Type::identifier},\n-            {0, 0, Token_Type::identifier},\n-            {0, 0, Token_Type::identifier},\n-            {421, 8, Token_Type::kw_accessor},\n-            {0, 0, Token_Type::identifier},\n-            {106, 6, Token_Type::kw_return},\n-            {371, 2, Token_Type::kw_as},\n-            {0, 0, Token_Type::identifier},\n+            {191, 9, Token_Type::kw_namespace},\n             {342, 8, Token_Type::kw_debugger},\n-            {0, 0, Token_Type::identifier},\n             {186, 5, Token_Type::kw_never},\n             {0, 0, Token_Type::identifier},\n-            {0, 0, Token_Type::identifier},\n-            {383, 5, Token_Type::kw_break},\n-            {223, 9, Token_Type::kw_interface},\n-            {0, 0, Token_Type::identifier},\n-            {43, 6, Token_Type::kw_typeof},\n-            {0, 0, Token_Type::identifier},\n-            {0, 0, Token_Type::identifier},\n-            {0, 0, Token_Type::identifier},\n-            {0, 0, Token_Type::identifier},\n-            {9, 5, Token_Type::kw_while},\n-            {0, 0, Token_Type::identifier},\n-            {0, 0, Token_Type::identifier},\n-            {122, 2, Token_Type::kw_do},\n-            {0, 0, Token_Type::identifier},\n-            {0, 0, Token_Type::identifier},\n-            {0, 0, Token_Type::identifier},\n-            {0, 0, Token_Type::identifier},\n-            {418, 3, Token_Type::kw_any},\n-            {0, 0, Token_Type::identifier},\n-            {0, 0, Token_Type::identifier},\n-            {0, 0, Token_Type::identifier},\n-            {0, 0, Token_Type::identifier},\n-            {0, 0, Token_Type::identifier},\n-            {242, 5, Token_Type::kw_infer},\n+            {106, 6, Token_Type::kw_return},\n             {265, 6, Token_Type::kw_global},\n             {0, 0, Token_Type::identifier},\n-            {0, 0, Token_Type::identifier},\n-            {0, 0, Token_Type::identifier},\n-            {0, 0, Token_Type::identifier},\n-            {0, 0, Token_Type::identifier},\n-            {0, 0, Token_Type::identifier},\n-            {0, 0, Token_Type::identifier},\n-            {0, 0, Token_Type::identifier},\n-            {0, 0, Token_Type::identifier},\n-            {0, 0, Token_Type::identifier},\n+            {308, 6, Token_Type::kw_export},\n             {0, 0, Token_Type::identifier},\n             {0, 0, Token_Type::identifier},\n             {411, 7, Token_Type::kw_asserts},\n+            {401, 5, Token_Type::kw_await},\n             {0, 0, Token_Type::identifier},\n             {0, 0, Token_Type::identifier},\n             {0, 0, Token_Type::identifier},\n+            {49, 3, Token_Type::kw_try},\n+            {82, 6, Token_Type::kw_string},\n             {0, 0, Token_Type::identifier},\n             {0, 0, Token_Type::identifier},\n             {0, 0, Token_Type::identifier},\n             {0, 0, Token_Type::identifier},\n             {0, 0, Token_Type::identifier},\n             {0, 0, Token_Type::identifier},\n-            {0, 0, Token_Type::identifier},\n-            {0, 0, Token_Type::identifier},\n-            {0, 0, Token_Type::identifier},\n-            {0, 0, Token_Type::identifier},\n-            {0, 0, Token_Type::identifier},\n-            {0, 0, Token_Type::identifier},\n-            {0, 0, Token_Type::identifier},\n-            {0, 0, Token_Type::identifier},\n-            {21, 7, Token_Type::kw_unknown},\n-            {0, 0, Token_Type::identifier},\n-            {0, 0, Token_Type::identifier},\n-            {0, 0, Token_Type::identifier},\n-            {0, 0, Token_Type::identifier},\n-            {282, 4, Token_Type::kw_from},\n-            {0, 0, Token_Type::identifier},\n-            {0, 0, Token_Type::identifier},\n-            {0, 5, Token_Type::kw_yield},\n-            {77, 5, Token_Type::kw_super},\n-            {0, 0, Token_Type::identifier},\n-            {0, 0, Token_Type::identifier},\n-            {43, 4, Token_Type::kw_type},\n-            {173, 6, Token_Type::kw_number},\n         },\n \n     .string_table =\n@@ -631,14 +376,14 @@ constexpr Tables_Type tables = {\n // clang-format on\n }\n \n-Token_Type Lexer::identifier_token_type(String8_View identifier) {\n+[[gnu::noinline]] Token_Type Lexer::identifier_token_type(\n+    String8_View identifier) {\n   std::size_t identifier_size = identifier.size();\n \n   Keyword_Lexer::Selection_Type selection =\n       Keyword_Lexer::select(identifier.data(), identifier_size);\n-  Keyword_Lexer::Hash_Type hash = Keyword_Lexer::mix(selection, hash_seed);\n-  Keyword_Lexer::Hash_Type index =\n-      static_cast<Keyword_Lexer::Hash_Type>(hash % hash_table_size);\n+  Keyword_Lexer::Hash_Type index = Keyword_Lexer::mix_and_reduce(\n+      selection, hash_seed, hash_table_size_shift);\n \n   const Entry& e = tables.hash_table[index];\n   const Char8* e_key = &tables.string_table[e.key_index];"
      },
      {
        "filename": "tools/generate-lex-keyword.cpp",
        "status": "modified",
        "additions": 28,
        "deletions": 21,
        "changes": 49,
        "patch": "@@ -120,9 +120,11 @@ class Table_Seed {\n \n   void next() { this->seed_ += 1; }\n \n- private:\n-  // Arbitrary.\n-  Keyword_Lexer::Seed_Type seed_ = 0x811c9dc5;  // FNV-1a 32-bit basis.\n+ public:\n+  // This number is arbitrary. However (at least at the time I am writing this\n+  // comment) this seed makes the hash table generation work first try, so use\n+  // this good seed to speed up table generation.\n+  Keyword_Lexer::Seed_Type seed_ = 2'554'672U;\n };\n \n struct Hash_Table {\n@@ -145,7 +147,11 @@ struct Hash_Table {\n     }\n   };\n \n+  explicit Hash_Table(std::uint32_t table_size_shift)\n+      : entries(1 << table_size_shift), table_size_shift(table_size_shift) {}\n+\n   std::vector<Table_Entry> entries;\n+  std::uint32_t table_size_shift;\n   std::uint32_t current_generation = 0;\n   Table_Seed seed;\n \n@@ -154,10 +160,8 @@ struct Hash_Table {\n     for (std::string_view key : keys) {\n       Keyword_Lexer::Selection_Type selection =\n           Keyword_Lexer::select(key.data(), key.size());\n-      Keyword_Lexer::Hash_Type hash =\n-          Keyword_Lexer::mix(selection, this->seed.get());\n-      Keyword_Lexer::Hash_Type index =\n-          static_cast<Keyword_Lexer::Hash_Type>(hash % this->entries.size());\n+      Keyword_Lexer::Hash_Type index = Keyword_Lexer::mix_and_reduce(\n+          selection, this->seed.get(), this->table_size_shift);\n       Table_Entry& entry = this->entries[index];\n       if (entry.is_taken(this->current_generation)) {\n         return false;\n@@ -169,29 +173,29 @@ struct Hash_Table {\n };\n \n Hash_Table make_hash_table(const std::vector<std::string_view>& keys) {\n-  constexpr int attempts_per_table_size = 80'000;\n-  constexpr std::size_t max_table_size = 1024;\n+  constexpr int attempts_per_table_size = 5'000'000;\n+  constexpr std::uint32_t min_table_size_shift = 8;\n+  constexpr std::uint32_t max_table_size_shift = 8;\n \n-  std::size_t table_size = bit_ceil(keys.size());\n+  std::uint32_t table_size_shift = min_table_size_shift;\n   for (;;) {\n-    Hash_Table t;\n-    t.entries.resize(table_size);\n+    Hash_Table t(table_size_shift);\n     for (int attempt = 0; attempt < attempts_per_table_size; ++attempt) {\n       if (t.try_fill(keys)) {\n         return t;\n       }\n       t.seed.next();\n     }\n \n-    std::size_t next_table_size = table_size * 2;\n-    if (next_table_size > max_table_size) {\n+    std::uint32_t next_table_size_shift = table_size_shift + 1;\n+    if (next_table_size_shift > max_table_size_shift) {\n       std::fprintf(stderr,\n                    \"error: failed to generate table; gave up after trying \"\n-                   \"table size %zu\\n\",\n-                   table_size);\n+                   \"table size %llu\\n\",\n+                   1ULL << table_size_shift);\n       std::exit(1);\n     }\n-    table_size = next_table_size;\n+    table_size_shift = next_table_size_shift;\n   }\n }\n \n@@ -253,6 +257,9 @@ namespace {\n   out.append_literal(u8\"constexpr std::size_t hash_table_size = \"_sv);\n   out.append_decimal_integer(t.entries.size());\n   out.append_literal(u8\"LLU;\\n\"_sv);\n+  out.append_literal(u8\"constexpr std::size_t hash_table_size_shift = \"_sv);\n+  out.append_decimal_integer(t.table_size_shift);\n+  out.append_literal(u8\"LLU;\\n\"_sv);\n   out.append_literal(u8\"constexpr std::size_t string_table_size = \"_sv);\n   out.append_decimal_integer(strings.data.size());\n   out.append_literal(u8\"LLU;\\n\"_sv);\n@@ -325,14 +332,14 @@ struct Tables_Type {\n       u8R\"(\n }\n \n-Token_Type Lexer::identifier_token_type(String8_View identifier) {\n+[[gnu::noinline]] Token_Type Lexer::identifier_token_type(\n+    String8_View identifier) {\n   std::size_t identifier_size = identifier.size();\n \n   Keyword_Lexer::Selection_Type selection =\n       Keyword_Lexer::select(identifier.data(), identifier_size);\n-  Keyword_Lexer::Hash_Type hash = Keyword_Lexer::mix(selection, hash_seed);\n-  Keyword_Lexer::Hash_Type index =\n-      static_cast<Keyword_Lexer::Hash_Type>(hash % hash_table_size);\n+  Keyword_Lexer::Hash_Type index = Keyword_Lexer::mix_and_reduce(\n+      selection, hash_seed, hash_table_size_shift);\n \n   const Entry& e = tables.hash_table[index];\n   const Char8* e_key = &tables.string_table[e.key_index];"
      }
    ],
    "lines_added": 115,
    "lines_removed": 362
  },
  "issues": [],
  "pull_requests": [],
  "build_info": {
    "old_build_script": [
      "apt-get update",
      "cmake -S /test_workspace/workspace/old -B /test_workspace/workspace/old/build -DCMAKE_BUILD_TYPE=Debug -DCMAKE_EXPORT_COMPILE_COMMANDS=ON -DBENCHMARK_ENABLE_ASSEMBLY_TESTS=ON -DBUILD_TESTING=ON -DBENCHMARK_ENABLE_GTEST_TESTS=ON -DBENCHMARK_USE_BUNDLED_GTEST=ON -DBENCHMARK_ENABLE_TESTING=ON",
      "cmake --build /test_workspace/workspace/old/build -- -j 1"
    ],
    "new_build_script": [
      "apt-get update",
      "cmake -S /test_workspace/workspace/new -B /test_workspace/workspace/new/build -DCMAKE_BUILD_TYPE=Debug -DCMAKE_EXPORT_COMPILE_COMMANDS=ON -DBENCHMARK_ENABLE_ASSEMBLY_TESTS=ON -DBUILD_TESTING=ON -DBENCHMARK_ENABLE_GTEST_TESTS=ON -DBENCHMARK_USE_BUNDLED_GTEST=ON -DBENCHMARK_ENABLE_TESTING=ON",
      "cmake --build /test_workspace/workspace/new/build -- -j 1"
    ],
    "old_test_script": [
      "cd /test_workspace/workspace/old/build",
      "ctest --output-on-failure"
    ],
    "new_test_script": [
      "cd /test_workspace/workspace/new/build",
      "ctest --output-on-failure"
    ],
    "build_system": "cmake"
  },
  "performance_analysis": {
    "is_significant": false,
    "p_value": 1.0,
    "is_pair_significant": false,
    "pair_p_value": 1.0,
    "is_binom_significant": false,
    "binom_p_value": 1.0,
    "is_wilcoxon_significant": false,
    "wilcoxon_p_value": 0.9999992249960966,
    "is_mannwhitney_significant": false,
    "mannwhitney_p_value": 0.7800169512067638,
    "relative_improvement": -0.0007354293068578626,
    "absolute_improvement_ms": -1.3333333333336306,
    "old_mean_ms": 1813.0,
    "new_mean_ms": 1814.3333333333335,
    "old_std_ms": 7.943767889097855,
    "new_std_ms": 11.65105688067747,
    "effect_size_cohens_d": -0.133718134518264,
    "old_ci95_ms": [
      1810.0337483212288,
      1815.9662516787712
    ],
    "new_ci95_ms": [
      1809.982757194371,
      1818.6839094722961
    ],
    "old_ci99_ms": [
      1809.0023392260355,
      1816.9976607739643
    ],
    "new_ci99_ms": [
      1808.4699982362654,
      1820.1966684304018
    ],
    "new_times_s": [
      1.81,
      1.8,
      1.79,
      1.81,
      1.82,
      1.82,
      1.81,
      1.83,
      1.83,
      1.82,
      1.8,
      1.82,
      1.83,
      1.81,
      1.82,
      1.81,
      1.81,
      1.82,
      1.79,
      1.82,
      1.82,
      1.82,
      1.81,
      1.82,
      1.8,
      1.8,
      1.82,
      1.81,
      1.84,
      1.81,
      1.82
    ],
    "old_times_s": [
      1.8,
      1.82,
      1.81,
      1.81,
      1.8,
      1.81,
      1.81,
      1.81,
      1.81,
      1.82,
      1.8,
      1.82,
      1.81,
      1.81,
      1.81,
      1.82,
      1.82,
      1.81,
      1.81,
      1.83,
      1.81,
      1.81,
      1.8,
      1.8,
      1.82,
      1.82,
      1.82,
      1.82,
      1.81,
      1.83,
      1.81
    ]
  },
  "tests": {
    "total_tests": 3,
    "significant_improvements": 0,
    "significant_improvements_tests": [],
    "significant_regressions": 0,
    "significant_regressions_tests": [],
    "significant_pair_improvements": 0,
    "significant_pair_improvements_tests": [],
    "significant_pair_regressions": 0,
    "significant_pair_regressions_tests": [],
    "significant_binom_improvements": 0,
    "significant_binom_improvements_tests": [],
    "significant_binom_regressions": 0,
    "significant_binom_regressions_tests": [],
    "significant_wilcoxon_improvements": 0,
    "significant_wilcoxon_improvements_tests": [],
    "significant_wilcoxon_regressions": 0,
    "significant_wilcoxon_regressions_tests": [],
    "significant_mannwhitney_improvements": 0,
    "significant_mannwhitney_improvements_tests": [],
    "significant_mannwhitney_regressions": 0,
    "significant_mannwhitney_regressions_tests": [],
    "tests": [
      {
        "test_name": "quick-lint-js-test",
        "is_significant": false,
        "p_value": 1.0,
        "is_pair_significant": false,
        "pair_p_value": 1.0,
        "is_binom_significant": false,
        "binom_p_value": 1.0,
        "is_wilcoxon_significant": false,
        "wilcoxon_p_value": 0.9999986158554242,
        "is_mannwhitney_significant": false,
        "mannwhitney_p_value": 0.9400811009992499,
        "relative_improvement": -0.0017777777777778978,
        "absolute_improvement_ms": -2.8571428571426694,
        "old_mean_ms": 1607.142857142857,
        "new_mean_ms": 1609.9999999999998,
        "old_std_ms": 5.99823607228292,
        "new_std_ms": 8.164965809277247,
        "effect_size_cohens_d": -0.3988200564263691,
        "old_ci95_ms": [
          1604.8169840030248,
          1609.4687302826896
        ],
        "new_ci95_ms": [
          1606.8339567775263,
          1613.1660432224735
        ],
        "old_ci99_ms": [
          1604.002121581513,
          1610.2835927042015
        ],
        "new_ci99_ms": [
          1605.7247433803323,
          1614.2752566196675
        ],
        "new_times": [
          1.61,
          1.62,
          1.61,
          1.61,
          1.62,
          1.61,
          1.61,
          1.6,
          1.61,
          1.62,
          1.61,
          1.61,
          1.61,
          1.6,
          1.62,
          1.59,
          1.61,
          1.61,
          1.61,
          1.6,
          1.61,
          1.6,
          1.6,
          1.61,
          1.61,
          1.63,
          1.61,
          1.62
        ],
        "old_times": [
          1.61,
          1.6,
          1.6,
          1.61,
          1.6,
          1.61,
          1.61,
          1.6,
          1.61,
          1.61,
          1.61,
          1.61,
          1.61,
          1.61,
          1.61,
          1.6,
          1.62,
          1.6,
          1.61,
          1.6,
          1.6,
          1.61,
          1.61,
          1.61,
          1.61,
          1.6,
          1.62,
          1.6
        ]
      },
      {
        "test_name": "quick-lint-js-test-lex-unicode",
        "is_significant": false,
        "p_value": 0.9999999990024122,
        "is_pair_significant": false,
        "pair_p_value": 0.9999999999102507,
        "is_binom_significant": false,
        "binom_p_value": 0.9999999962747097,
        "is_wilcoxon_significant": false,
        "wilcoxon_p_value": 0.9999992875747952,
        "is_mannwhitney_significant": false,
        "mannwhitney_p_value": 0.9455038193913841,
        "relative_improvement": -0.014925373134328259,
        "absolute_improvement_ms": -2.142857142857113,
        "old_mean_ms": 143.5714285714286,
        "new_mean_ms": 145.71428571428572,
        "old_std_ms": 4.879500364742656,
        "new_std_ms": 5.039526306789687,
        "effect_size_cohens_d": -0.43201382466358224,
        "old_ci95_ms": [
          141.67935585248375,
          145.46350129037344
        ],
        "new_ci95_ms": [
          143.76016141287593,
          147.6684100156955
        ],
        "old_ci99_ms": [
          141.01647405939218,
          146.12638308346502
        ],
        "new_ci99_ms": [
          143.0755400408365,
          148.35303138773492
        ],
        "new_times": [
          0.14,
          0.14,
          0.15,
          0.15,
          0.15,
          0.15,
          0.15,
          0.14,
          0.15,
          0.15,
          0.14,
          0.15,
          0.14,
          0.14,
          0.14,
          0.14,
          0.15,
          0.15,
          0.15,
          0.14,
          0.14,
          0.14,
          0.14,
          0.15,
          0.15,
          0.15,
          0.15,
          0.15
        ],
        "old_times": [
          0.14,
          0.14,
          0.14,
          0.14,
          0.15,
          0.14,
          0.15,
          0.14,
          0.14,
          0.14,
          0.14,
          0.14,
          0.14,
          0.15,
          0.14,
          0.14,
          0.15,
          0.15,
          0.14,
          0.14,
          0.14,
          0.14,
          0.14,
          0.15,
          0.15,
          0.15,
          0.15,
          0.15
        ]
      },
      {
        "test_name": "quick-lint-js-test-cli",
        "is_significant": false,
        "p_value": 1.0,
        "is_pair_significant": false,
        "pair_p_value": 1.0,
        "is_binom_significant": false,
        "binom_p_value": 1.0,
        "is_wilcoxon_significant": false,
        "wilcoxon_p_value": 0.9999999393422746,
        "is_mannwhitney_significant": false,
        "mannwhitney_p_value": 1.0,
        "relative_improvement": 0.0,
        "absolute_improvement_ms": 0.0,
        "old_mean_ms": 60.00000000000001,
        "new_mean_ms": 60.00000000000001,
        "old_std_ms": 7.0662236786494465e-15,
        "new_std_ms": 7.0662236786494465e-15,
        "effect_size_cohens_d": 0.0,
        "old_ci95_ms": [
          60.00000000000001,
          60.00000000000001
        ],
        "new_ci95_ms": [
          60.00000000000001,
          60.00000000000001
        ],
        "old_ci99_ms": [
          60.0,
          60.000000000000014
        ],
        "new_ci99_ms": [
          60.0,
          60.000000000000014
        ],
        "new_times": [
          0.06,
          0.06,
          0.06,
          0.06,
          0.06,
          0.06,
          0.06,
          0.06,
          0.06,
          0.06,
          0.06,
          0.06,
          0.06,
          0.06,
          0.06,
          0.06,
          0.06,
          0.06,
          0.06,
          0.06,
          0.06,
          0.06,
          0.06,
          0.06,
          0.06,
          0.06,
          0.06,
          0.06
        ],
        "old_times": [
          0.06,
          0.06,
          0.06,
          0.06,
          0.06,
          0.06,
          0.06,
          0.06,
          0.06,
          0.06,
          0.06,
          0.06,
          0.06,
          0.06,
          0.06,
          0.06,
          0.06,
          0.06,
          0.06,
          0.06,
          0.06,
          0.06,
          0.06,
          0.06,
          0.06,
          0.06,
          0.06,
          0.06
        ]
      }
    ]
  },
  "logs": {
    "full_log_path": "/logs/full.log",
    "config_log_path": "/logs/config.log",
    "build_log_path": "/logs/build.log",
    "test_log_path": "/logs/test.log",
    "build_success": true,
    "test_success": true
  },
  "raw_timing_data": {
    "warmup_runs": 1,
    "measurement_runs": 30,
    "min_exec_time_improvement": 0.05,
    "min_p_value": 0.05
  }
}