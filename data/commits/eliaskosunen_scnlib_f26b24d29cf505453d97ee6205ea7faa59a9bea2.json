{
  "metadata": {
    "collection_date": "2026-02-03T20:00:23.900615",
    "repository": "https://github.com/eliaskosunen/scnlib",
    "repository_name": "eliaskosunen/scnlib"
  },
  "commit_info": {
    "old_sha": "f21b2b63edb750bf54e2470a7f4bd893d3a0b7d8",
    "new_sha": "f26b24d29cf505453d97ee6205ea7faa59a9bea2",
    "commit_message": [
      "Add fast_streq_nocase"
    ],
    "commit_date": "2024-01-09T19:02:35+00:00",
    "patch": [
      "--- src/scn/impl/algorithms/read.h\n@@ -404,52 +404,58 @@ namespace scn {\n             }\n         }\n \n+        // Ripped from fast_float\n+        inline constexpr bool fast_streq_nocase(const char* a,\n+                                                const char* b,\n+                                                size_t len)\n+        {\n+            unsigned char running_diff{0};\n+            for (size_t i = 0; i < len; ++i) {\n+                running_diff |= static_cast<unsigned char>(a[i] ^ b[i]);\n+            }\n+            return running_diff == 0 || running_diff == 32;\n+        }\n+\n         template <typename Range>\n         parse_expected<simple_borrowed_iterator_t<Range>>\n         read_matching_string_classic_nocase(Range&& range, std::string_view str)\n         {\n             using char_type = detail::char_t<Range>;\n \n-            auto ascii_tolower = [](char_type ch) -> char_type {\n-                if (ch < 'A' || ch > 'Z') {\n-                    return ch;\n+            if constexpr (ranges::contiguous_range<Range> &&\n+                          std::is_same_v<char_type, char>) {\n+                if (ranges::size(range) < str.size()) {\n+                    return unexpected(make_eof_parse_error(eof_error::eof));\n                 }\n-                return static_cast<char_type>(\n-                    ch + static_cast<char_type>('a' - 'A'));\n-            };\n-\n-            SCN_TRY(it, read_exactly_n_code_units(range, ranges::ssize(str))\n-                            .transform_error(make_eof_parse_error));\n-\n-#if 0\n-            auto buf = make_contiguous_buffer(\n-                ranges::subrange{ranges::begin(range), it});\n-\n-            if constexpr (std::is_same_v<detail::char_t<Range>, char>) {\n-                if (buf.stores_allocated_string()) {\n-                    for (auto& ch : buf.get_allocated_string()) {\n-                        ch = ascii_tolower(ch);\n-                    }\n-                    if (SCN_UNLIKELY(buf.view() != str)) {\n-                        return unexpected_scan_error(\n-                            scan_error::invalid_scanned_value,\n-                            \"read_matching_string_nocase: No match\");\n-                    }\n-\n-                    return it;\n+                if (!fast_streq_nocase(ranges::data(range), str.data(),\n+                                       str.size())) {\n+                    return unexpected(parse_error::error);\n                 }\n+                return ranges::next(ranges::begin(range), str.size());\n             }\n-#endif\n+            else {\n+                auto ascii_tolower = [](char_type ch) -> char_type {\n+                    if (ch < 'A' || ch > 'Z') {\n+                        return ch;\n+                    }\n+                    return static_cast<char_type>(\n+                        ch + static_cast<char_type>('a' - 'A'));\n+                };\n+\n+                SCN_TRY(it, read_exactly_n_code_units(range, ranges::ssize(str))\n+                                .transform_error(make_eof_parse_error));\n+\n+                if (SCN_UNLIKELY(!std::equal(\n+                        ranges::begin(range), it, str.begin(),\n+                        [&](auto a, auto b) {\n+                            return ascii_tolower(a) ==\n+                                   static_cast<detail::char_t<Range>>(b);\n+                        }))) {\n+                    return unexpected(parse_error::error);\n+                }\n \n-            if (SCN_UNLIKELY(!std::equal(\n-                    ranges::begin(range), it, str.begin(), [&](auto a, auto b) {\n-                        return ascii_tolower(a) ==\n-                               static_cast<detail::char_t<Range>>(b);\n-                    }))) {\n-                return unexpected(parse_error::error);\n+                return it;\n             }\n-\n-            return it;\n         }\n \n         template <typename Range>"
    ],
    "files_changed": [
      {
        "filename": "src/scn/impl/algorithms/read.h",
        "status": "modified",
        "additions": 41,
        "deletions": 35,
        "changes": 76,
        "patch": "@@ -404,52 +404,58 @@ namespace scn {\n             }\n         }\n \n+        // Ripped from fast_float\n+        inline constexpr bool fast_streq_nocase(const char* a,\n+                                                const char* b,\n+                                                size_t len)\n+        {\n+            unsigned char running_diff{0};\n+            for (size_t i = 0; i < len; ++i) {\n+                running_diff |= static_cast<unsigned char>(a[i] ^ b[i]);\n+            }\n+            return running_diff == 0 || running_diff == 32;\n+        }\n+\n         template <typename Range>\n         parse_expected<simple_borrowed_iterator_t<Range>>\n         read_matching_string_classic_nocase(Range&& range, std::string_view str)\n         {\n             using char_type = detail::char_t<Range>;\n \n-            auto ascii_tolower = [](char_type ch) -> char_type {\n-                if (ch < 'A' || ch > 'Z') {\n-                    return ch;\n+            if constexpr (ranges::contiguous_range<Range> &&\n+                          std::is_same_v<char_type, char>) {\n+                if (ranges::size(range) < str.size()) {\n+                    return unexpected(make_eof_parse_error(eof_error::eof));\n                 }\n-                return static_cast<char_type>(\n-                    ch + static_cast<char_type>('a' - 'A'));\n-            };\n-\n-            SCN_TRY(it, read_exactly_n_code_units(range, ranges::ssize(str))\n-                            .transform_error(make_eof_parse_error));\n-\n-#if 0\n-            auto buf = make_contiguous_buffer(\n-                ranges::subrange{ranges::begin(range), it});\n-\n-            if constexpr (std::is_same_v<detail::char_t<Range>, char>) {\n-                if (buf.stores_allocated_string()) {\n-                    for (auto& ch : buf.get_allocated_string()) {\n-                        ch = ascii_tolower(ch);\n-                    }\n-                    if (SCN_UNLIKELY(buf.view() != str)) {\n-                        return unexpected_scan_error(\n-                            scan_error::invalid_scanned_value,\n-                            \"read_matching_string_nocase: No match\");\n-                    }\n-\n-                    return it;\n+                if (!fast_streq_nocase(ranges::data(range), str.data(),\n+                                       str.size())) {\n+                    return unexpected(parse_error::error);\n                 }\n+                return ranges::next(ranges::begin(range), str.size());\n             }\n-#endif\n+            else {\n+                auto ascii_tolower = [](char_type ch) -> char_type {\n+                    if (ch < 'A' || ch > 'Z') {\n+                        return ch;\n+                    }\n+                    return static_cast<char_type>(\n+                        ch + static_cast<char_type>('a' - 'A'));\n+                };\n+\n+                SCN_TRY(it, read_exactly_n_code_units(range, ranges::ssize(str))\n+                                .transform_error(make_eof_parse_error));\n+\n+                if (SCN_UNLIKELY(!std::equal(\n+                        ranges::begin(range), it, str.begin(),\n+                        [&](auto a, auto b) {\n+                            return ascii_tolower(a) ==\n+                                   static_cast<detail::char_t<Range>>(b);\n+                        }))) {\n+                    return unexpected(parse_error::error);\n+                }\n \n-            if (SCN_UNLIKELY(!std::equal(\n-                    ranges::begin(range), it, str.begin(), [&](auto a, auto b) {\n-                        return ascii_tolower(a) ==\n-                               static_cast<detail::char_t<Range>>(b);\n-                    }))) {\n-                return unexpected(parse_error::error);\n+                return it;\n             }\n-\n-            return it;\n         }\n \n         template <typename Range>"
      }
    ],
    "lines_added": 41,
    "lines_removed": 35
  },
  "issues": [],
  "pull_requests": [],
  "build_info": {
    "old_build_script": [
      "apt-get update",
      "cmake -S /test_workspace/workspace/old -B /test_workspace/workspace/old/build -DCMAKE_BUILD_TYPE=Debug -DCMAKE_EXPORT_COMPILE_COMMANDS=ON",
      "cmake --build /test_workspace/workspace/old/build -- -j 1"
    ],
    "new_build_script": [
      "apt-get update",
      "cmake -S /test_workspace/workspace/new -B /test_workspace/workspace/new/build -DCMAKE_BUILD_TYPE=Debug -DCMAKE_EXPORT_COMPILE_COMMANDS=ON",
      "cmake --build /test_workspace/workspace/new/build -- -j 1"
    ],
    "old_test_script": [
      "cd /test_workspace/workspace/old/build",
      "ctest --output-on-failure"
    ],
    "new_test_script": [
      "cd /test_workspace/workspace/new/build",
      "ctest --output-on-failure"
    ],
    "build_system": "cmake"
  },
  "performance_analysis": {
    "is_significant": false,
    "p_value": 0.9998560248016731,
    "is_pair_significant": false,
    "pair_p_value": 0.999916436081631,
    "is_binom_significant": false,
    "binom_p_value": 0.9998375428840518,
    "is_wilcoxon_significant": false,
    "wilcoxon_p_value": 0.9999787223681741,
    "is_mannwhitney_significant": false,
    "mannwhitney_p_value": 0.6271626465677378,
    "relative_improvement": -0.007614213197969607,
    "absolute_improvement_ms": -1.0000000000000009,
    "old_mean_ms": 131.33333333333334,
    "new_mean_ms": 132.33333333333334,
    "old_std_ms": 7.30296743340222,
    "new_std_ms": 8.172001541568767,
    "effect_size_cohens_d": -0.12903766001965977,
    "old_ci95_ms": [
      128.60636047715641,
      134.06030618951027
    ],
    "new_ci95_ms": [
      129.28185780811492,
      135.38480885855176
    ],
    "old_ci99_ms": [
      127.65815212843957,
      135.0085145382271
    ],
    "new_ci99_ms": [
      128.22081513496792,
      136.44585153169874
    ],
    "new_times_s": [
      0.13,
      0.13,
      0.13,
      0.13,
      0.13,
      0.13,
      0.13,
      0.13,
      0.13,
      0.13,
      0.14,
      0.13,
      0.14,
      0.13,
      0.13,
      0.13,
      0.12,
      0.13,
      0.13,
      0.13,
      0.15,
      0.14,
      0.15,
      0.14,
      0.14,
      0.12,
      0.12,
      0.12,
      0.13,
      0.13,
      0.15
    ],
    "old_times_s": [
      0.13,
      0.13,
      0.15,
      0.13,
      0.13,
      0.14,
      0.13,
      0.13,
      0.13,
      0.13,
      0.14,
      0.13,
      0.14,
      0.14,
      0.13,
      0.13,
      0.13,
      0.12,
      0.12,
      0.14,
      0.12,
      0.13,
      0.14,
      0.14,
      0.13,
      0.12,
      0.13,
      0.12,
      0.13,
      0.13,
      0.13
    ]
  },
  "tests": {
    "total_tests": 4,
    "significant_improvements": 0,
    "significant_improvements_tests": [],
    "significant_regressions": 0,
    "significant_regressions_tests": [],
    "significant_pair_improvements": 0,
    "significant_pair_improvements_tests": [],
    "significant_pair_regressions": 0,
    "significant_pair_regressions_tests": [],
    "significant_binom_improvements": 0,
    "significant_binom_improvements_tests": [],
    "significant_binom_regressions": 0,
    "significant_binom_regressions_tests": [],
    "significant_wilcoxon_improvements": 0,
    "significant_wilcoxon_improvements_tests": [],
    "significant_wilcoxon_regressions": 0,
    "significant_wilcoxon_regressions_tests": [],
    "significant_mannwhitney_improvements": 0,
    "significant_mannwhitney_improvements_tests": [],
    "significant_mannwhitney_regressions": 0,
    "significant_mannwhitney_regressions_tests": [],
    "tests": [
      {
        "test_name": "scn_tests",
        "is_significant": false,
        "p_value": 1.0,
        "is_pair_significant": false,
        "pair_p_value": 1.0,
        "is_binom_significant": false,
        "binom_p_value": 1.0,
        "is_wilcoxon_significant": false,
        "wilcoxon_p_value": 0.9999999393422746,
        "is_mannwhitney_significant": false,
        "mannwhitney_p_value": 1.0,
        "relative_improvement": 0.0,
        "absolute_improvement_ms": 0.0,
        "old_mean_ms": 10.0,
        "new_mean_ms": 10.0,
        "old_std_ms": 0.0,
        "new_std_ms": 0.0,
        "effect_size_cohens_d": "NaN",
        "old_ci95_ms": [
          10.0,
          10.0
        ],
        "new_ci95_ms": [
          10.0,
          10.0
        ],
        "old_ci99_ms": [
          10.0,
          10.0
        ],
        "new_ci99_ms": [
          10.0,
          10.0
        ],
        "new_times": [
          0.01,
          0.01,
          0.01,
          0.01,
          0.01,
          0.01,
          0.01,
          0.01,
          0.01,
          0.01,
          0.01,
          0.01,
          0.01,
          0.01,
          0.01,
          0.01,
          0.01,
          0.01,
          0.01,
          0.01,
          0.01,
          0.01,
          0.01,
          0.01,
          0.01,
          0.01,
          0.01,
          0.01
        ],
        "old_times": [
          0.01,
          0.01,
          0.01,
          0.01,
          0.01,
          0.01,
          0.01,
          0.01,
          0.01,
          0.01,
          0.01,
          0.01,
          0.01,
          0.01,
          0.01,
          0.01,
          0.01,
          0.01,
          0.01,
          0.01,
          0.01,
          0.01,
          0.01,
          0.01,
          0.01,
          0.01,
          0.01,
          0.01
        ]
      },
      {
        "test_name": "scn_impl_tests",
        "is_significant": false,
        "p_value": 0.993840228632676,
        "is_pair_significant": false,
        "pair_p_value": 0.9904539338151978,
        "is_binom_significant": false,
        "binom_p_value": 0.9999998919665813,
        "is_wilcoxon_significant": false,
        "wilcoxon_p_value": 0.99991241521795,
        "is_mannwhitney_significant": false,
        "mannwhitney_p_value": 0.5219573501804341,
        "relative_improvement": -0.008771929824561216,
        "absolute_improvement_ms": -0.3571428571428614,
        "old_mean_ms": 40.714285714285715,
        "new_mean_ms": 41.07142857142858,
        "old_std_ms": 2.622652641564811,
        "new_std_ms": 4.162696521251859,
        "effect_size_cohens_d": -0.10265788662437447,
        "old_ci95_ms": [
          39.69732718504189,
          41.73124424352954
        ],
        "new_ci95_ms": [
          39.45730336672177,
          42.685553776135386
        ],
        "old_ci99_ms": [
          39.34103892687132,
          42.08753250170012
        ],
        "new_ci99_ms": [
          38.89179962087891,
          43.25105752197824
        ],
        "new_times": [
          0.04,
          0.04,
          0.04,
          0.04,
          0.04,
          0.04,
          0.04,
          0.04,
          0.04,
          0.04,
          0.04,
          0.04,
          0.04,
          0.04,
          0.04,
          0.04,
          0.04,
          0.06,
          0.04,
          0.04,
          0.04,
          0.04,
          0.04,
          0.04,
          0.04,
          0.04,
          0.04,
          0.05
        ],
        "old_times": [
          0.04,
          0.04,
          0.04,
          0.04,
          0.04,
          0.04,
          0.04,
          0.05,
          0.04,
          0.04,
          0.04,
          0.04,
          0.04,
          0.04,
          0.04,
          0.04,
          0.05,
          0.04,
          0.04,
          0.04,
          0.04,
          0.04,
          0.04,
          0.04,
          0.04,
          0.04,
          0.04,
          0.04
        ]
      },
      {
        "test_name": "scn_stdin_test",
        "is_significant": false,
        "p_value": 1.0,
        "is_pair_significant": false,
        "pair_p_value": 1.0,
        "is_binom_significant": false,
        "binom_p_value": 1.0,
        "is_wilcoxon_significant": false,
        "wilcoxon_p_value": 0.9999999393422746,
        "is_mannwhitney_significant": false,
        "mannwhitney_p_value": 1.0,
        "relative_improvement": 0.0,
        "absolute_improvement_ms": 0.0,
        "old_mean_ms": 30.000000000000004,
        "new_mean_ms": 30.000000000000004,
        "old_std_ms": 3.5331118393247232e-15,
        "new_std_ms": 3.5331118393247232e-15,
        "effect_size_cohens_d": 0.0,
        "old_ci95_ms": [
          30.000000000000004,
          30.000000000000004
        ],
        "new_ci95_ms": [
          30.000000000000004,
          30.000000000000004
        ],
        "old_ci99_ms": [
          30.0,
          30.000000000000007
        ],
        "new_ci99_ms": [
          30.0,
          30.000000000000007
        ],
        "new_times": [
          0.03,
          0.03,
          0.03,
          0.03,
          0.03,
          0.03,
          0.03,
          0.03,
          0.03,
          0.03,
          0.03,
          0.03,
          0.03,
          0.03,
          0.03,
          0.03,
          0.03,
          0.03,
          0.03,
          0.03,
          0.03,
          0.03,
          0.03,
          0.03,
          0.03,
          0.03,
          0.03,
          0.03
        ],
        "old_times": [
          0.03,
          0.03,
          0.03,
          0.03,
          0.03,
          0.03,
          0.03,
          0.03,
          0.03,
          0.03,
          0.03,
          0.03,
          0.03,
          0.03,
          0.03,
          0.03,
          0.03,
          0.03,
          0.03,
          0.03,
          0.03,
          0.03,
          0.03,
          0.03,
          0.03,
          0.03,
          0.03,
          0.03
        ]
      },
      {
        "test_name": "scn_examples_test",
        "is_significant": false,
        "p_value": 0.9974434595759603,
        "is_pair_significant": false,
        "pair_p_value": 0.9999992868697211,
        "is_binom_significant": false,
        "binom_p_value": 0.9999999962747097,
        "is_wilcoxon_significant": false,
        "wilcoxon_p_value": 0.999996441056723,
        "is_mannwhitney_significant": false,
        "mannwhitney_p_value": 0.32713652976287044,
        "relative_improvement": 0.006993006993006998,
        "absolute_improvement_ms": 0.3571428571428614,
        "old_mean_ms": 51.071428571428584,
        "new_mean_ms": 50.71428571428572,
        "old_std_ms": 3.1497039417435593,
        "new_std_ms": 2.6226526415648097,
        "effect_size_cohens_d": 0.12322987381221895,
        "old_ci95_ms": [
          49.85010088304746,
          52.292756259809714
        ],
        "new_ci95_ms": [
          49.69732718504191,
          51.731244243529545
        ],
        "old_ci99_ms": [
          49.42221252552282,
          52.72064461733435
        ],
        "new_ci99_ms": [
          49.34103892687133,
          52.087532501700124
        ],
        "new_times": [
          0.05,
          0.05,
          0.05,
          0.05,
          0.05,
          0.05,
          0.05,
          0.05,
          0.05,
          0.05,
          0.05,
          0.05,
          0.05,
          0.05,
          0.05,
          0.05,
          0.05,
          0.05,
          0.05,
          0.06,
          0.06,
          0.05,
          0.05,
          0.05,
          0.05,
          0.05,
          0.05,
          0.05
        ],
        "old_times": [
          0.05,
          0.05,
          0.05,
          0.05,
          0.05,
          0.05,
          0.05,
          0.05,
          0.05,
          0.05,
          0.06,
          0.05,
          0.05,
          0.05,
          0.05,
          0.05,
          0.05,
          0.05,
          0.05,
          0.06,
          0.06,
          0.05,
          0.05,
          0.05,
          0.05,
          0.05,
          0.05,
          0.05
        ]
      }
    ]
  },
  "logs": {
    "full_log_path": "/logs/full.log",
    "config_log_path": "/logs/config.log",
    "build_log_path": "/logs/build.log",
    "test_log_path": "/logs/test.log",
    "build_success": true,
    "test_success": true
  },
  "raw_timing_data": {
    "warmup_runs": 1,
    "measurement_runs": 30,
    "min_exec_time_improvement": 0.05,
    "min_p_value": 0.05
  }
}