{
  "metadata": {
    "collection_date": "2026-01-14T18:37:10.728488",
    "repository": "https://github.com/gabime/spdlog",
    "repository_name": "gabime/spdlog"
  },
  "commit_info": {
    "old_sha": "3f438a80842fd19cc3633d08d1e8db161da3bbe7",
    "new_sha": "2989e998ee21308c8a58b2edf207f679061a8f3f",
    "commit_message": [
      "Speed up pattern_formatter"
    ],
    "commit_date": "2018-06-13T15:47:02+00:00",
    "patch": [
      "--- include/spdlog/details/pattern_formatter_impl.h\n@@ -20,7 +20,7 @@\n #include <utility>\n #include <vector>\n \n-namespace {\n+namespace { // Some fmt helpers to efficiently format and pad ints and strings\n inline void append_str(const std::string &str, fmt::memory_buffer &dest)\n {\n     const char *str_ptr = str.data();\n@@ -47,35 +47,87 @@ inline void append_size_t(size_t n, fmt::memory_buffer &dest)\n \n inline void append_and_pad2(int n, fmt::memory_buffer &dest)\n {\n-\n-    if (n < 0) // should not happen in this formatter, but just in case, let fmt deal with negatives correctly\n+    if (n > 9)\n     {\n-        fmt::format_to(dest, \"{:02}\", n);\n+        append_int(n, dest);\n         return;\n     }\n-    if (n < 10)\n+    if (n >= 0) // 0-9\n     {\n         dest.push_back('0');\n+        append_int(n, dest);\n+        return;\n     }\n-    append_int(n, dest);\n+    // negatives (unlikely but just in case, let fmt deal with it)\n+    fmt::format_to(dest, \"{:02}\", n);\n }\n \n inline void append_and_pad3(int n, fmt::memory_buffer &dest)\n {\n+    if (n > 99)\n+    {\n+        append_int(n, dest);\n+        return;\n+    }\n+    if (n > 9) // 10-99\n+    {\n+        dest.push_back('0');\n+        append_int(n, dest);\n+        return;\n+    }\n+    if (n >= 0)\n+    {\n+        dest.push_back('0');\n+        dest.push_back('0');\n+        append_int(n, dest);\n+        return;\n+    }\n+    // negatives (unlikely, but just in case let fmt deal with it)\n+    fmt::format_to(dest, \"{:03}\", n);\n+}\n \n-    if (n < 0) // should not happen in this formatter, but just in case, let fmt deal with negatives correctly\n+void append_and_pad6(int n, fmt::memory_buffer &dest)\n+{\n+    if (n > 99999)\n     {\n-        fmt::format_to(dest, \"{:03}\", n);\n+        append_int(n, dest);\n         return;\n     }\n-    if (n < 10)\n+    if (n > 9999)\n+    {\n+        dest.push_back('0');\n+    }\n+\n+    else if (n > 999)\n     {\n         dest.push_back('0');\n         dest.push_back('0');\n     }\n-    else if (n < 100)\n+    else if (n > 99)\n     {\n         dest.push_back('0');\n+        dest.push_back('0');\n+        dest.push_back('0');\n+    }\n+    else if (n > 9)\n+    {\n+        dest.push_back('0');\n+        dest.push_back('0');\n+        dest.push_back('0');\n+        dest.push_back('0');\n+    }\n+    else if (n >= 0)\n+    {\n+        dest.push_back('0');\n+        dest.push_back('0');\n+        dest.push_back('0');\n+        dest.push_back('0');\n+        dest.push_back('0');\n+    }\n+    else // negatives (unlikely, but just in case let fmt deal with it)\n+    {\n+        fmt::format_to(dest, \"{:06}\", n);\n+        return;\n     }\n     append_int(n, dest);\n }\n@@ -309,7 +361,7 @@ class f_formatter SPDLOG_FINAL : public flag_formatter\n     {\n         auto duration = msg.time.time_since_epoch();\n         auto micros = std::chrono::duration_cast<std::chrono::microseconds>(duration).count() % 1000000;\n-        fmt::format_to(msg.formatted, \"{:06}\", static_cast<int>(micros));\n+        append_and_pad6(static_cast<int>(micros), msg.formatted);\n     }\n };\n \n@@ -544,9 +596,7 @@ class full_formatter SPDLOG_FINAL : public flag_formatter\n         //            tm_time.tm_mday, tm_time.tm_hour, tm_time.tm_min, tm_time.tm_sec, static_cast<int>(millis));\n \n         msg.formatted.push_back('[');\n-\n-        fmt::format_int i(tm_time.tm_year + 1900);\n-        msg.formatted.append(i.data(), i.data() + i.size());\n+        append_int(tm_time.tm_year + 1900, msg.formatted);\n         msg.formatted.push_back('-');\n \n         append_and_pad2(tm_time.tm_mon + 1, msg.formatted);"
    ],
    "files_changed": [
      {
        "filename": "include/spdlog/details/pattern_formatter_impl.h",
        "status": "modified",
        "additions": 64,
        "deletions": 14,
        "changes": 78,
        "patch": "@@ -20,7 +20,7 @@\n #include <utility>\n #include <vector>\n \n-namespace {\n+namespace { // Some fmt helpers to efficiently format and pad ints and strings\n inline void append_str(const std::string &str, fmt::memory_buffer &dest)\n {\n     const char *str_ptr = str.data();\n@@ -47,35 +47,87 @@ inline void append_size_t(size_t n, fmt::memory_buffer &dest)\n \n inline void append_and_pad2(int n, fmt::memory_buffer &dest)\n {\n-\n-    if (n < 0) // should not happen in this formatter, but just in case, let fmt deal with negatives correctly\n+    if (n > 9)\n     {\n-        fmt::format_to(dest, \"{:02}\", n);\n+        append_int(n, dest);\n         return;\n     }\n-    if (n < 10)\n+    if (n >= 0) // 0-9\n     {\n         dest.push_back('0');\n+        append_int(n, dest);\n+        return;\n     }\n-    append_int(n, dest);\n+    // negatives (unlikely but just in case, let fmt deal with it)\n+    fmt::format_to(dest, \"{:02}\", n);\n }\n \n inline void append_and_pad3(int n, fmt::memory_buffer &dest)\n {\n+    if (n > 99)\n+    {\n+        append_int(n, dest);\n+        return;\n+    }\n+    if (n > 9) // 10-99\n+    {\n+        dest.push_back('0');\n+        append_int(n, dest);\n+        return;\n+    }\n+    if (n >= 0)\n+    {\n+        dest.push_back('0');\n+        dest.push_back('0');\n+        append_int(n, dest);\n+        return;\n+    }\n+    // negatives (unlikely, but just in case let fmt deal with it)\n+    fmt::format_to(dest, \"{:03}\", n);\n+}\n \n-    if (n < 0) // should not happen in this formatter, but just in case, let fmt deal with negatives correctly\n+void append_and_pad6(int n, fmt::memory_buffer &dest)\n+{\n+    if (n > 99999)\n     {\n-        fmt::format_to(dest, \"{:03}\", n);\n+        append_int(n, dest);\n         return;\n     }\n-    if (n < 10)\n+    if (n > 9999)\n+    {\n+        dest.push_back('0');\n+    }\n+\n+    else if (n > 999)\n     {\n         dest.push_back('0');\n         dest.push_back('0');\n     }\n-    else if (n < 100)\n+    else if (n > 99)\n     {\n         dest.push_back('0');\n+        dest.push_back('0');\n+        dest.push_back('0');\n+    }\n+    else if (n > 9)\n+    {\n+        dest.push_back('0');\n+        dest.push_back('0');\n+        dest.push_back('0');\n+        dest.push_back('0');\n+    }\n+    else if (n >= 0)\n+    {\n+        dest.push_back('0');\n+        dest.push_back('0');\n+        dest.push_back('0');\n+        dest.push_back('0');\n+        dest.push_back('0');\n+    }\n+    else // negatives (unlikely, but just in case let fmt deal with it)\n+    {\n+        fmt::format_to(dest, \"{:06}\", n);\n+        return;\n     }\n     append_int(n, dest);\n }\n@@ -309,7 +361,7 @@ class f_formatter SPDLOG_FINAL : public flag_formatter\n     {\n         auto duration = msg.time.time_since_epoch();\n         auto micros = std::chrono::duration_cast<std::chrono::microseconds>(duration).count() % 1000000;\n-        fmt::format_to(msg.formatted, \"{:06}\", static_cast<int>(micros));\n+        append_and_pad6(static_cast<int>(micros), msg.formatted);\n     }\n };\n \n@@ -544,9 +596,7 @@ class full_formatter SPDLOG_FINAL : public flag_formatter\n         //            tm_time.tm_mday, tm_time.tm_hour, tm_time.tm_min, tm_time.tm_sec, static_cast<int>(millis));\n \n         msg.formatted.push_back('[');\n-\n-        fmt::format_int i(tm_time.tm_year + 1900);\n-        msg.formatted.append(i.data(), i.data() + i.size());\n+        append_int(tm_time.tm_year + 1900, msg.formatted);\n         msg.formatted.push_back('-');\n \n         append_and_pad2(tm_time.tm_mon + 1, msg.formatted);"
      }
    ],
    "lines_added": 64,
    "lines_removed": 14
  },
  "issues": [],
  "pull_requests": [],
  "build_info": {
    "old_build_script": "#!/bin/bash\n#!/bin/bash\ncmake --build /test_workspace/workspace/old/build -- -j 1",
    "new_build_script": "#!/bin/bash\n#!/bin/bash\ncmake --build /test_workspace/workspace/old/build -- -j 1",
    "old_test_script": "#!/bin/bash\ncmake -S /test_workspace/workspace/old -B /test_workspace/workspace/old/build -DCMAKE_BUILD_TYPE=Debug -DCMAKE_EXPORT_COMPILE_COMMANDS=ON -DBUILD_TESTING=ON -DSPDLOG_BUILD_TESTING=ON",
    "new_test_script": "#!/bin/bash\ncmake -S /test_workspace/workspace/old -B /test_workspace/workspace/old/build -DCMAKE_BUILD_TYPE=Debug -DCMAKE_EXPORT_COMPILE_COMMANDS=ON -DBUILD_TESTING=ON -DSPDLOG_BUILD_TESTING=ON",
    "build_system": "cmake"
  },
  "performance_analysis": {
    "is_significant": false,
    "p_value": 1.0,
    "is_pair_significant": false,
    "pair_p_value": 1.0,
    "is_binom_significant": false,
    "binom_p_value": 1.0,
    "is_wilcoxon_significant": false,
    "wilcoxon_p_value": 0.9999999492777686,
    "is_mannwhitney_significant": false,
    "mannwhitney_p_value": 0.5,
    "relative_improvement": 0.0003918495297806255,
    "absolute_improvement_ms": 0.33333333333340764,
    "old_mean_ms": 850.6666666666669,
    "new_mean_ms": 850.3333333333335,
    "old_std_ms": 3.65148371670111,
    "new_std_ms": 1.8257418583505556,
    "effect_size_cohens_d": 0.1154700538379508,
    "old_ci95_ms": [
      849.3031802385784,
      852.0301530947554
    ],
    "new_ci95_ms": [
      849.6515901192893,
      851.0150765473777
    ],
    "old_ci99_ms": [
      848.82907606422,
      852.5042572691139
    ],
    "new_ci99_ms": [
      849.41453803211,
      851.2521286345569
    ],
    "new_times_s": [
      0.85,
      0.85,
      0.85,
      0.85,
      0.85,
      0.85,
      0.85,
      0.85,
      0.85,
      0.85,
      0.85,
      0.85,
      0.85,
      0.86,
      0.85,
      0.85,
      0.85,
      0.85,
      0.85,
      0.85,
      0.85,
      0.85,
      0.85,
      0.85,
      0.85,
      0.85,
      0.85,
      0.85,
      0.85,
      0.85,
      0.85
    ],
    "old_times_s": [
      0.85,
      0.85,
      0.85,
      0.85,
      0.85,
      0.85,
      0.85,
      0.85,
      0.85,
      0.85,
      0.87,
      0.85,
      0.85,
      0.85,
      0.85,
      0.85,
      0.85,
      0.85,
      0.85,
      0.85,
      0.85,
      0.85,
      0.85,
      0.85,
      0.85,
      0.85,
      0.85,
      0.85,
      0.85,
      0.85,
      0.85
    ]
  },
  "tests": {
    "total_tests": 1,
    "significant_improvements": 0,
    "significant_improvements_tests": [],
    "significant_regressions": 0,
    "significant_regressions_tests": [],
    "significant_pair_improvements": 0,
    "significant_pair_improvements_tests": [],
    "significant_pair_regressions": 0,
    "significant_pair_regressions_tests": [],
    "significant_binom_improvements": 0,
    "significant_binom_improvements_tests": [],
    "significant_binom_regressions": 0,
    "significant_binom_regressions_tests": [],
    "significant_wilcoxon_improvements": 0,
    "significant_wilcoxon_improvements_tests": [],
    "significant_wilcoxon_regressions": 0,
    "significant_wilcoxon_regressions_tests": [],
    "significant_mannwhitney_improvements": 0,
    "significant_mannwhitney_improvements_tests": [],
    "significant_mannwhitney_regressions": 0,
    "significant_mannwhitney_regressions_tests": [],
    "tests": [
      {
        "test_name": "spdlog-utests",
        "is_significant": false,
        "p_value": 1.0,
        "is_pair_significant": false,
        "pair_p_value": 1.0,
        "is_binom_significant": false,
        "binom_p_value": 1.0,
        "is_wilcoxon_significant": false,
        "wilcoxon_p_value": 0.999999879927666,
        "is_mannwhitney_significant": false,
        "mannwhitney_p_value": 0.2852723763689472,
        "relative_improvement": 0.0008107012565869305,
        "absolute_improvement_ms": 0.6896551724138167,
        "old_mean_ms": 850.6896551724141,
        "new_mean_ms": 850.0000000000002,
        "old_std_ms": 3.7139067635410417,
        "new_std_ms": 2.672612419124246,
        "effect_size_cohens_d": 0.21315746638735514,
        "old_ci95_ms": [
          849.2769605918655,
          852.1023497529625
        ],
        "new_ci95_ms": [
          848.9833926049337,
          851.0166073950667
        ],
        "old_ci99_ms": [
          848.7839569272685,
          852.5953534175595
        ],
        "new_ci99_ms": [
          848.6286158696611,
          851.3713841303393
        ],
        "new_times": [
          0.85,
          0.85,
          0.85,
          0.85,
          0.84,
          0.85,
          0.85,
          0.85,
          0.85,
          0.85,
          0.85,
          0.86,
          0.85,
          0.85,
          0.85,
          0.85,
          0.85,
          0.85,
          0.85,
          0.85,
          0.85,
          0.85,
          0.85,
          0.85,
          0.85,
          0.85,
          0.85,
          0.85,
          0.85
        ],
        "old_times": [
          0.85,
          0.85,
          0.85,
          0.85,
          0.85,
          0.85,
          0.85,
          0.85,
          0.87,
          0.85,
          0.85,
          0.85,
          0.85,
          0.85,
          0.85,
          0.85,
          0.85,
          0.85,
          0.85,
          0.85,
          0.85,
          0.85,
          0.85,
          0.85,
          0.85,
          0.85,
          0.85,
          0.85,
          0.85
        ]
      }
    ]
  },
  "logs": {
    "full_log_path": "/logs/full.log",
    "config_log_path": "/logs/config.log",
    "build_log_path": "/logs/build.log",
    "test_log_path": "/logs/test.log",
    "build_success": true,
    "test_success": true
  },
  "raw_timing_data": {
    "warmup_runs": 1,
    "measurement_runs": 30,
    "min_exec_time_improvement": 0.05,
    "min_p_value": 0.05
  }
}