{
    "metadata": {
        "collection_date": "2026-01-14T18:38:00.719280",
        "repository": "https://github.com/quick-lint/quick-lint-js",
        "repository_name": "quick-lint/quick-lint-js"
    },
    "commit_info": {
        "old_sha": "ea3a56ad7d2b5912fd229c99e008a7c578d1d19c",
        "new_sha": "182806419a62d94ca57f359ba99c10accdb0a66c",
        "commit_message": [
            "Reduce copying of expression* arrays\n\nThe bump_vector data is already allocated on the expression heap. Avoid\ncopying it unnecessarily.\n\nThis improves parsing performance by 1-2% on my AArch64 Mac:\n\n    Benchmark                                     Time             CPU      Time Old      Time New       CPU Old       CPU New\n    --------------------------------------------------------------------------------------------------------------------------\n    benchmark_parse_file_pvalue                 0.0002          0.0002      U Test, Repetitions: 10 vs 10\n    benchmark_parse_file_mean                  -0.0170         -0.0170       1352391       1329424       1352060       1329142\n    benchmark_parse_file_median                -0.0156         -0.0157       1351245       1330121       1351025       1329829\n    benchmark_parse_file_stddev                -0.5699         -0.5908          5614          2414          5529          2262"
        ],
        "commit_date": "2021-12-28T10:00:31+00:00",
        "patch": [
            "--- src/quick-lint-js/expression.h\n@@ -304,11 +304,10 @@ expression *expression_arena::make_expression(Args &&... args) {\n template <class T>\n inline expression_arena::array_ptr<T> expression_arena::make_array(\n     bump_vector<T, monotonic_allocator> &&elements) {\n-  // TODO(strager): Adopt the pointer if the elements.allocator_ is our\n-  // allocator.\n-  array_ptr<T> result =\n-      this->make_array(elements.data(), elements.data() + elements.size());\n-  elements.clear();\n+  QLJS_ASSERT(elements.get_allocator() == &this->allocator_);\n+  // NOTE(strager): Adopt the pointer instead of copying.\n+  array_ptr<T> result(elements.data(), narrow_cast<int>(elements.size()));\n+  elements.release();\n   return result;\n }\n \n--- src/quick-lint-js/vector-profiler.h\n@@ -153,6 +153,10 @@ class instrumented_vector {\n     this->add_instrumentation_entry(vector_instrumentation::event::destroy);\n   }\n \n+  QLJS_FORCE_INLINE allocator_type get_allocator() const noexcept {\n+    return this->data_.get_allocator();\n+  }\n+\n   QLJS_FORCE_INLINE value_type *data() noexcept { return this->data_.data(); }\n   QLJS_FORCE_INLINE const value_type *data() const noexcept {\n     return this->data_.data();\n@@ -198,6 +202,9 @@ class instrumented_vector {\n \n   void reserve(std::size_t new_capacity) { this->data_.reserve(new_capacity); }\n \n+  // NOTE(strager): This is a non-standard function.\n+  void release() { this->data_.release(); }\n+\n  private:\n   QLJS_FORCE_INLINE void add_instrumentation_entry(\n       vector_instrumentation::event event) {\n--- src/quick-lint-js/vector.h\n@@ -67,8 +67,12 @@ class uninstrumented_vector : private Vector {\n   using Vector::empty;\n   using Vector::end;\n   using Vector::front;\n+  using Vector::get_allocator;\n   using Vector::reserve;\n   using Vector::size;\n+\n+  // NOTE(strager): This is a non-standard function.\n+  using Vector::release;\n };\n \n template <class T, class BumpAllocator>\n@@ -95,6 +99,8 @@ class raw_bump_vector {\n \n   ~raw_bump_vector() { this->clear(); }\n \n+  BumpAllocator *get_allocator() const noexcept { return this->allocator_; }\n+\n   bool empty() const noexcept { return this->data_ == this->data_end_; }\n   std::size_t size() const noexcept {\n     return narrow_cast<std::size_t>(this->data_end_ - this->data_);\n@@ -161,16 +167,22 @@ class raw_bump_vector {\n     return result;\n   }\n \n+  // Like clear(), but doesn't touch the allocated memory. Objects remain alive\n+  // and valid.\n+  void release() {\n+    this->data_ = nullptr;\n+    this->data_end_ = nullptr;\n+    this->capacity_end_ = nullptr;\n+  }\n+\n   void clear() {\n     if (this->data_) {\n       std::destroy(this->data_, this->data_end_);\n       this->allocator_->deallocate(\n           this->data_,\n           narrow_cast<std::size_t>(this->data_end_ - this->data_) * sizeof(T),\n           alignof(T));\n-      this->data_ = nullptr;\n-      this->data_end_ = nullptr;\n-      this->capacity_end_ = nullptr;\n+      this->release();\n     }\n   }\n "
        ],
        "files_changed": [
            {
                "filename": "src/quick-lint-js/expression.h",
                "status": "modified",
                "additions": 4,
                "deletions": 5,
                "changes": 9,
                "patch": "@@ -304,11 +304,10 @@ expression *expression_arena::make_expression(Args &&... args) {\n template <class T>\n inline expression_arena::array_ptr<T> expression_arena::make_array(\n     bump_vector<T, monotonic_allocator> &&elements) {\n-  // TODO(strager): Adopt the pointer if the elements.allocator_ is our\n-  // allocator.\n-  array_ptr<T> result =\n-      this->make_array(elements.data(), elements.data() + elements.size());\n-  elements.clear();\n+  QLJS_ASSERT(elements.get_allocator() == &this->allocator_);\n+  // NOTE(strager): Adopt the pointer instead of copying.\n+  array_ptr<T> result(elements.data(), narrow_cast<int>(elements.size()));\n+  elements.release();\n   return result;\n }\n "
            },
            {
                "filename": "src/quick-lint-js/vector-profiler.h",
                "status": "modified",
                "additions": 7,
                "deletions": 0,
                "changes": 7,
                "patch": "@@ -153,6 +153,10 @@ class instrumented_vector {\n     this->add_instrumentation_entry(vector_instrumentation::event::destroy);\n   }\n \n+  QLJS_FORCE_INLINE allocator_type get_allocator() const noexcept {\n+    return this->data_.get_allocator();\n+  }\n+\n   QLJS_FORCE_INLINE value_type *data() noexcept { return this->data_.data(); }\n   QLJS_FORCE_INLINE const value_type *data() const noexcept {\n     return this->data_.data();\n@@ -198,6 +202,9 @@ class instrumented_vector {\n \n   void reserve(std::size_t new_capacity) { this->data_.reserve(new_capacity); }\n \n+  // NOTE(strager): This is a non-standard function.\n+  void release() { this->data_.release(); }\n+\n  private:\n   QLJS_FORCE_INLINE void add_instrumentation_entry(\n       vector_instrumentation::event event) {"
            },
            {
                "filename": "src/quick-lint-js/vector.h",
                "status": "modified",
                "additions": 15,
                "deletions": 3,
                "changes": 18,
                "patch": "@@ -67,8 +67,12 @@ class uninstrumented_vector : private Vector {\n   using Vector::empty;\n   using Vector::end;\n   using Vector::front;\n+  using Vector::get_allocator;\n   using Vector::reserve;\n   using Vector::size;\n+\n+  // NOTE(strager): This is a non-standard function.\n+  using Vector::release;\n };\n \n template <class T, class BumpAllocator>\n@@ -95,6 +99,8 @@ class raw_bump_vector {\n \n   ~raw_bump_vector() { this->clear(); }\n \n+  BumpAllocator *get_allocator() const noexcept { return this->allocator_; }\n+\n   bool empty() const noexcept { return this->data_ == this->data_end_; }\n   std::size_t size() const noexcept {\n     return narrow_cast<std::size_t>(this->data_end_ - this->data_);\n@@ -161,16 +167,22 @@ class raw_bump_vector {\n     return result;\n   }\n \n+  // Like clear(), but doesn't touch the allocated memory. Objects remain alive\n+  // and valid.\n+  void release() {\n+    this->data_ = nullptr;\n+    this->data_end_ = nullptr;\n+    this->capacity_end_ = nullptr;\n+  }\n+\n   void clear() {\n     if (this->data_) {\n       std::destroy(this->data_, this->data_end_);\n       this->allocator_->deallocate(\n           this->data_,\n           narrow_cast<std::size_t>(this->data_end_ - this->data_) * sizeof(T),\n           alignof(T));\n-      this->data_ = nullptr;\n-      this->data_end_ = nullptr;\n-      this->capacity_end_ = nullptr;\n+      this->release();\n     }\n   }\n "
            }
        ],
        "lines_added": 26,
        "lines_removed": 8
    },
    "issues": [],
    "pull_requests": [],
    "build_info": {
        "old_build_script": [
            "apt-get update",
            "cmake -S /test_workspace/workspace/old -B /test_workspace/workspace/old/build -DCMAKE_BUILD_TYPE=Debug -DCMAKE_EXPORT_COMPILE_COMMANDS=ON -DBENCHMARK_ENABLE_ASSEMBLY_TESTS=ON -DBUILD_TESTING=ON -DBENCHMARK_ENABLE_GTEST_TESTS=ON -DBENCHMARK_ENABLE_TESTING=ON",
            "cmake --build /test_workspace/workspace/old/build -- -j 1"
        ],
        "new_build_script": [
            "apt-get update",
            "cmake -S /test_workspace/workspace/new -B /test_workspace/workspace/new/build -DCMAKE_BUILD_TYPE=Debug -DCMAKE_EXPORT_COMPILE_COMMANDS=ON -DBENCHMARK_ENABLE_ASSEMBLY_TESTS=ON -DBUILD_TESTING=ON -DBENCHMARK_ENABLE_GTEST_TESTS=ON -DBENCHMARK_ENABLE_TESTING=ON",
            "cmake --build /test_workspace/workspace/new/build -- -j 1"
        ],
        "old_test_script": [
            "cd /test_workspace/workspace/old/build",
            "ctest --output-on-failure"
        ],
        "new_test_script": [
            "cd /test_workspace/workspace/new/build",
            "ctest --output-on-failure"
        ],
        "build_system": "cmake"
    },
    "performance_analysis": {
        "is_significant": false,
        "p_value": 1.0,
        "is_pair_significant": false,
        "pair_p_value": 0.999999999999635,
        "is_binom_significant": false,
        "binom_p_value": 0.9999999990686774,
        "is_wilcoxon_significant": false,
        "wilcoxon_p_value": 0.9999991047370737,
        "is_mannwhitney_significant": false,
        "mannwhitney_p_value": 0.7398460402296012,
        "relative_improvement": -0.0009797517962116635,
        "absolute_improvement_ms": -0.9999999999998899,
        "old_mean_ms": 1020.6666666666669,
        "new_mean_ms": 1021.6666666666667,
        "old_std_ms": 15.521583045227233,
        "new_std_ms": 13.152509484776155,
        "effect_size_cohens_d": -0.06951252486838964,
        "old_ci95_ms": [
            1014.8708123053784,
            1026.4625210279553
        ],
        "new_ci95_ms": [
            1016.7554389112822,
            1026.5778944220513
        ],
        "old_ci99_ms": [
            1012.8555089697138,
            1028.47782436362
        ],
        "new_ci99_ms": [
            1015.0477331856615,
            1028.2856001476719
        ],
        "new_times_s": [
            1.04,
            1.01,
            1.01,
            1.01,
            1.0,
            1.01,
            1.03,
            1.02,
            1.03,
            1.01,
            1.0,
            1.03,
            1.03,
            1.02,
            1.01,
            1.02,
            1.05,
            1.04,
            1.03,
            1.02,
            1.03,
            1.01,
            1.02,
            1.03,
            1.04,
            1.03,
            1.01,
            1.02,
            1.02,
            1.05,
            1.01
        ],
        "old_times_s": [
            1.02,
            1.02,
            1.02,
            1.01,
            1.03,
            1.01,
            1.02,
            1.05,
            1.01,
            1.01,
            1.03,
            1.03,
            1.02,
            1.02,
            1.02,
            1.02,
            1.01,
            1.02,
            1.02,
            1.01,
            1.0,
            1.02,
            1.04,
            1.02,
            1.01,
            1.0,
            1.03,
            1.02,
            1.01,
            1.01,
            1.08
        ]
    },
    "tests": {
        "total_tests": 2,
        "significant_improvements": 0,
        "significant_improvements_tests": [],
        "significant_regressions": 0,
        "significant_regressions_tests": [],
        "significant_pair_improvements": 0,
        "significant_pair_improvements_tests": [],
        "significant_pair_regressions": 0,
        "significant_pair_regressions_tests": [],
        "significant_binom_improvements": 0,
        "significant_binom_improvements_tests": [],
        "significant_binom_regressions": 0,
        "significant_binom_regressions_tests": [],
        "significant_wilcoxon_improvements": 0,
        "significant_wilcoxon_improvements_tests": [],
        "significant_wilcoxon_regressions": 0,
        "significant_wilcoxon_regressions_tests": [],
        "significant_mannwhitney_improvements": 0,
        "significant_mannwhitney_improvements_tests": [],
        "significant_mannwhitney_regressions": 0,
        "significant_mannwhitney_regressions_tests": [],
        "tests": [
            {
                "test_name": "quick-lint-js-test",
                "is_significant": false,
                "p_value": 0.9999999999941838,
                "is_pair_significant": false,
                "pair_p_value": 0.9999999997717672,
                "is_binom_significant": false,
                "binom_p_value": 0.9999999981373549,
                "is_wilcoxon_significant": false,
                "wilcoxon_p_value": 0.9999943087667942,
                "is_mannwhitney_significant": false,
                "mannwhitney_p_value": 0.7014646807480605,
                "relative_improvement": 0.0010775862068965287,
                "absolute_improvement_ms": 0.3448275862067973,
                "old_mean_ms": 319.99999999999994,
                "new_mean_ms": 319.65517241379314,
                "old_std_ms": 8.451542547285165,
                "new_std_ms": 4.987669525002678,
                "effect_size_cohens_d": 0.04969259057961698,
                "old_ci95_ms": [
                    316.7852051454192,
                    323.2147948545807
                ],
                "new_ci95_ms": [
                    317.75796439104255,
                    321.5523804365438
                ],
                "old_ci99_ms": [
                    315.6633026011191,
                    324.3366973988808
                ],
                "new_ci99_ms": [
                    317.0958747075414,
                    322.21447012004495
                ],
                "new_times": [
                    0.32,
                    0.31,
                    0.31,
                    0.31,
                    0.32,
                    0.32,
                    0.33,
                    0.32,
                    0.32,
                    0.32,
                    0.32,
                    0.32,
                    0.32,
                    0.32,
                    0.32,
                    0.32,
                    0.32,
                    0.31,
                    0.32,
                    0.32,
                    0.32,
                    0.33,
                    0.32,
                    0.32,
                    0.32,
                    0.32,
                    0.32,
                    0.33,
                    0.32
                ],
                "old_times": [
                    0.32,
                    0.31,
                    0.31,
                    0.32,
                    0.32,
                    0.32,
                    0.32,
                    0.32,
                    0.32,
                    0.31,
                    0.32,
                    0.32,
                    0.32,
                    0.32,
                    0.32,
                    0.32,
                    0.32,
                    0.32,
                    0.31,
                    0.32,
                    0.32,
                    0.32,
                    0.32,
                    0.32,
                    0.32,
                    0.32,
                    0.32,
                    0.32,
                    0.36
                ]
            },
            {
                "test_name": "quick-lint-js-test-cli",
                "is_significant": false,
                "p_value": 0.9999999830573391,
                "is_pair_significant": false,
                "pair_p_value": 0.9999999830573391,
                "is_binom_significant": false,
                "binom_p_value": 1.0,
                "is_wilcoxon_significant": false,
                "wilcoxon_p_value": 0.9999999431363717,
                "is_mannwhitney_significant": false,
                "mannwhitney_p_value": 0.8495447335324144,
                "relative_improvement": -0.007662835249042153,
                "absolute_improvement_ms": -0.6896551724137889,
                "old_mean_ms": 89.99999999999999,
                "new_mean_ms": 90.68965517241377,
                "old_std_ms": 1.4123431441001795e-14,
                "new_std_ms": 3.7139067635410385,
                "effect_size_cohens_d": -0.2626128657194435,
                "old_ci95_ms": [
                    89.99999999999999,
                    89.99999999999999
                ],
                "new_ci95_ms": [
                    89.27696059186532,
                    92.10234975296223
                ],
                "old_ci99_ms": [
                    89.99999999999997,
                    90.0
                ],
                "new_ci99_ms": [
                    88.7839569272682,
                    92.59535341755934
                ],
                "new_times": [
                    0.09,
                    0.09,
                    0.09,
                    0.09,
                    0.11,
                    0.09,
                    0.09,
                    0.09,
                    0.09,
                    0.09,
                    0.09,
                    0.09,
                    0.09,
                    0.09,
                    0.09,
                    0.09,
                    0.09,
                    0.09,
                    0.09,
                    0.09,
                    0.09,
                    0.09,
                    0.09,
                    0.09,
                    0.09,
                    0.09,
                    0.09,
                    0.09,
                    0.09
                ],
                "old_times": [
                    0.09,
                    0.09,
                    0.09,
                    0.09,
                    0.09,
                    0.09,
                    0.09,
                    0.09,
                    0.09,
                    0.09,
                    0.09,
                    0.09,
                    0.09,
                    0.09,
                    0.09,
                    0.09,
                    0.09,
                    0.09,
                    0.09,
                    0.09,
                    0.09,
                    0.09,
                    0.09,
                    0.09,
                    0.09,
                    0.09,
                    0.09,
                    0.09,
                    0.09
                ]
            }
        ]
    },
    "logs": {
        "full_log_path": "/logs/full.log",
        "config_log_path": "/logs/config.log",
        "build_log_path": "/logs/build.log",
        "test_log_path": "/logs/test.log",
        "build_success": true,
        "test_success": true
    },
    "raw_timing_data": {
        "warmup_runs": 1,
        "measurement_runs": 30,
        "min_exec_time_improvement": 0.05,
        "min_p_value": 0.05
    }
}