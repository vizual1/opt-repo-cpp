{
  "metadata": {
    "collection_date": "2026-01-11T17:53:05.005889",
    "repository": "https://github.com/quick-lint/quick-lint-js",
    "repository_name": "quick-lint/quick-lint-js"
  },
  "commit_info": {
    "old_sha": "82a926153e162469414d593aeb72ea7f8dd24731",
    "new_sha": "8068edd9a1c4863d55454f6b005d38b1472c3552",
    "commit_message": [
      "Optimize buffering_error_reporter::report_impl\n\nOptimize report_impl for binary size by using memcpy instead of a switch\nstatement.\n\nOn my machine, this shrinks quick-lint-js-vscode-node_darwin-x64.node\nfrom 902 KiB to 866 KiB.\n\nThis commit should not change behavior."
    ],
    "commit_date": "2021-09-09T06:47:40+00:00",
    "patch": [
      "--- src/buffering-error-reporter.cpp\n@@ -13,6 +13,8 @@ namespace quick_lint_js {\n struct buffering_error_reporter::impl {\n   struct any_error {\n     union underlying_error {\n+      explicit underlying_error() noexcept {}\n+\n #define QLJS_ERROR_TYPE(name, code, struct_body, format)             \\\n   ::quick_lint_js::name name;                                        \\\n   static_assert(std::is_trivially_copyable_v<::quick_lint_js::name>, \\\n@@ -40,18 +42,16 @@ buffering_error_reporter &buffering_error_reporter::operator=(\n buffering_error_reporter::~buffering_error_reporter() = default;\n \n void buffering_error_reporter::report_impl(error_type type, void *error) {\n-  // TODO(strager): memcpy instead of switching.\n-  switch (type) {\n-#define QLJS_ERROR_TYPE(name, code, struct_body, format)           \\\n-  case error_type::name:                                           \\\n-    this->impl_->errors_.push_back(impl::any_error{                \\\n-        .type = error_type::name,                                  \\\n-        .error = {.name = *reinterpret_cast<const name *>(error)}, \\\n-    });                                                            \\\n-    break;\n-    QLJS_X_ERROR_TYPES\n+  static constexpr unsigned char error_sizes[] = {\n+#define QLJS_ERROR_TYPE(name, code, struct_body, format) \\\n+  sizeof(::quick_lint_js::name),\n+      QLJS_X_ERROR_TYPES\n #undef QLJS_ERROR_TYPE\n-  }\n+  };\n+\n+  impl::any_error &e = this->impl_->errors_.emplace_back();\n+  e.type = type;\n+  std::memcpy(&e.error, error, error_sizes[static_cast<std::ptrdiff_t>(type)]);\n }\n \n void buffering_error_reporter::copy_into(error_reporter *other) const {"
    ],
    "files_changed": [
      {
        "filename": "src/buffering-error-reporter.cpp",
        "status": "modified",
        "additions": 11,
        "deletions": 11,
        "changes": 22,
        "patch": "@@ -13,6 +13,8 @@ namespace quick_lint_js {\n struct buffering_error_reporter::impl {\n   struct any_error {\n     union underlying_error {\n+      explicit underlying_error() noexcept {}\n+\n #define QLJS_ERROR_TYPE(name, code, struct_body, format)             \\\n   ::quick_lint_js::name name;                                        \\\n   static_assert(std::is_trivially_copyable_v<::quick_lint_js::name>, \\\n@@ -40,18 +42,16 @@ buffering_error_reporter &buffering_error_reporter::operator=(\n buffering_error_reporter::~buffering_error_reporter() = default;\n \n void buffering_error_reporter::report_impl(error_type type, void *error) {\n-  // TODO(strager): memcpy instead of switching.\n-  switch (type) {\n-#define QLJS_ERROR_TYPE(name, code, struct_body, format)           \\\n-  case error_type::name:                                           \\\n-    this->impl_->errors_.push_back(impl::any_error{                \\\n-        .type = error_type::name,                                  \\\n-        .error = {.name = *reinterpret_cast<const name *>(error)}, \\\n-    });                                                            \\\n-    break;\n-    QLJS_X_ERROR_TYPES\n+  static constexpr unsigned char error_sizes[] = {\n+#define QLJS_ERROR_TYPE(name, code, struct_body, format) \\\n+  sizeof(::quick_lint_js::name),\n+      QLJS_X_ERROR_TYPES\n #undef QLJS_ERROR_TYPE\n-  }\n+  };\n+\n+  impl::any_error &e = this->impl_->errors_.emplace_back();\n+  e.type = type;\n+  std::memcpy(&e.error, error, error_sizes[static_cast<std::ptrdiff_t>(type)]);\n }\n \n void buffering_error_reporter::copy_into(error_reporter *other) const {"
      }
    ],
    "lines_added": 11,
    "lines_removed": 11
  },
  "issues": [],
  "pull_requests": [],
  "build_info": {
    "old_build_script": "#!/bin/bash\n#!/bin/bash\ncmake -S /test_workspace/workspace/old -B /test_workspace/workspace/old/build -DCMAKE_BUILD_TYPE=Debug -DCMAKE_EXPORT_COMPILE_COMMANDS=ON -DBENCHMARK_ENABLE_GTEST_TESTS=ON -DJSONCPP_WITH_POST_BUILD_UNITTEST=ON -DBUILD_TESTING=ON -DBENCHMARK_ENABLE_TESTING=ON -DBENCHMARK_ENABLE_ASSEMBLY_TESTS=ON",
    "new_build_script": "#!/bin/bash\n#!/bin/bash\ncmake -S /test_workspace/workspace/old -B /test_workspace/workspace/old/build -DCMAKE_BUILD_TYPE=Debug -DCMAKE_EXPORT_COMPILE_COMMANDS=ON -DBENCHMARK_ENABLE_GTEST_TESTS=ON -DJSONCPP_WITH_POST_BUILD_UNITTEST=ON -DBUILD_TESTING=ON -DBENCHMARK_ENABLE_TESTING=ON -DBENCHMARK_ENABLE_ASSEMBLY_TESTS=ON",
    "old_test_script": "#!/bin/bash\ncmake --build /test_workspace/workspace/old/build -- -j 1",
    "new_test_script": "#!/bin/bash\ncmake --build /test_workspace/workspace/old/build -- -j 1",
    "build_system": "cmake"
  },
  "performance_analysis": {
    "is_significant": false,
    "p_value": 1.0,
    "is_pair_significant": false,
    "pair_p_value": 1.0,
    "is_binom_significant": false,
    "binom_p_value": 1.0,
    "is_wilcoxon_significant": false,
    "wilcoxon_p_value": 0.9999992965702489,
    "is_mannwhitney_significant": false,
    "mannwhitney_p_value": 0.60783941614934,
    "relative_improvement": -0.0008467400508044351,
    "absolute_improvement_ms": -0.9999999999996678,
    "old_mean_ms": 1181.0,
    "new_mean_ms": 1181.9999999999998,
    "old_std_ms": 13.48050955754399,
    "new_std_ms": 12.429109325317315,
    "effect_size_cohens_d": -0.07712793235082856,
    "old_ci95_ms": [
      1175.9662950045868,
      1186.0337049954132
    ],
    "new_ci95_ms": [
      1177.358894303489,
      1186.6411056965105
    ],
    "old_ci99_ms": [
      1174.21600215117,
      1187.78399784883
    ],
    "new_ci99_ms": [
      1175.7451139687341,
      1188.2548860312654
    ],
    "new_times_s": [
      1.16,
      1.19,
      1.21,
      1.17,
      1.18,
      1.18,
      1.19,
      1.17,
      1.18,
      1.2,
      1.16,
      1.18,
      1.18,
      1.16,
      1.17,
      1.18,
      1.19,
      1.17,
      1.19,
      1.19,
      1.17,
      1.17,
      1.19,
      1.2,
      1.19,
      1.17,
      1.19,
      1.2,
      1.18,
      1.19,
      1.17
    ],
    "old_times_s": [
      1.16,
      1.19,
      1.16,
      1.17,
      1.18,
      1.17,
      1.17,
      1.19,
      1.2,
      1.18,
      1.17,
      1.19,
      1.18,
      1.16,
      1.16,
      1.18,
      1.19,
      1.21,
      1.19,
      1.17,
      1.17,
      1.16,
      1.19,
      1.19,
      1.19,
      1.17,
      1.18,
      1.18,
      1.19,
      1.2,
      1.2
    ]
  },
  "tests": {
    "total_tests": 2,
    "significant_improvements": 0,
    "significant_improvements_tests": [],
    "significant_regressions": 0,
    "significant_regressions_tests": [],
    "significant_pair_improvements": 0,
    "significant_pair_improvements_tests": [],
    "significant_pair_regressions": 0,
    "significant_pair_regressions_tests": [],
    "significant_binom_improvements": 0,
    "significant_binom_improvements_tests": [],
    "significant_binom_regressions": 0,
    "significant_binom_regressions_tests": [],
    "significant_wilcoxon_improvements": 0,
    "significant_wilcoxon_improvements_tests": [],
    "significant_wilcoxon_regressions": 0,
    "significant_wilcoxon_regressions_tests": [],
    "significant_mannwhitney_improvements": 0,
    "significant_mannwhitney_improvements_tests": [],
    "significant_mannwhitney_regressions": 0,
    "significant_mannwhitney_regressions_tests": [],
    "tests": [
      {
        "test_name": "quick-lint-js-test",
        "is_significant": false,
        "p_value": 1.0,
        "is_pair_significant": false,
        "pair_p_value": 0.9999999999999553,
        "is_binom_significant": false,
        "binom_p_value": 0.9999999981373549,
        "is_wilcoxon_significant": false,
        "wilcoxon_p_value": 0.999999201450885,
        "is_mannwhitney_significant": false,
        "mannwhitney_p_value": 0.5969449875262137,
        "relative_improvement": 0.000748502994012093,
        "absolute_improvement_ms": 0.34482758620685283,
        "old_mean_ms": 460.68965517241395,
        "new_mean_ms": 460.3448275862071,
        "old_std_ms": 7.036148745056592,
        "new_std_ms": 4.987669525002662,
        "effect_size_cohens_d": 0.05654270030878289,
        "old_ci95_ms": [
          458.0132473267315,
          463.3660630180963
        ],
        "new_ci95_ms": [
          458.4476195634565,
          462.24203560895774
        ],
        "old_ci99_ms": [
          457.07923165622077,
          464.30007868860713
        ],
        "new_ci99_ms": [
          457.7855298799553,
          462.9041252924589
        ],
        "new_times": [
          0.47,
          0.46,
          0.46,
          0.46,
          0.46,
          0.46,
          0.46,
          0.46,
          0.46,
          0.46,
          0.46,
          0.46,
          0.46,
          0.47,
          0.46,
          0.45,
          0.46,
          0.47,
          0.45,
          0.46,
          0.46,
          0.46,
          0.47,
          0.45,
          0.46,
          0.46,
          0.46,
          0.46,
          0.46
        ],
        "old_times": [
          0.45,
          0.46,
          0.46,
          0.46,
          0.45,
          0.46,
          0.49,
          0.46,
          0.46,
          0.46,
          0.47,
          0.46,
          0.46,
          0.46,
          0.46,
          0.46,
          0.46,
          0.46,
          0.46,
          0.45,
          0.46,
          0.46,
          0.46,
          0.46,
          0.46,
          0.46,
          0.46,
          0.47,
          0.46
        ]
      },
      {
        "test_name": "quick-lint-js-test-cli",
        "is_significant": false,
        "p_value": 1.0,
        "is_pair_significant": false,
        "pair_p_value": 1.0,
        "is_binom_significant": false,
        "binom_p_value": 1.0,
        "is_wilcoxon_significant": false,
        "wilcoxon_p_value": 0.9999999638108507,
        "is_mannwhitney_significant": false,
        "mannwhitney_p_value": 1.0,
        "relative_improvement": 0.0,
        "absolute_improvement_ms": 0.0,
        "old_mean_ms": 89.99999999999999,
        "new_mean_ms": 89.99999999999999,
        "old_std_ms": 1.4123431441001795e-14,
        "new_std_ms": 1.4123431441001795e-14,
        "effect_size_cohens_d": 0.0,
        "old_ci95_ms": [
          89.99999999999999,
          89.99999999999999
        ],
        "new_ci95_ms": [
          89.99999999999999,
          89.99999999999999
        ],
        "old_ci99_ms": [
          89.99999999999997,
          90.0
        ],
        "new_ci99_ms": [
          89.99999999999997,
          90.0
        ],
        "new_times": [
          0.09,
          0.09,
          0.09,
          0.09,
          0.09,
          0.09,
          0.09,
          0.09,
          0.09,
          0.09,
          0.09,
          0.09,
          0.09,
          0.09,
          0.09,
          0.09,
          0.09,
          0.09,
          0.09,
          0.09,
          0.09,
          0.09,
          0.09,
          0.09,
          0.09,
          0.09,
          0.09,
          0.09,
          0.09
        ],
        "old_times": [
          0.09,
          0.09,
          0.09,
          0.09,
          0.09,
          0.09,
          0.09,
          0.09,
          0.09,
          0.09,
          0.09,
          0.09,
          0.09,
          0.09,
          0.09,
          0.09,
          0.09,
          0.09,
          0.09,
          0.09,
          0.09,
          0.09,
          0.09,
          0.09,
          0.09,
          0.09,
          0.09,
          0.09,
          0.09
        ]
      }
    ]
  },
  "logs": {
    "full_log_path": "/logs/full.log",
    "config_log_path": "/logs/config.log",
    "build_log_path": "/logs/build.log",
    "test_log_path": "/logs/test.log",
    "build_success": true,
    "test_success": true
  },
  "raw_timing_data": {
    "warmup_runs": 1,
    "measurement_runs": 30,
    "min_exec_time_improvement": 0.05,
    "min_p_value": 0.05
  }
}