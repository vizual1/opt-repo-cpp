{
  "metadata": {
    "collection_date": "2026-01-14T18:38:17.081609",
    "repository": "https://github.com/quick-lint/quick-lint-js",
    "repository_name": "quick-lint/quick-lint-js"
  },
  "commit_info": {
    "old_sha": "3e6a0be5facb7eeff7894756c3a36461ae420dd9",
    "new_sha": "e6d30b3a618de79dae40a9d74d8dbee13306b53d",
    "commit_message": [
      "perf(container): optimize vector_instrumentation with hash maps\n\nUse faster hash_map-s in the hot loop, and convert to std::map only at\nthe end to keep the output stable.\n\n    Benchmark                                                           Time             CPU      Time Old      Time New       CPU Old       CPU New\n    ------------------------------------------------------------------------------------------------------------------------------------------------\n    benchmark_max_size_histogram_by_owner/tons                       -0.1078         -0.1094        923844        824251        922790        821865\n    benchmark_max_size_histogram_by_owner/tons                       -0.1162         -0.1198        940036        830763        938363        825969\n    benchmark_max_size_histogram_by_owner/tons                       -0.1333         -0.1343        948458        822066        945706        818721\n    benchmark_max_size_histogram_by_owner/tons_pvalue                 0.1000          0.1000      U Test, Repetitions: 3 vs 3. WARNING: Results unreliable! 9+ repetitions recommended.\n    benchmark_max_size_histogram_by_owner/tons_mean                  -0.1192         -0.1212        937446        825693        935619        822185\n    benchmark_max_size_histogram_by_owner/tons_median                -0.1232         -0.1242        940036        824251        938363        821865\n    benchmark_max_size_histogram_by_owner/tons_stddev                -0.6383         -0.6894         12510          4524         11702          3635\n    benchmark_max_size_histogram_by_owner/tons_cv                    -0.5894         -0.6465             0             0             0             0\n    OVERALL_GEOMEAN                                                  -0.1192         -0.1212             0             0             0             0"
    ],
    "commit_date": "2022-10-19T19:16:45+00:00",
    "patch": [
      "--- src/quick-lint-js/container/vector-profiler-debug.cpp\n@@ -73,7 +73,8 @@ std::vector<vector_instrumentation::entry> vector_instrumentation::entries()\n std::map<std::string_view, std::map<std::size_t, int>>\n vector_instrumentation::max_size_histogram_by_owner() const {\n   std::lock_guard lock(this->mutex_);\n-  std::map<std::string_view, std::map<std::size_t, int>> histogram;\n+\n+  hash_map<const char *, hash_map<std::size_t, int>> histogram;\n   hash_map<std::pair<const char *, std::uintptr_t>, std::size_t> object_sizes;\n   for (const vector_instrumentation::entry &entry : this->entries_) {\n     std::pair key(entry.owner, entry.object_id);\n@@ -88,7 +89,19 @@ vector_instrumentation::max_size_histogram_by_owner() const {\n   for (auto &[owner_and_object_id, size] : object_sizes) {\n     histogram[owner_and_object_id.first][size] += 1;\n   }\n-  return histogram;\n+\n+  // Convert hash_map into std::map.\n+  // NOTE(strager): We might need to merge some inner maps because we built the\n+  // hash_map with pointer comparison but we're building the std::map with\n+  // string comparison.\n+  std::map<std::string_view, std::map<std::size_t, int>> stable_histogram;\n+  for (auto &[owner, counts] : histogram) {\n+    auto &stable_counts = stable_histogram[owner];\n+    for (auto &[size, count] : counts) {\n+      stable_counts[size] += count;\n+    }\n+  }\n+  return stable_histogram;\n }\n \n void vector_instrumentation::dump_max_size_histogram("
    ],
    "files_changed": [
      {
        "filename": "src/quick-lint-js/container/vector-profiler-debug.cpp",
        "status": "modified",
        "additions": 15,
        "deletions": 2,
        "changes": 17,
        "patch": "@@ -73,7 +73,8 @@ std::vector<vector_instrumentation::entry> vector_instrumentation::entries()\n std::map<std::string_view, std::map<std::size_t, int>>\n vector_instrumentation::max_size_histogram_by_owner() const {\n   std::lock_guard lock(this->mutex_);\n-  std::map<std::string_view, std::map<std::size_t, int>> histogram;\n+\n+  hash_map<const char *, hash_map<std::size_t, int>> histogram;\n   hash_map<std::pair<const char *, std::uintptr_t>, std::size_t> object_sizes;\n   for (const vector_instrumentation::entry &entry : this->entries_) {\n     std::pair key(entry.owner, entry.object_id);\n@@ -88,7 +89,19 @@ vector_instrumentation::max_size_histogram_by_owner() const {\n   for (auto &[owner_and_object_id, size] : object_sizes) {\n     histogram[owner_and_object_id.first][size] += 1;\n   }\n-  return histogram;\n+\n+  // Convert hash_map into std::map.\n+  // NOTE(strager): We might need to merge some inner maps because we built the\n+  // hash_map with pointer comparison but we're building the std::map with\n+  // string comparison.\n+  std::map<std::string_view, std::map<std::size_t, int>> stable_histogram;\n+  for (auto &[owner, counts] : histogram) {\n+    auto &stable_counts = stable_histogram[owner];\n+    for (auto &[size, count] : counts) {\n+      stable_counts[size] += count;\n+    }\n+  }\n+  return stable_histogram;\n }\n \n void vector_instrumentation::dump_max_size_histogram("
      }
    ],
    "lines_added": 15,
    "lines_removed": 2
  },
  "issues": [],
  "pull_requests": [],
  "build_info": {
    "old_build_script": "#!/bin/bash\n#!/bin/bash\ncmake -S /test_workspace/workspace/old -B /test_workspace/workspace/old/build -DCMAKE_BUILD_TYPE=Debug -DCMAKE_EXPORT_COMPILE_COMMANDS=ON -DBENCHMARK_ENABLE_GTEST_TESTS=ON -DBUILD_TESTING=ON -DBENCHMARK_ENABLE_TESTING=ON -DBENCHMARK_USE_BUNDLED_GTEST=ON -DBENCHMARK_ENABLE_ASSEMBLY_TESTS=ON",
    "new_build_script": "#!/bin/bash\n#!/bin/bash\ncmake -S /test_workspace/workspace/old -B /test_workspace/workspace/old/build -DCMAKE_BUILD_TYPE=Debug -DCMAKE_EXPORT_COMPILE_COMMANDS=ON -DBENCHMARK_ENABLE_GTEST_TESTS=ON -DBUILD_TESTING=ON -DBENCHMARK_ENABLE_TESTING=ON -DBENCHMARK_USE_BUNDLED_GTEST=ON -DBENCHMARK_ENABLE_ASSEMBLY_TESTS=ON",
    "old_test_script": "#!/bin/bash\ncmake --build /test_workspace/workspace/old/build -- -j 1",
    "new_test_script": "#!/bin/bash\ncmake --build /test_workspace/workspace/old/build -- -j 1",
    "build_system": "cmake"
  },
  "performance_analysis": {
    "is_significant": false,
    "p_value": 1.0,
    "is_pair_significant": false,
    "pair_p_value": 1.0,
    "is_binom_significant": false,
    "binom_p_value": 1.0,
    "is_wilcoxon_significant": false,
    "wilcoxon_p_value": 0.9999993043205406,
    "is_mannwhitney_significant": false,
    "mannwhitney_p_value": 0.8845036789574634,
    "relative_improvement": -0.0025484199796126763,
    "absolute_improvement_ms": -3.3333333333334103,
    "old_mean_ms": 1307.9999999999998,
    "new_mean_ms": 1311.3333333333333,
    "old_std_ms": 6.643638388299203,
    "new_std_ms": 9.732042112432575,
    "effect_size_cohens_d": -0.40005518383140887,
    "old_ci95_ms": [
      1305.5192246554072,
      1310.4807753445923
    ],
    "new_ci95_ms": [
      1307.6993290853627,
      1314.9673375813038
    ],
    "old_ci99_ms": [
      1304.6566227825263,
      1311.3433772174735
    ],
    "new_ci99_ms": [
      1306.4357326548397,
      1316.2309340118268
    ],
    "new_times_s": [
      1.31,
      1.32,
      1.31,
      1.3,
      1.31,
      1.3,
      1.3,
      1.31,
      1.31,
      1.33,
      1.3,
      1.31,
      1.31,
      1.33,
      1.32,
      1.31,
      1.31,
      1.31,
      1.32,
      1.33,
      1.31,
      1.3,
      1.31,
      1.31,
      1.33,
      1.32,
      1.31,
      1.3,
      1.3,
      1.3,
      1.31
    ],
    "old_times_s": [
      1.31,
      1.3,
      1.31,
      1.31,
      1.31,
      1.3,
      1.3,
      1.3,
      1.31,
      1.31,
      1.31,
      1.32,
      1.32,
      1.31,
      1.3,
      1.31,
      1.32,
      1.31,
      1.31,
      1.31,
      1.3,
      1.31,
      1.31,
      1.32,
      1.3,
      1.31,
      1.3,
      1.3,
      1.31,
      1.3,
      1.31
    ]
  },
  "tests": {
    "total_tests": 2,
    "significant_improvements": 0,
    "significant_improvements_tests": [],
    "significant_regressions": 0,
    "significant_regressions_tests": [],
    "significant_pair_improvements": 0,
    "significant_pair_improvements_tests": [],
    "significant_pair_regressions": 0,
    "significant_pair_regressions_tests": [],
    "significant_binom_improvements": 0,
    "significant_binom_improvements_tests": [],
    "significant_binom_regressions": 0,
    "significant_binom_regressions_tests": [],
    "significant_wilcoxon_improvements": 0,
    "significant_wilcoxon_improvements_tests": [],
    "significant_wilcoxon_regressions": 0,
    "significant_wilcoxon_regressions_tests": [],
    "significant_mannwhitney_improvements": 0,
    "significant_mannwhitney_improvements_tests": [],
    "significant_mannwhitney_regressions": 0,
    "significant_mannwhitney_regressions_tests": [],
    "tests": [
      {
        "test_name": "quick-lint-js-test",
        "is_significant": false,
        "p_value": 1.0,
        "is_pair_significant": false,
        "pair_p_value": 1.0,
        "is_binom_significant": false,
        "binom_p_value": 1.0,
        "is_wilcoxon_significant": false,
        "wilcoxon_p_value": 0.9999991232239551,
        "is_mannwhitney_significant": false,
        "mannwhitney_p_value": 0.3689613569202733,
        "relative_improvement": 0.0005580357142856033,
        "absolute_improvement_ms": 0.34482758620690834,
        "old_mean_ms": 617.9310344827586,
        "new_mean_ms": 617.5862068965517,
        "old_std_ms": 5.592923044110294,
        "new_std_ms": 6.894704186026254,
        "effect_size_cohens_d": 0.05492942180025697,
        "old_ci95_ms": [
          615.8036003340602,
          620.0584686314571
        ],
        "new_ci95_ms": [
          614.9636016837064,
          620.2088121093971
        ],
        "old_ci99_ms": [
          615.0611660910619,
          620.8009028744555
        ],
        "new_ci99_ms": [
          614.0483621135071,
          621.1240516795964
        ],
        "new_times": [
          0.61,
          0.61,
          0.61,
          0.61,
          0.61,
          0.62,
          0.62,
          0.63,
          0.62,
          0.62,
          0.62,
          0.63,
          0.63,
          0.62,
          0.62,
          0.62,
          0.62,
          0.62,
          0.62,
          0.61,
          0.61,
          0.61,
          0.63,
          0.62,
          0.62,
          0.61,
          0.61,
          0.61,
          0.62
        ],
        "old_times": [
          0.62,
          0.62,
          0.62,
          0.61,
          0.61,
          0.61,
          0.61,
          0.62,
          0.62,
          0.62,
          0.62,
          0.62,
          0.61,
          0.62,
          0.63,
          0.62,
          0.62,
          0.62,
          0.62,
          0.62,
          0.61,
          0.63,
          0.62,
          0.62,
          0.61,
          0.61,
          0.62,
          0.62,
          0.62
        ]
      },
      {
        "test_name": "quick-lint-js-test-cli",
        "is_significant": false,
        "p_value": 0.9999999999999986,
        "is_pair_significant": false,
        "pair_p_value": 0.9999999999999986,
        "is_binom_significant": false,
        "binom_p_value": 1.0,
        "is_wilcoxon_significant": false,
        "wilcoxon_p_value": 0.9999999431363717,
        "is_mannwhitney_significant": false,
        "mannwhitney_p_value": 0.8495447335324144,
        "relative_improvement": -0.0034482758620688917,
        "absolute_improvement_ms": -0.3448275862068806,
        "old_mean_ms": 100.00000000000003,
        "new_mean_ms": 100.34482758620692,
        "old_std_ms": 2.824686288200359e-14,
        "new_std_ms": 1.8569533817705177,
        "effect_size_cohens_d": -0.26261286571943304,
        "old_ci95_ms": [
          100.00000000000001,
          100.00000000000004
        ],
        "new_ci95_ms": [
          99.6384802959327,
          101.05117487648113
        ],
        "old_ci99_ms": [
          100.00000000000001,
          100.00000000000004
        ],
        "new_ci99_ms": [
          99.39197846363413,
          101.29767670877969
        ],
        "new_times": [
          0.1,
          0.1,
          0.1,
          0.1,
          0.1,
          0.1,
          0.1,
          0.1,
          0.1,
          0.1,
          0.1,
          0.1,
          0.1,
          0.1,
          0.1,
          0.1,
          0.1,
          0.1,
          0.1,
          0.1,
          0.1,
          0.1,
          0.11,
          0.1,
          0.1,
          0.1,
          0.1,
          0.1,
          0.1
        ],
        "old_times": [
          0.1,
          0.1,
          0.1,
          0.1,
          0.1,
          0.1,
          0.1,
          0.1,
          0.1,
          0.1,
          0.1,
          0.1,
          0.1,
          0.1,
          0.1,
          0.1,
          0.1,
          0.1,
          0.1,
          0.1,
          0.1,
          0.1,
          0.1,
          0.1,
          0.1,
          0.1,
          0.1,
          0.1,
          0.1
        ]
      }
    ]
  },
  "logs": {
    "full_log_path": "/logs/full.log",
    "config_log_path": "/logs/config.log",
    "build_log_path": "/logs/build.log",
    "test_log_path": "/logs/test.log",
    "build_success": true,
    "test_success": true
  },
  "raw_timing_data": {
    "warmup_runs": 1,
    "measurement_runs": 30,
    "min_exec_time_improvement": 0.05,
    "min_p_value": 0.05
  }
}