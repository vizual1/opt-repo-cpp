{
  "metadata": {
    "collection_date": "2026-01-11T17:52:35.223946",
    "repository": "https://github.com/google/snappy",
    "repository_name": "google/snappy"
  },
  "commit_info": {
    "old_sha": "f2db8f77ce469ce00e33657b981e41a1bd1daf16",
    "new_sha": "d643b9a98888bdc746e8b19621ab19208e79fdac",
    "commit_message": [
      "decompress: add hint to remove extra AND\n\nClang doesn't realize the load with free zero-extension,\nand emits another extra 'and xn, xm, 0xff' to calc offset.\nWith this change ,this extra op is removed, and consistent\n1.7% performance uplift is observed.\n\nSigned-off-by: Jun He <jun.he@arm.com>\nChange-Id: Ica4617852c4b93eadc6c5c551dc3961ffbadb8f0"
    ],
    "commit_date": "2021-08-03T07:36:20+00:00",
    "patch": [
      "--- snappy.cc\n@@ -1108,6 +1108,15 @@ std::pair<const uint8_t*, ptrdiff_t> DecompressBranchless(\n     // ip points just past the tag and we are touching at maximum kSlopBytes\n     // in an iteration.\n     size_t tag = ip[-1];\n+#if defined(__clang__) && defined(__aarch64__)\n+    // Workaround for https://bugs.llvm.org/show_bug.cgi?id=51317\n+    // when loading 1 byte, clang for aarch64 doesn't realize that it(ldrb)\n+    // comes with free zero-extension, so clang generates another\n+    // 'and xn, xm, 0xff' before it use that as the offset. This 'and' is\n+    // redundant and can be removed by adding this dummy asm, which gives\n+    // clang a hint that we're doing the zero-extension at the load.\n+    asm(\"\" ::\"r\"(tag));\n+#endif\n     do {\n       // The throughput is limited by instructions, unrolling the inner loop\n       // twice reduces the amount of instructions checking limits and also"
    ],
    "files_changed": [
      {
        "filename": "snappy.cc",
        "status": "modified",
        "additions": 9,
        "deletions": 0,
        "changes": 9,
        "patch": "@@ -1108,6 +1108,15 @@ std::pair<const uint8_t*, ptrdiff_t> DecompressBranchless(\n     // ip points just past the tag and we are touching at maximum kSlopBytes\n     // in an iteration.\n     size_t tag = ip[-1];\n+#if defined(__clang__) && defined(__aarch64__)\n+    // Workaround for https://bugs.llvm.org/show_bug.cgi?id=51317\n+    // when loading 1 byte, clang for aarch64 doesn't realize that it(ldrb)\n+    // comes with free zero-extension, so clang generates another\n+    // 'and xn, xm, 0xff' before it use that as the offset. This 'and' is\n+    // redundant and can be removed by adding this dummy asm, which gives\n+    // clang a hint that we're doing the zero-extension at the load.\n+    asm(\"\" ::\"r\"(tag));\n+#endif\n     do {\n       // The throughput is limited by instructions, unrolling the inner loop\n       // twice reduces the amount of instructions checking limits and also"
      }
    ],
    "lines_added": 9,
    "lines_removed": 0
  },
  "issues": [],
  "pull_requests": [],
  "build_info": {
    "old_build_script": "#!/bin/bash\n#!/bin/bash\ncmake -S /test_workspace/workspace/old -B /test_workspace/workspace/old/build -DCMAKE_BUILD_TYPE=Debug -DCMAKE_EXPORT_COMPILE_COMMANDS=ON -DSNAPPY_BUILD_TESTS=ON -DBENCHMARK_ENABLE_GTEST_TESTS=ON -DBENCHMARK_ENABLE_TESTING=ON -DBENCHMARK_ENABLE_ASSEMBLY_TESTS=ON",
    "new_build_script": "#!/bin/bash\n#!/bin/bash\ncmake -S /test_workspace/workspace/old -B /test_workspace/workspace/old/build -DCMAKE_BUILD_TYPE=Debug -DCMAKE_EXPORT_COMPILE_COMMANDS=ON -DSNAPPY_BUILD_TESTS=ON -DBENCHMARK_ENABLE_GTEST_TESTS=ON -DBENCHMARK_ENABLE_TESTING=ON -DBENCHMARK_ENABLE_ASSEMBLY_TESTS=ON",
    "old_test_script": "#!/bin/bash\ncmake --build /test_workspace/workspace/old/build -- -j 1",
    "new_test_script": "#!/bin/bash\ncmake --build /test_workspace/workspace/old/build -- -j 1",
    "build_system": "cmake"
  },
  "performance_analysis": {
    "is_significant": false,
    "p_value": 1.0,
    "is_pair_significant": false,
    "pair_p_value": 1.0,
    "is_binom_significant": false,
    "binom_p_value": 1.0,
    "is_wilcoxon_significant": false,
    "wilcoxon_p_value": 0.9999991485045533,
    "is_mannwhitney_significant": false,
    "mannwhitney_p_value": 0.7266376239943908,
    "relative_improvement": -0.000322499731250338,
    "absolute_improvement_ms": -3.0000000000001137,
    "old_mean_ms": 9302.333333333334,
    "new_mean_ms": 9305.333333333334,
    "old_std_ms": 34.00642265233451,
    "new_std_ms": 42.241778088664354,
    "effect_size_cohens_d": -0.07823537493328797,
    "old_ci95_ms": [
      9289.635126425763,
      9315.031540240903
    ],
    "new_ci95_ms": [
      9289.559994167454,
      9321.106672499214
    ],
    "old_ci99_ms": [
      9285.21977415109,
      9319.446892515578
    ],
    "new_ci99_ms": [
      9284.075373427517,
      9326.591293239151
    ],
    "new_times_s": [
      9.29,
      9.3,
      9.26,
      9.27,
      9.28,
      9.26,
      9.27,
      9.3,
      9.32,
      9.3,
      9.3,
      9.21,
      9.3,
      9.31,
      9.28,
      9.29,
      9.29,
      9.27,
      9.34,
      9.33,
      9.33,
      9.33,
      9.3,
      9.34,
      9.32,
      9.31,
      9.47,
      9.33,
      9.31,
      9.32,
      9.32
    ],
    "old_times_s": [
      9.29,
      9.26,
      9.29,
      9.23,
      9.27,
      9.27,
      9.31,
      9.28,
      9.3,
      9.28,
      9.3,
      9.3,
      9.28,
      9.31,
      9.29,
      9.29,
      9.29,
      9.31,
      9.32,
      9.31,
      9.37,
      9.28,
      9.29,
      9.3,
      9.38,
      9.28,
      9.39,
      9.31,
      9.33,
      9.31,
      9.34
    ]
  },
  "tests": {
    "total_tests": 1,
    "significant_improvements": 0,
    "significant_improvements_tests": [],
    "significant_regressions": 0,
    "significant_regressions_tests": [],
    "significant_pair_improvements": 0,
    "significant_pair_improvements_tests": [],
    "significant_pair_regressions": 0,
    "significant_pair_regressions_tests": [],
    "significant_binom_improvements": 0,
    "significant_binom_improvements_tests": [],
    "significant_binom_regressions": 0,
    "significant_binom_regressions_tests": [],
    "significant_wilcoxon_improvements": 0,
    "significant_wilcoxon_improvements_tests": [],
    "significant_wilcoxon_regressions": 0,
    "significant_wilcoxon_regressions_tests": [],
    "significant_mannwhitney_improvements": 0,
    "significant_mannwhitney_improvements_tests": [],
    "significant_mannwhitney_regressions": 0,
    "significant_mannwhitney_regressions_tests": [],
    "tests": [
      {
        "test_name": "snappy_unittest",
        "is_significant": false,
        "p_value": 1.0,
        "is_pair_significant": false,
        "pair_p_value": 1.0,
        "is_binom_significant": false,
        "binom_p_value": 1.0,
        "is_wilcoxon_significant": false,
        "wilcoxon_p_value": 0.9999987424339092,
        "is_mannwhitney_significant": false,
        "mannwhitney_p_value": 0.6317421313553754,
        "relative_improvement": -0.0001853293302198427,
        "absolute_improvement_ms": -1.7241379310366511,
        "old_mean_ms": 9303.10344827586,
        "new_mean_ms": 9304.827586206899,
        "old_std_ms": 34.85720342399665,
        "new_std_ms": 43.22868505775616,
        "effect_size_cohens_d": -0.04390842473993386,
        "old_ci95_ms": [
          9289.844477196253,
          9316.36241935547
        ],
        "new_ci95_ms": [
          9288.384273815527,
          9321.270898598268
        ],
        "old_ci99_ms": [
          9285.217347297803,
          9320.98954925392
        ],
        "new_ci99_ms": [
          9282.6458690827,
          9327.009303331095
        ],
        "new_times": [
          9.26,
          9.27,
          9.27,
          9.26,
          9.27,
          9.3,
          9.32,
          9.3,
          9.3,
          9.21,
          9.3,
          9.31,
          9.28,
          9.29,
          9.29,
          9.27,
          9.34,
          9.33,
          9.33,
          9.33,
          9.3,
          9.34,
          9.32,
          9.31,
          9.47,
          9.33,
          9.3,
          9.32,
          9.32
        ],
        "old_times": [
          9.29,
          9.22,
          9.26,
          9.27,
          9.31,
          9.28,
          9.3,
          9.28,
          9.3,
          9.3,
          9.28,
          9.31,
          9.29,
          9.29,
          9.29,
          9.31,
          9.32,
          9.31,
          9.37,
          9.28,
          9.29,
          9.3,
          9.38,
          9.28,
          9.39,
          9.31,
          9.33,
          9.31,
          9.34
        ]
      }
    ]
  },
  "logs": {
    "full_log_path": "/logs/full.log",
    "config_log_path": "/logs/config.log",
    "build_log_path": "/logs/build.log",
    "test_log_path": "/logs/test.log",
    "build_success": true,
    "test_success": true
  },
  "raw_timing_data": {
    "warmup_runs": 1,
    "measurement_runs": 30,
    "min_exec_time_improvement": 0.05,
    "min_p_value": 0.05
  }
}