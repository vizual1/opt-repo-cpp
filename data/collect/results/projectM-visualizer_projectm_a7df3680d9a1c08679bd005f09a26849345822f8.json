{
    "metadata": {
        "collection_date": "2026-01-14T18:37:57.426560",
        "repository": "https://github.com/projectM-visualizer/projectm",
        "repository_name": "projectM-visualizer/projectm"
    },
    "commit_info": {
        "old_sha": "f5d9546e83b25c67df742091b9f3d5b36c3c1050",
        "new_sha": "a7df3680d9a1c08679bd005f09a26849345822f8",
        "commit_message": [
            "Use Mesh class in Border effect\n\nReduced draw calls from 4/8 to 1/2 by specifying 8 vertices accessed via indices to draw each border in a single call."
        ],
        "commit_date": "2025-09-30T14:08:14+00:00",
        "patch": [
            "--- src/libprojectM/MilkdropPreset/Border.cpp\n@@ -4,20 +4,23 @@ namespace libprojectM {\n namespace MilkdropPreset {\n \n Border::Border(PresetState& presetState)\n-    : RenderItem()\n-    , m_presetState(presetState)\n+    : m_presetState(presetState)\n+    , m_borderMesh(Renderer::VertexBufferUsage::StreamDraw)\n {\n-    RenderItem::Init();\n-}\n-\n-void Border::InitVertexAttrib()\n-{\n-    glEnableVertexAttribArray(0);\n-    glVertexAttribPointer(0, 2, GL_FLOAT, GL_FALSE, 0, nullptr);\n-    glDisableVertexAttribArray(1);\n+    m_borderMesh.SetRenderPrimitiveType(Renderer::Mesh::PrimitiveType::Triangles);\n+    m_borderMesh.SetVertexCount(8);\n \n-    std::array<Point, 4> vertices{};\n-    glBufferData(GL_ARRAY_BUFFER, sizeof(Point) * 4, vertices.data(), GL_STREAM_DRAW);\n+    m_borderMesh.Indices().Set({\n+    {\n+        0, 1, 4,\n+        1, 4, 5,\n+        2, 3, 6,\n+        3, 7, 6,\n+        2, 0, 6,\n+        0, 4, 6,\n+        3, 7, 5,\n+        1, 3, 5\n+    }});\n }\n \n void Border::Draw(const PerFrameContext& presetPerFrameContext)\n@@ -26,9 +29,6 @@ void Border::Draw(const PerFrameContext& presetPerFrameContext)\n     float const outerBorderSize = static_cast<float>(*presetPerFrameContext.ob_size);\n     float const innerBorderSize = static_cast<float>(*presetPerFrameContext.ib_size);\n \n-    glBindVertexArray(m_vaoID);\n-    glBindBuffer(GL_ARRAY_BUFFER, m_vboID);\n-\n     // No additive drawing for borders\n     glEnable(GL_BLEND);\n     glBlendFunc(GL_SRC_ALPHA, GL_ONE_MINUS_SRC_ALPHA);\n@@ -37,7 +37,8 @@ void Border::Draw(const PerFrameContext& presetPerFrameContext)\n     shader->Bind();\n     shader->SetUniformMat4x4(\"vertex_transformation\", PresetState::orthogonalProjection);\n \n-    std::array<Point, 4> vertices{};\n+    m_borderMesh.Bind();\n+\n     for (int border = 0; border < 2; border++)\n     {\n         float r = (border == 0) ? static_cast<float>(*presetPerFrameContext.ob_r) : static_cast<float>(*presetPerFrameContext.ib_r);\n@@ -52,39 +53,24 @@ void Border::Draw(const PerFrameContext& presetPerFrameContext)\n             float innerRadius = (border == 0) ? 1.0f - outerBorderSize : 1.0f - outerBorderSize - innerBorderSize;\n             float outerRadius = (border == 0) ? 1.0f : 1.0f - outerBorderSize;\n \n-            vertices[0].x = innerRadius;\n-            vertices[1].x = outerRadius;\n-            vertices[2].x = outerRadius;\n-            vertices[3].x = innerRadius;\n-            vertices[0].y = innerRadius;\n-            vertices[1].y = outerRadius;\n-            vertices[2].y = -outerRadius;\n-            vertices[3].y = -innerRadius;\n-\n-            for (int rot = 0; rot < 4; rot++)\n-            {\n-                glBufferSubData(GL_ARRAY_BUFFER, 0, sizeof(Point) * 4, vertices.data());\n-                glDrawArrays(GL_TRIANGLE_FAN, 0, 4);\n-\n-                // Rotate 90 degrees\n-                // Milkdrop code calculates cos(PI/2) and sin(PI/2), which is 0 and 1 respectively.\n-                // Our code here simplifies the expressions accordingly.\n-                for (int vertex = 0; vertex < 4; vertex++)\n-                {\n-                    float const x = vertices[vertex].x;\n-                    float const y = vertices[vertex].y;\n-                    vertices[vertex].x = -y; // x * cos(PI/2) - y * sin(PI/2) == x * 0 - y * 1\n-                    vertices[vertex].y = x;  // x * sin(PI/2) + y * cos(PI/2) == x * 1 + y * 0\n-                }\n-            }\n+             m_borderMesh.Vertices().Set({{outerRadius, outerRadius},\n+                                                     {outerRadius, -outerRadius},\n+                                                     {-outerRadius, outerRadius},\n+                                                     {-outerRadius, -outerRadius},\n+                                                     {innerRadius, innerRadius},\n+                                                     {innerRadius, -innerRadius},\n+                                                     {-innerRadius, innerRadius},\n+                                                     {-innerRadius, -innerRadius}});\n+\n+            m_borderMesh.Update();\n+            m_borderMesh.Draw();\n         }\n     }\n \n+    Renderer::Mesh::Unbind();\n     Renderer::Shader::Unbind();\n \n     glDisable(GL_BLEND);\n-    glBindBuffer(GL_ARRAY_BUFFER, 0);\n-    glBindVertexArray(0);\n }\n \n } // namespace MilkdropPreset\n--- src/libprojectM/MilkdropPreset/Border.hpp\n@@ -3,7 +3,7 @@\n #include \"PerFrameContext.hpp\"\n #include \"PresetState.hpp\"\n \n-#include \"Renderer/RenderItem.hpp\"\n+#include <Renderer/Mesh.hpp>\n \n namespace libprojectM {\n namespace MilkdropPreset {\n@@ -12,15 +12,13 @@ namespace MilkdropPreset {\n /**\n  * @brief Renders a border around the screen.\n  */\n-class Border : public Renderer::RenderItem\n+class Border\n {\n public:\n     Border() = delete;\n \n     explicit Border(PresetState& presetState);\n \n-    void InitVertexAttrib() override;\n-\n     /**\n      * Draws the border.\n      * @param presetPerFrameContext The per-frame context variables.\n@@ -29,6 +27,7 @@ class Border : public Renderer::RenderItem\n \n private:\n     PresetState& m_presetState; //!< The global preset state.\n+    Renderer::Mesh m_borderMesh; //!< The border geometry.\n };\n \n } // namespace MilkdropPreset"
        ],
        "files_changed": [
            {
                "filename": "src/libprojectM/MilkdropPreset/Border.cpp",
                "status": "modified",
                "additions": 29,
                "deletions": 43,
                "changes": 72,
                "patch": "@@ -4,20 +4,23 @@ namespace libprojectM {\n namespace MilkdropPreset {\n \n Border::Border(PresetState& presetState)\n-    : RenderItem()\n-    , m_presetState(presetState)\n+    : m_presetState(presetState)\n+    , m_borderMesh(Renderer::VertexBufferUsage::StreamDraw)\n {\n-    RenderItem::Init();\n-}\n-\n-void Border::InitVertexAttrib()\n-{\n-    glEnableVertexAttribArray(0);\n-    glVertexAttribPointer(0, 2, GL_FLOAT, GL_FALSE, 0, nullptr);\n-    glDisableVertexAttribArray(1);\n+    m_borderMesh.SetRenderPrimitiveType(Renderer::Mesh::PrimitiveType::Triangles);\n+    m_borderMesh.SetVertexCount(8);\n \n-    std::array<Point, 4> vertices{};\n-    glBufferData(GL_ARRAY_BUFFER, sizeof(Point) * 4, vertices.data(), GL_STREAM_DRAW);\n+    m_borderMesh.Indices().Set({\n+    {\n+        0, 1, 4,\n+        1, 4, 5,\n+        2, 3, 6,\n+        3, 7, 6,\n+        2, 0, 6,\n+        0, 4, 6,\n+        3, 7, 5,\n+        1, 3, 5\n+    }});\n }\n \n void Border::Draw(const PerFrameContext& presetPerFrameContext)\n@@ -26,9 +29,6 @@ void Border::Draw(const PerFrameContext& presetPerFrameContext)\n     float const outerBorderSize = static_cast<float>(*presetPerFrameContext.ob_size);\n     float const innerBorderSize = static_cast<float>(*presetPerFrameContext.ib_size);\n \n-    glBindVertexArray(m_vaoID);\n-    glBindBuffer(GL_ARRAY_BUFFER, m_vboID);\n-\n     // No additive drawing for borders\n     glEnable(GL_BLEND);\n     glBlendFunc(GL_SRC_ALPHA, GL_ONE_MINUS_SRC_ALPHA);\n@@ -37,7 +37,8 @@ void Border::Draw(const PerFrameContext& presetPerFrameContext)\n     shader->Bind();\n     shader->SetUniformMat4x4(\"vertex_transformation\", PresetState::orthogonalProjection);\n \n-    std::array<Point, 4> vertices{};\n+    m_borderMesh.Bind();\n+\n     for (int border = 0; border < 2; border++)\n     {\n         float r = (border == 0) ? static_cast<float>(*presetPerFrameContext.ob_r) : static_cast<float>(*presetPerFrameContext.ib_r);\n@@ -52,39 +53,24 @@ void Border::Draw(const PerFrameContext& presetPerFrameContext)\n             float innerRadius = (border == 0) ? 1.0f - outerBorderSize : 1.0f - outerBorderSize - innerBorderSize;\n             float outerRadius = (border == 0) ? 1.0f : 1.0f - outerBorderSize;\n \n-            vertices[0].x = innerRadius;\n-            vertices[1].x = outerRadius;\n-            vertices[2].x = outerRadius;\n-            vertices[3].x = innerRadius;\n-            vertices[0].y = innerRadius;\n-            vertices[1].y = outerRadius;\n-            vertices[2].y = -outerRadius;\n-            vertices[3].y = -innerRadius;\n-\n-            for (int rot = 0; rot < 4; rot++)\n-            {\n-                glBufferSubData(GL_ARRAY_BUFFER, 0, sizeof(Point) * 4, vertices.data());\n-                glDrawArrays(GL_TRIANGLE_FAN, 0, 4);\n-\n-                // Rotate 90 degrees\n-                // Milkdrop code calculates cos(PI/2) and sin(PI/2), which is 0 and 1 respectively.\n-                // Our code here simplifies the expressions accordingly.\n-                for (int vertex = 0; vertex < 4; vertex++)\n-                {\n-                    float const x = vertices[vertex].x;\n-                    float const y = vertices[vertex].y;\n-                    vertices[vertex].x = -y; // x * cos(PI/2) - y * sin(PI/2) == x * 0 - y * 1\n-                    vertices[vertex].y = x;  // x * sin(PI/2) + y * cos(PI/2) == x * 1 + y * 0\n-                }\n-            }\n+             m_borderMesh.Vertices().Set({{outerRadius, outerRadius},\n+                                                     {outerRadius, -outerRadius},\n+                                                     {-outerRadius, outerRadius},\n+                                                     {-outerRadius, -outerRadius},\n+                                                     {innerRadius, innerRadius},\n+                                                     {innerRadius, -innerRadius},\n+                                                     {-innerRadius, innerRadius},\n+                                                     {-innerRadius, -innerRadius}});\n+\n+            m_borderMesh.Update();\n+            m_borderMesh.Draw();\n         }\n     }\n \n+    Renderer::Mesh::Unbind();\n     Renderer::Shader::Unbind();\n \n     glDisable(GL_BLEND);\n-    glBindBuffer(GL_ARRAY_BUFFER, 0);\n-    glBindVertexArray(0);\n }\n \n } // namespace MilkdropPreset"
            },
            {
                "filename": "src/libprojectM/MilkdropPreset/Border.hpp",
                "status": "modified",
                "additions": 3,
                "deletions": 4,
                "changes": 7,
                "patch": "@@ -3,7 +3,7 @@\n #include \"PerFrameContext.hpp\"\n #include \"PresetState.hpp\"\n \n-#include \"Renderer/RenderItem.hpp\"\n+#include <Renderer/Mesh.hpp>\n \n namespace libprojectM {\n namespace MilkdropPreset {\n@@ -12,15 +12,13 @@ namespace MilkdropPreset {\n /**\n  * @brief Renders a border around the screen.\n  */\n-class Border : public Renderer::RenderItem\n+class Border\n {\n public:\n     Border() = delete;\n \n     explicit Border(PresetState& presetState);\n \n-    void InitVertexAttrib() override;\n-\n     /**\n      * Draws the border.\n      * @param presetPerFrameContext The per-frame context variables.\n@@ -29,6 +27,7 @@ class Border : public Renderer::RenderItem\n \n private:\n     PresetState& m_presetState; //!< The global preset state.\n+    Renderer::Mesh m_borderMesh; //!< The border geometry.\n };\n \n } // namespace MilkdropPreset"
            }
        ],
        "lines_added": 32,
        "lines_removed": 47
    },
    "issues": [],
    "pull_requests": [],
    "build_info": {
        "old_build_script": [
            "apt-get update",
            "cmake -S /test_workspace/workspace/old -B /test_workspace/workspace/old/build -DCMAKE_BUILD_TYPE=Debug -DCMAKE_EXPORT_COMPILE_COMMANDS=ON -DENABLE_TESTING=ON -DBUILD_TESTING=ON",
            "cmake --build /test_workspace/workspace/old/build -- -j 1"
        ],
        "new_build_script": [
            "apt-get update",
            "cmake -S /test_workspace/workspace/new -B /test_workspace/workspace/new/build -DCMAKE_BUILD_TYPE=Debug -DCMAKE_EXPORT_COMPILE_COMMANDS=ON -DENABLE_TESTING=ON -DBUILD_TESTING=ON",
            "cmake --build /test_workspace/workspace/new/build -- -j 1"
        ],
        "old_test_script": [
            "cd /test_workspace/workspace/old/build",
            "ctest --output-on-failure"
        ],
        "new_test_script": [
            "cd /test_workspace/workspace/new/build",
            "ctest --output-on-failure"
        ],
        "build_system": "cmake"
    },
    "performance_analysis": {
        "is_significant": false,
        "p_value": 0.8948861257792449,
        "is_pair_significant": false,
        "pair_p_value": 0.8798324542367361,
        "is_binom_significant": false,
        "binom_p_value": 0.9999999711290002,
        "is_wilcoxon_significant": false,
        "wilcoxon_p_value": 0.9999640780804708,
        "is_mannwhitney_significant": false,
        "mannwhitney_p_value": 0.28508125885414476,
        "relative_improvement": 0.01612903225806453,
        "absolute_improvement_ms": 0.3333333333333348,
        "old_mean_ms": 20.66666666666667,
        "new_mean_ms": 20.333333333333336,
        "old_std_ms": 2.537081317024624,
        "new_std_ms": 1.8257418583505538,
        "effect_size_cohens_d": 0.15081478057278036,
        "old_ci95_ms": [
            19.719304933435353,
            21.614028399897986
        ],
        "new_ci95_ms": [
            19.6515901192891,
            21.01507654737757
        ],
        "old_ci99_ms": [
            19.389893402011403,
            21.943439931321937
        ],
        "new_ci99_ms": [
            19.41453803210989,
            21.25212863455678
        ],
        "new_times_s": [
            0.02,
            0.02,
            0.02,
            0.02,
            0.02,
            0.02,
            0.02,
            0.02,
            0.02,
            0.02,
            0.02,
            0.02,
            0.02,
            0.03,
            0.02,
            0.02,
            0.02,
            0.02,
            0.02,
            0.02,
            0.02,
            0.02,
            0.02,
            0.02,
            0.02,
            0.02,
            0.02,
            0.02,
            0.02,
            0.02,
            0.02
        ],
        "old_times_s": [
            0.02,
            0.02,
            0.02,
            0.02,
            0.02,
            0.02,
            0.02,
            0.02,
            0.02,
            0.02,
            0.02,
            0.02,
            0.02,
            0.02,
            0.02,
            0.02,
            0.02,
            0.02,
            0.02,
            0.02,
            0.03,
            0.02,
            0.02,
            0.02,
            0.02,
            0.02,
            0.02,
            0.02,
            0.02,
            0.03,
            0.02
        ]
    },
    "tests": {
        "total_tests": 1,
        "significant_improvements": 0,
        "significant_improvements_tests": [],
        "significant_regressions": 0,
        "significant_regressions_tests": [],
        "significant_pair_improvements": 0,
        "significant_pair_improvements_tests": [],
        "significant_pair_regressions": 0,
        "significant_pair_regressions_tests": [],
        "significant_binom_improvements": 0,
        "significant_binom_improvements_tests": [],
        "significant_binom_regressions": 0,
        "significant_binom_regressions_tests": [],
        "significant_wilcoxon_improvements": 0,
        "significant_wilcoxon_improvements_tests": [],
        "significant_wilcoxon_regressions": 0,
        "significant_wilcoxon_regressions_tests": [],
        "significant_mannwhitney_improvements": 0,
        "significant_mannwhitney_improvements_tests": [],
        "significant_mannwhitney_regressions": 0,
        "significant_mannwhitney_regressions_tests": [],
        "tests": [
            {
                "test_name": "projectM-unittest",
                "is_significant": false,
                "p_value": 0.698593320008648,
                "is_pair_significant": false,
                "pair_p_value": 0.68950897814047,
                "is_binom_significant": false,
                "binom_p_value": 0.9999999981373549,
                "is_wilcoxon_significant": false,
                "wilcoxon_p_value": 0.9999978486102682,
                "is_mannwhitney_significant": false,
                "mannwhitney_p_value": 0.16714290224817413,
                "relative_improvement": 0.03333333333333337,
                "absolute_improvement_ms": 0.3448275862068962,
                "old_mean_ms": 10.344827586206899,
                "new_mean_ms": 10.000000000000002,
                "old_std_ms": 1.8569533817705186,
                "new_std_ms": 1.7654289301252243e-15,
                "effect_size_cohens_d": 0.26261286571944487,
                "old_ci95_ms": [
                    9.638480295932675,
                    11.05117487648112
                ],
                "new_ci95_ms": [
                    10.000000000000002,
                    10.000000000000002
                ],
                "old_ci99_ms": [
                    9.391978463634116,
                    11.29767670877968
                ],
                "new_ci99_ms": [
                    10.0,
                    10.000000000000004
                ],
                "new_times": [
                    0.01,
                    0.01,
                    0.01,
                    0.01,
                    0.01,
                    0.01,
                    0.01,
                    0.01,
                    0.01,
                    0.01,
                    0.01,
                    0.01,
                    0.01,
                    0.01,
                    0.01,
                    0.01,
                    0.01,
                    0.01,
                    0.01,
                    0.01,
                    0.01,
                    0.01,
                    0.01,
                    0.01,
                    0.01,
                    0.01,
                    0.01,
                    0.01,
                    0.01
                ],
                "old_times": [
                    0.01,
                    0.01,
                    0.01,
                    0.01,
                    0.01,
                    0.01,
                    0.01,
                    0.01,
                    0.01,
                    0.01,
                    0.01,
                    0.01,
                    0.01,
                    0.01,
                    0.01,
                    0.01,
                    0.01,
                    0.01,
                    0.02,
                    0.01,
                    0.01,
                    0.01,
                    0.01,
                    0.01,
                    0.01,
                    0.01,
                    0.01,
                    0.01,
                    0.01
                ]
            }
        ]
    },
    "logs": {
        "full_log_path": "/logs/full.log",
        "config_log_path": "/logs/config.log",
        "build_log_path": "/logs/build.log",
        "test_log_path": "/logs/test.log",
        "build_success": true,
        "test_success": true
    },
    "raw_timing_data": {
        "warmup_runs": 1,
        "measurement_runs": 30,
        "min_exec_time_improvement": 0.05,
        "min_p_value": 0.05
    }
}