{
    "metadata": {
        "collection_date": "2026-01-14T18:38:06.863406",
        "repository": "https://github.com/quick-lint/quick-lint-js",
        "repository_name": "quick-lint/quick-lint-js"
    },
    "commit_info": {
        "old_sha": "0fe3faeb2a24fc054406370517ab06dabad61e9a",
        "new_sha": "525ce4bd9ebbac928201b36bef11de25666356c0",
        "commit_message": [
            "Refactor: unsynchronized_pool_resource -> linked_bump_allocator\n\nReplace a use of unsynchronized_pool_resource with\nlinked_bump_allocator. Take care to release allocated memory promptly to\nreduce peak memory usage. (That's why unsynchronized_pool_resource was\nused in the first place. linked_bump_allocator's rewind feature didn't\nexist at the time.)\n\nFor a 1 megabyte test case found through fuzz testing\n(oom-d947c7d48a36544fa212033c6c94d8caeef99539), this commit increases\npeak memory usage from 225 MiB to 254 MiB. However, execution time\ndropped from 5.55 seconds to 1.15 seconds."
        ],
        "commit_date": "2021-12-29T06:01:16+00:00",
        "patch": [
            "--- src/lex.cpp\n@@ -1055,7 +1055,7 @@ lexer_transaction lexer::begin_transaction() {\n       /*old_input=*/this->input_,\n       /*error_reporter_pointer=*/\n       &this->error_reporter_,\n-      /*memory=*/&this->temporary_allocator_);\n+      /*memory=*/&this->transaction_allocator_);\n }\n \n void lexer::commit_transaction(lexer_transaction&& transaction) {\n--- src/quick-lint-js/lex.h\n@@ -4,14 +4,13 @@\n #ifndef QUICK_LINT_JS_LEX_H\n #define QUICK_LINT_JS_LEX_H\n \n-#include <boost/container/pmr/memory_resource.hpp>\n-#include <boost/container/pmr/unsynchronized_pool_resource.hpp>\n #include <cstddef>\n #include <cstdint>\n #include <optional>\n #include <quick-lint-js/buffering-error-reporter.h>\n #include <quick-lint-js/char8.h>\n #include <quick-lint-js/identifier.h>\n+#include <quick-lint-js/linked-bump-allocator.h>\n #include <quick-lint-js/location.h>\n #include <quick-lint-js/monotonic-allocator.h>\n #include <quick-lint-js/narrow-cast.h>\n@@ -296,21 +295,24 @@ class lexer {\n   padded_string_view original_input_;\n \n   monotonic_allocator allocator_;\n-  boost::container::pmr::unsynchronized_pool_resource temporary_allocator_;\n+  linked_bump_allocator<alignof(void*)> transaction_allocator_;\n };\n \n struct lexer_transaction {\n   // Private to lexer. Do not construct, read, or modify.\n \n+  using allocator_type = linked_bump_allocator<alignof(void*)>;\n+\n   explicit lexer_transaction(token old_last_token,\n                              const char8* old_last_last_token_end,\n                              const char8* old_input,\n                              error_reporter** error_reporter_pointer,\n-                             boost::container::pmr::memory_resource* memory)\n-      : old_last_token(old_last_token),\n+                             allocator_type* allocator)\n+      : allocator_rewind(allocator),\n+        old_last_token(old_last_token),\n         old_last_last_token_end(old_last_last_token_end),\n         old_input(old_input),\n-        reporter(memory),\n+        reporter(allocator),\n         old_error_reporter(\n             std::exchange(*error_reporter_pointer, &this->reporter)) {}\n \n@@ -319,6 +321,10 @@ struct lexer_transaction {\n   lexer_transaction(const lexer_transaction&) = delete;\n   lexer_transaction& operator=(const lexer_transaction&) = delete;\n \n+  // Rewinds memory allocated by 'reporter'. Must be constructed before\n+  // 'reporter' (thus destructed after 'reporter').\n+  allocator_type::rewind_guard allocator_rewind;\n+\n   token old_last_token;\n   const char8* old_last_last_token_end;\n   const char8* old_input;"
        ],
        "files_changed": [
            {
                "filename": "src/lex.cpp",
                "status": "modified",
                "additions": 1,
                "deletions": 1,
                "changes": 2,
                "patch": "@@ -1055,7 +1055,7 @@ lexer_transaction lexer::begin_transaction() {\n       /*old_input=*/this->input_,\n       /*error_reporter_pointer=*/\n       &this->error_reporter_,\n-      /*memory=*/&this->temporary_allocator_);\n+      /*memory=*/&this->transaction_allocator_);\n }\n \n void lexer::commit_transaction(lexer_transaction&& transaction) {"
            },
            {
                "filename": "src/quick-lint-js/lex.h",
                "status": "modified",
                "additions": 12,
                "deletions": 6,
                "changes": 18,
                "patch": "@@ -4,14 +4,13 @@\n #ifndef QUICK_LINT_JS_LEX_H\n #define QUICK_LINT_JS_LEX_H\n \n-#include <boost/container/pmr/memory_resource.hpp>\n-#include <boost/container/pmr/unsynchronized_pool_resource.hpp>\n #include <cstddef>\n #include <cstdint>\n #include <optional>\n #include <quick-lint-js/buffering-error-reporter.h>\n #include <quick-lint-js/char8.h>\n #include <quick-lint-js/identifier.h>\n+#include <quick-lint-js/linked-bump-allocator.h>\n #include <quick-lint-js/location.h>\n #include <quick-lint-js/monotonic-allocator.h>\n #include <quick-lint-js/narrow-cast.h>\n@@ -296,21 +295,24 @@ class lexer {\n   padded_string_view original_input_;\n \n   monotonic_allocator allocator_;\n-  boost::container::pmr::unsynchronized_pool_resource temporary_allocator_;\n+  linked_bump_allocator<alignof(void*)> transaction_allocator_;\n };\n \n struct lexer_transaction {\n   // Private to lexer. Do not construct, read, or modify.\n \n+  using allocator_type = linked_bump_allocator<alignof(void*)>;\n+\n   explicit lexer_transaction(token old_last_token,\n                              const char8* old_last_last_token_end,\n                              const char8* old_input,\n                              error_reporter** error_reporter_pointer,\n-                             boost::container::pmr::memory_resource* memory)\n-      : old_last_token(old_last_token),\n+                             allocator_type* allocator)\n+      : allocator_rewind(allocator),\n+        old_last_token(old_last_token),\n         old_last_last_token_end(old_last_last_token_end),\n         old_input(old_input),\n-        reporter(memory),\n+        reporter(allocator),\n         old_error_reporter(\n             std::exchange(*error_reporter_pointer, &this->reporter)) {}\n \n@@ -319,6 +321,10 @@ struct lexer_transaction {\n   lexer_transaction(const lexer_transaction&) = delete;\n   lexer_transaction& operator=(const lexer_transaction&) = delete;\n \n+  // Rewinds memory allocated by 'reporter'. Must be constructed before\n+  // 'reporter' (thus destructed after 'reporter').\n+  allocator_type::rewind_guard allocator_rewind;\n+\n   token old_last_token;\n   const char8* old_last_last_token_end;\n   const char8* old_input;"
            }
        ],
        "lines_added": 13,
        "lines_removed": 7
    },
    "issues": [],
    "pull_requests": [],
    "build_info": {
        "old_build_script": [
            "apt-get update",
            "cmake -S /test_workspace/workspace/old -B /test_workspace/workspace/old/build -DCMAKE_BUILD_TYPE=Debug -DCMAKE_EXPORT_COMPILE_COMMANDS=ON -DBENCHMARK_ENABLE_ASSEMBLY_TESTS=ON -DBUILD_TESTING=ON -DBENCHMARK_ENABLE_GTEST_TESTS=ON -DBENCHMARK_ENABLE_TESTING=ON",
            "cmake --build /test_workspace/workspace/old/build -- -j 1"
        ],
        "new_build_script": [
            "apt-get update",
            "cmake -S /test_workspace/workspace/new -B /test_workspace/workspace/new/build -DCMAKE_BUILD_TYPE=Debug -DCMAKE_EXPORT_COMPILE_COMMANDS=ON -DBENCHMARK_ENABLE_ASSEMBLY_TESTS=ON -DBUILD_TESTING=ON -DBENCHMARK_ENABLE_GTEST_TESTS=ON -DBENCHMARK_ENABLE_TESTING=ON",
            "cmake --build /test_workspace/workspace/new/build -- -j 1"
        ],
        "old_test_script": [
            "cd /test_workspace/workspace/old/build",
            "ctest --output-on-failure"
        ],
        "new_test_script": [
            "cd /test_workspace/workspace/new/build",
            "ctest --output-on-failure"
        ],
        "build_system": "cmake"
    },
    "performance_analysis": {
        "is_significant": false,
        "p_value": 0.9999999999999988,
        "is_pair_significant": false,
        "pair_p_value": 0.9999999999965987,
        "is_binom_significant": false,
        "binom_p_value": 0.9999999990686774,
        "is_wilcoxon_significant": false,
        "wilcoxon_p_value": 0.9999991098268207,
        "is_mannwhitney_significant": false,
        "mannwhitney_p_value": 2.3632352239113796e-10,
        "relative_improvement": 0.022171503097489508,
        "absolute_improvement_ms": 22.666666666666835,
        "old_mean_ms": 1022.3333333333335,
        "new_mean_ms": 999.6666666666667,
        "old_std_ms": 12.228664272317634,
        "new_std_ms": 6.686751354593723,
        "effect_size_cohens_d": 2.299952833750165,
        "old_ci95_ms": [
            1017.7670750496957,
            1026.8995916169715
        ],
        "new_ci95_ms": [
            997.1697926758859,
            1002.1635406574476
        ],
        "old_ci99_ms": [
            1016.1793202551675,
            1028.4873464114996
        ],
        "new_ci99_ms": [
            996.3015930682552,
            1003.0317402650782
        ],
        "new_times_s": [
            1.0,
            1.0,
            0.99,
            1.01,
            1.0,
            0.99,
            1.0,
            0.99,
            0.99,
            1.0,
            1.01,
            1.0,
            1.0,
            1.0,
            0.99,
            1.0,
            1.0,
            1.01,
            1.0,
            1.01,
            1.0,
            1.0,
            1.01,
            0.99,
            1.0,
            1.0,
            1.01,
            1.0,
            1.0,
            0.99,
            1.0
        ],
        "old_times_s": [
            1.02,
            1.04,
            1.01,
            1.02,
            1.0,
            1.02,
            1.02,
            1.01,
            1.04,
            1.02,
            1.02,
            1.04,
            1.04,
            1.01,
            1.02,
            1.02,
            1.02,
            1.01,
            1.03,
            1.03,
            1.02,
            1.03,
            1.04,
            1.05,
            1.02,
            1.03,
            1.01,
            1.01,
            1.01,
            1.01,
            1.02
        ]
    },
    "tests": {
        "total_tests": 2,
        "significant_improvements": 0,
        "significant_improvements_tests": [],
        "significant_regressions": 0,
        "significant_regressions_tests": [],
        "significant_pair_improvements": 0,
        "significant_pair_improvements_tests": [],
        "significant_pair_regressions": 0,
        "significant_pair_regressions_tests": [],
        "significant_binom_improvements": 0,
        "significant_binom_improvements_tests": [],
        "significant_binom_regressions": 0,
        "significant_binom_regressions_tests": [],
        "significant_wilcoxon_improvements": 0,
        "significant_wilcoxon_improvements_tests": [],
        "significant_wilcoxon_regressions": 0,
        "significant_wilcoxon_regressions_tests": [],
        "significant_mannwhitney_improvements": 1,
        "significant_mannwhitney_improvements_tests": [
            "quick-lint-js-test"
        ],
        "significant_mannwhitney_regressions": 0,
        "significant_mannwhitney_regressions_tests": [],
        "tests": [
            {
                "test_name": "quick-lint-js-test",
                "is_significant": false,
                "p_value": 1.0,
                "is_pair_significant": false,
                "pair_p_value": 0.9999999999994086,
                "is_binom_significant": false,
                "binom_p_value": 0.9999999441206455,
                "is_wilcoxon_significant": false,
                "wilcoxon_p_value": 0.9999996100763573,
                "is_mannwhitney_significant": false,
                "mannwhitney_p_value": 0.030711281372905755,
                "relative_improvement": 0.00645855758880522,
                "absolute_improvement_ms": 2.0689655172413945,
                "old_mean_ms": 320.3448275862069,
                "new_mean_ms": 318.2758620689655,
                "old_std_ms": 4.211174438061581,
                "new_std_ms": 3.8442587221924502,
                "effect_size_cohens_d": 0.5131499624988222,
                "old_ci95_ms": [
                    318.742982498227,
                    321.94667267418686
                ],
                "new_ci95_ms": [
                    316.81358425510643,
                    319.7381398828246
                ],
                "old_ci99_ms": [
                    318.18396888738374,
                    322.5056862850301
                ],
                "new_ci99_ms": [
                    316.30327698075433,
                    320.2484471571767
                ],
                "new_times": [
                    0.31,
                    0.32,
                    0.32,
                    0.31,
                    0.32,
                    0.31,
                    0.31,
                    0.32,
                    0.32,
                    0.32,
                    0.32,
                    0.32,
                    0.32,
                    0.32,
                    0.32,
                    0.32,
                    0.32,
                    0.32,
                    0.32,
                    0.32,
                    0.32,
                    0.31,
                    0.32,
                    0.32,
                    0.32,
                    0.32,
                    0.32,
                    0.32,
                    0.32
                ],
                "old_times": [
                    0.31,
                    0.32,
                    0.32,
                    0.32,
                    0.32,
                    0.32,
                    0.33,
                    0.32,
                    0.32,
                    0.32,
                    0.32,
                    0.32,
                    0.32,
                    0.32,
                    0.32,
                    0.32,
                    0.32,
                    0.32,
                    0.31,
                    0.33,
                    0.32,
                    0.33,
                    0.32,
                    0.32,
                    0.32,
                    0.32,
                    0.32,
                    0.32,
                    0.32
                ]
            },
            {
                "test_name": "quick-lint-js-test-cli",
                "is_significant": false,
                "p_value": 1.0,
                "is_pair_significant": false,
                "pair_p_value": 1.0,
                "is_binom_significant": false,
                "binom_p_value": 1.0,
                "is_wilcoxon_significant": false,
                "wilcoxon_p_value": 0.9999999638108507,
                "is_mannwhitney_significant": false,
                "mannwhitney_p_value": 1.0,
                "relative_improvement": 0.0,
                "absolute_improvement_ms": 0.0,
                "old_mean_ms": 89.99999999999999,
                "new_mean_ms": 89.99999999999999,
                "old_std_ms": 1.4123431441001795e-14,
                "new_std_ms": 1.4123431441001795e-14,
                "effect_size_cohens_d": 0.0,
                "old_ci95_ms": [
                    89.99999999999999,
                    89.99999999999999
                ],
                "new_ci95_ms": [
                    89.99999999999999,
                    89.99999999999999
                ],
                "old_ci99_ms": [
                    89.99999999999997,
                    90.0
                ],
                "new_ci99_ms": [
                    89.99999999999997,
                    90.0
                ],
                "new_times": [
                    0.09,
                    0.09,
                    0.09,
                    0.09,
                    0.09,
                    0.09,
                    0.09,
                    0.09,
                    0.09,
                    0.09,
                    0.09,
                    0.09,
                    0.09,
                    0.09,
                    0.09,
                    0.09,
                    0.09,
                    0.09,
                    0.09,
                    0.09,
                    0.09,
                    0.09,
                    0.09,
                    0.09,
                    0.09,
                    0.09,
                    0.09,
                    0.09,
                    0.09
                ],
                "old_times": [
                    0.09,
                    0.09,
                    0.09,
                    0.09,
                    0.09,
                    0.09,
                    0.09,
                    0.09,
                    0.09,
                    0.09,
                    0.09,
                    0.09,
                    0.09,
                    0.09,
                    0.09,
                    0.09,
                    0.09,
                    0.09,
                    0.09,
                    0.09,
                    0.09,
                    0.09,
                    0.09,
                    0.09,
                    0.09,
                    0.09,
                    0.09,
                    0.09,
                    0.09
                ]
            }
        ]
    },
    "logs": {
        "full_log_path": "/logs/full.log",
        "config_log_path": "/logs/config.log",
        "build_log_path": "/logs/build.log",
        "test_log_path": "/logs/test.log",
        "build_success": true,
        "test_success": true
    },
    "raw_timing_data": {
        "warmup_runs": 1,
        "measurement_runs": 30,
        "min_exec_time_improvement": 0.05,
        "min_p_value": 0.05
    }
}