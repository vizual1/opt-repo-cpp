{
    "metadata": {
        "collection_date": "2026-01-14T18:41:00.824073",
        "repository": "https://github.com/google/highway",
        "repository_name": "google/highway"
    },
    "commit_info": {
        "old_sha": "8bb924b757032dbfb27ff572bae8e2219bda3d0f",
        "new_sha": "704ef25a87edf547fc4375a2692b8e5f59cf8ea6",
        "commit_message": [
            "use O(N) build-heap in vqsort"
        ],
        "commit_date": "2022-06-21T10:17:17+00:00",
        "patch": [
            "--- hwy/contrib/sort/vqsort-inl.h\n@@ -61,6 +61,32 @@ using Constants = hwy::SortConstants;\n \n // ------------------------------ HeapSort\n \n+template <class Traits, typename T>\n+void SiftDown(Traits st, T* HWY_RESTRICT lanes, const size_t num_lanes,\n+              size_t start) {\n+  constexpr size_t N1 = st.LanesPerKey();\n+  const FixedTag<T, N1> d;\n+\n+  while (start < num_lanes) {\n+    const size_t left = 2 * start + N1;\n+    const size_t right = 2 * start + 2 * N1;\n+    if (left >= num_lanes) break;\n+    size_t idx_larger = start;\n+    const auto key_j = st.SetKey(d, lanes + start);\n+    if (AllTrue(d, st.Compare(d, key_j, st.SetKey(d, lanes + left)))) {\n+      idx_larger = left;\n+    }\n+    if (right < num_lanes &&\n+        AllTrue(d, st.Compare(d, st.SetKey(d, lanes + idx_larger),\n+                              st.SetKey(d, lanes + right)))) {\n+      idx_larger = right;\n+    }\n+    if (idx_larger == start) break;\n+    st.Swap(lanes + start, lanes + idx_larger);\n+    start = idx_larger;\n+  }\n+}\n+\n // Heapsort: O(1) space, O(N*logN) worst-case comparisons.\n // Based on LLVM sanitizer_common.h, licensed under Apache-2.0.\n template <class Traits, typename T>\n@@ -71,43 +97,16 @@ void HeapSort(Traits st, T* HWY_RESTRICT lanes, const size_t num_lanes) {\n   if (num_lanes < 2 * N1) return;\n \n   // Build heap.\n-  for (size_t i = N1; i < num_lanes; i += N1) {\n-    size_t j = i;\n-    while (j != 0) {\n-      const size_t idx_parent = ((j - N1) / N1 / 2) * N1;\n-      if (AllFalse(d, st.Compare(d, st.SetKey(d, lanes + idx_parent),\n-                                 st.SetKey(d, lanes + j)))) {\n-        break;\n-      }\n-      st.Swap(lanes + j, lanes + idx_parent);\n-      j = idx_parent;\n-    }\n+  for (size_t i = ((num_lanes - N1) / N1 / 2) * N1; i != (size_t)-N1; i -= N1) {\n+    SiftDown(st, lanes, num_lanes, i);\n   }\n \n   for (size_t i = num_lanes - N1; i != 0; i -= N1) {\n     // Swap root with last\n     st.Swap(lanes + 0, lanes + i);\n \n     // Sift down the new root.\n-    size_t j = 0;\n-    while (j < i) {\n-      const size_t left = 2 * j + N1;\n-      const size_t right = 2 * j + 2 * N1;\n-      if (left >= i) break;\n-      size_t idx_larger = j;\n-      const auto key_j = st.SetKey(d, lanes + j);\n-      if (AllTrue(d, st.Compare(d, key_j, st.SetKey(d, lanes + left)))) {\n-        idx_larger = left;\n-      }\n-      if (right < i &&\n-          AllTrue(d, st.Compare(d, st.SetKey(d, lanes + idx_larger),\n-                                st.SetKey(d, lanes + right)))) {\n-        idx_larger = right;\n-      }\n-      if (idx_larger == j) break;\n-      st.Swap(lanes + j, lanes + idx_larger);\n-      j = idx_larger;\n-    }\n+    SiftDown(st, lanes, i, 0);\n   }\n }\n "
        ],
        "files_changed": [
            {
                "filename": "hwy/contrib/sort/vqsort-inl.h",
                "status": "modified",
                "additions": 29,
                "deletions": 30,
                "changes": 59,
                "patch": "@@ -61,6 +61,32 @@ using Constants = hwy::SortConstants;\n \n // ------------------------------ HeapSort\n \n+template <class Traits, typename T>\n+void SiftDown(Traits st, T* HWY_RESTRICT lanes, const size_t num_lanes,\n+              size_t start) {\n+  constexpr size_t N1 = st.LanesPerKey();\n+  const FixedTag<T, N1> d;\n+\n+  while (start < num_lanes) {\n+    const size_t left = 2 * start + N1;\n+    const size_t right = 2 * start + 2 * N1;\n+    if (left >= num_lanes) break;\n+    size_t idx_larger = start;\n+    const auto key_j = st.SetKey(d, lanes + start);\n+    if (AllTrue(d, st.Compare(d, key_j, st.SetKey(d, lanes + left)))) {\n+      idx_larger = left;\n+    }\n+    if (right < num_lanes &&\n+        AllTrue(d, st.Compare(d, st.SetKey(d, lanes + idx_larger),\n+                              st.SetKey(d, lanes + right)))) {\n+      idx_larger = right;\n+    }\n+    if (idx_larger == start) break;\n+    st.Swap(lanes + start, lanes + idx_larger);\n+    start = idx_larger;\n+  }\n+}\n+\n // Heapsort: O(1) space, O(N*logN) worst-case comparisons.\n // Based on LLVM sanitizer_common.h, licensed under Apache-2.0.\n template <class Traits, typename T>\n@@ -71,43 +97,16 @@ void HeapSort(Traits st, T* HWY_RESTRICT lanes, const size_t num_lanes) {\n   if (num_lanes < 2 * N1) return;\n \n   // Build heap.\n-  for (size_t i = N1; i < num_lanes; i += N1) {\n-    size_t j = i;\n-    while (j != 0) {\n-      const size_t idx_parent = ((j - N1) / N1 / 2) * N1;\n-      if (AllFalse(d, st.Compare(d, st.SetKey(d, lanes + idx_parent),\n-                                 st.SetKey(d, lanes + j)))) {\n-        break;\n-      }\n-      st.Swap(lanes + j, lanes + idx_parent);\n-      j = idx_parent;\n-    }\n+  for (size_t i = ((num_lanes - N1) / N1 / 2) * N1; i != (size_t)-N1; i -= N1) {\n+    SiftDown(st, lanes, num_lanes, i);\n   }\n \n   for (size_t i = num_lanes - N1; i != 0; i -= N1) {\n     // Swap root with last\n     st.Swap(lanes + 0, lanes + i);\n \n     // Sift down the new root.\n-    size_t j = 0;\n-    while (j < i) {\n-      const size_t left = 2 * j + N1;\n-      const size_t right = 2 * j + 2 * N1;\n-      if (left >= i) break;\n-      size_t idx_larger = j;\n-      const auto key_j = st.SetKey(d, lanes + j);\n-      if (AllTrue(d, st.Compare(d, key_j, st.SetKey(d, lanes + left)))) {\n-        idx_larger = left;\n-      }\n-      if (right < i &&\n-          AllTrue(d, st.Compare(d, st.SetKey(d, lanes + idx_larger),\n-                                st.SetKey(d, lanes + right)))) {\n-        idx_larger = right;\n-      }\n-      if (idx_larger == j) break;\n-      st.Swap(lanes + j, lanes + idx_larger);\n-      j = idx_larger;\n-    }\n+    SiftDown(st, lanes, i, 0);\n   }\n }\n "
            }
        ],
        "lines_added": 29,
        "lines_removed": 30
    },
    "issues": [],
    "pull_requests": [],
    "build_info": {
        "old_build_script": [
            "apt-get update",
            "cmake -S /test_workspace/workspace/old -B /test_workspace/workspace/old/build -DCMAKE_BUILD_TYPE=Debug -DCMAKE_EXPORT_COMPILE_COMMANDS=ON -DBUILD_TESTING=ON",
            "cmake --build /test_workspace/workspace/old/build -- -j 1"
        ],
        "new_build_script": [
            "apt-get update",
            "cmake -S /test_workspace/workspace/new -B /test_workspace/workspace/new/build -DCMAKE_BUILD_TYPE=Debug -DCMAKE_EXPORT_COMPILE_COMMANDS=ON -DBUILD_TESTING=ON",
            "cmake --build /test_workspace/workspace/new/build -- -j 1"
        ],
        "old_test_script": [
            "cd /test_workspace/workspace/old/build",
            "ctest --output-on-failure"
        ],
        "new_test_script": [
            "cd /test_workspace/workspace/new/build",
            "ctest --output-on-failure"
        ],
        "build_system": "cmake"
    },
    "performance_analysis": {
        "is_significant": false,
        "p_value": 1.0,
        "is_pair_significant": false,
        "pair_p_value": 1.0,
        "is_binom_significant": false,
        "binom_p_value": 1.0,
        "is_wilcoxon_significant": false,
        "wilcoxon_p_value": 0.9999991404120431,
        "is_mannwhitney_significant": false,
        "mannwhitney_p_value": 0.38639098508634967,
        "relative_improvement": 0.00025194628505208417,
        "absolute_improvement_ms": 3.3333333333338544,
        "old_mean_ms": 13230.333333333334,
        "new_mean_ms": 13227.0,
        "old_std_ms": 81.26089670520071,
        "new_std_ms": 66.44416894059906,
        "effect_size_cohens_d": 0.04490960007601511,
        "old_ci95_ms": [
            13199.990015825146,
            13260.676650841522
        ],
        "new_ci95_ms": [
            13202.18933956579,
            13251.810660434212
        ],
        "old_ci99_ms": [
            13189.439200504832,
            13271.227466161836
        ],
        "new_ci99_ms": [
            13193.562310034633,
            13260.437689965367
        ],
        "new_times_s": [
            13.1,
            13.16,
            13.21,
            13.18,
            13.15,
            13.22,
            13.17,
            13.27,
            13.16,
            13.14,
            13.08,
            13.26,
            13.17,
            13.27,
            13.21,
            13.23,
            13.14,
            13.33,
            13.32,
            13.24,
            13.21,
            13.24,
            13.23,
            13.21,
            13.23,
            13.27,
            13.36,
            13.24,
            13.27,
            13.36,
            13.28
        ],
        "old_times_s": [
            13.06,
            13.27,
            13.2,
            13.14,
            13.21,
            13.06,
            13.15,
            13.05,
            13.2,
            13.15,
            13.24,
            13.28,
            13.28,
            13.22,
            13.18,
            13.25,
            13.15,
            13.23,
            13.19,
            13.3,
            13.2,
            13.34,
            13.33,
            13.18,
            13.19,
            13.37,
            13.32,
            13.37,
            13.27,
            13.3,
            13.29
        ]
    },
    "tests": {
        "total_tests": 1,
        "significant_improvements": 0,
        "significant_improvements_tests": [],
        "significant_regressions": 0,
        "significant_regressions_tests": [],
        "significant_pair_improvements": 0,
        "significant_pair_improvements_tests": [],
        "significant_pair_regressions": 0,
        "significant_pair_regressions_tests": [],
        "significant_binom_improvements": 0,
        "significant_binom_improvements_tests": [],
        "significant_binom_regressions": 0,
        "significant_binom_regressions_tests": [],
        "significant_wilcoxon_improvements": 0,
        "significant_wilcoxon_improvements_tests": [],
        "significant_wilcoxon_regressions": 0,
        "significant_wilcoxon_regressions_tests": [],
        "significant_mannwhitney_improvements": 0,
        "significant_mannwhitney_improvements_tests": [],
        "significant_mannwhitney_regressions": 0,
        "significant_mannwhitney_regressions_tests": [],
        "tests": [
            {
                "test_name": "NanobenchmarkTest.RunAll",
                "is_significant": false,
                "p_value": 0.9002044300529171,
                "is_pair_significant": false,
                "pair_p_value": 0.9137128470025544,
                "is_binom_significant": false,
                "binom_p_value": 0.77087084017694,
                "is_wilcoxon_significant": false,
                "wilcoxon_p_value": 0.9009321773003307,
                "is_mannwhitney_significant": false,
                "mannwhitney_p_value": 0.5155488735515019,
                "relative_improvement": 0.006384676775738235,
                "absolute_improvement_ms": 2.7586206896552667,
                "old_mean_ms": 432.06896551724145,
                "new_mean_ms": 429.31034482758616,
                "old_std_ms": 59.062878742237054,
                "new_std_ms": 54.44073018841937,
                "effect_size_cohens_d": 0.048568256428025015,
                "old_ci95_ms": [
                    409.60264796456437,
                    454.53528306991853
                ],
                "new_ci95_ms": [
                    408.6021985560433,
                    450.01849109912905
                ],
                "old_ci99_ms": [
                    401.7623284532002,
                    462.3756025812827
                ],
                "new_ci99_ms": [
                    401.3754475374896,
                    457.2452421176827
                ],
                "new_times": [
                    0.5,
                    0.46,
                    0.44,
                    0.49,
                    0.39,
                    0.44,
                    0.38,
                    0.37,
                    0.33,
                    0.46,
                    0.41,
                    0.53,
                    0.45,
                    0.44,
                    0.35,
                    0.53,
                    0.51,
                    0.44,
                    0.41,
                    0.45,
                    0.43,
                    0.34,
                    0.39,
                    0.44,
                    0.47,
                    0.41,
                    0.35,
                    0.45,
                    0.39
                ],
                "old_times": [
                    0.44,
                    0.41,
                    0.52,
                    0.33,
                    0.42,
                    0.39,
                    0.45,
                    0.39,
                    0.45,
                    0.51,
                    0.49,
                    0.46,
                    0.41,
                    0.41,
                    0.34,
                    0.43,
                    0.38,
                    0.38,
                    0.4,
                    0.54,
                    0.49,
                    0.34,
                    0.4,
                    0.56,
                    0.46,
                    0.5,
                    0.39,
                    0.41,
                    0.43
                ]
            }
        ]
    },
    "logs": {
        "full_log_path": "/logs/full.log",
        "config_log_path": "/logs/config.log",
        "build_log_path": "/logs/build.log",
        "test_log_path": "/logs/test.log",
        "build_success": true,
        "test_success": true
    },
    "raw_timing_data": {
        "warmup_runs": 1,
        "measurement_runs": 30,
        "min_exec_time_improvement": 0.05,
        "min_p_value": 0.05
    }
}