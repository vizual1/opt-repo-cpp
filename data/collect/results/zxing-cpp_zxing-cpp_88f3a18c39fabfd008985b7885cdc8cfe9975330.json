{
  "metadata": {
    "collection_date": "2026-01-14T18:39:55.554155",
    "repository": "https://github.com/zxing-cpp/zxing-cpp",
    "repository_name": "zxing-cpp/zxing-cpp"
  },
  "commit_info": {
    "old_sha": "652d2b95b7ba0be16fd9896295b3adb817adc2c0",
    "new_sha": "88f3a18c39fabfd008985b7885cdc8cfe9975330",
    "commit_message": [
      "GlobalHistogramBinarizer: micro optimize\n\nFor non-rotated input, this change makes the `getPatternRow` function\nabout twice as fast. For very select cases (like testing for only one\nlinear barcode) this can reduce the total runtime around 30%."
    ],
    "commit_date": "2023-02-03T01:24:19+00:00",
    "patch": [
      "--- core/src/GlobalHistogramBinarizer.cpp\n@@ -79,8 +79,6 @@ bool GlobalHistogramBinarizer::getPatternRow(int row, int rotation, PatternRow&\n \tif (buffer.width() < 3)\n \t\treturn false; // special casing the code below for a width < 3 makes no sense\n \n-\tres.clear();\n-\n \tconst uint8_t* luminances = buffer.data(0, row);\n \tconst int pixStride = buffer.pixStride();\n \tstd::array<int, LUMINANCE_BUCKETS> buckets = {};\n@@ -91,31 +89,42 @@ bool GlobalHistogramBinarizer::getPatternRow(int row, int rotation, PatternRow&\n \tif (blackPoint <= 0)\n \t\treturn false;\n \n+\tres.resize(buffer.width() + 2);\n+\tstd::fill(res.begin(), res.end(), 0);\n+\tauto* intPos = res.data();\n+\n \tauto* lastPos = luminances;\n \tbool lastVal = luminances[0] < blackPoint;\n \tif (lastVal)\n-\t\tres.push_back(0); // first value is number of white pixels, here 0\n+\t\tintPos++; // first value is number of white pixels, here 0\n \n \tauto process = [&](bool val, const uint8_t* p) {\n-\t\tif (val != lastVal) {\n-\t\t\tres.push_back(narrow_cast<PatternRow::value_type>((p - lastPos) / pixStride));\n-\t\t\tlastVal = val;\n+\t\tbool update = val != lastVal;\n+\t\t*intPos = update * narrow_cast<PatternRow::value_type>((p - lastPos) / pixStride);\n+\t\tintPos += update;\n+\t\tlastVal = val;\n+\t\tif (update)\n \t\t\tlastPos = p;\n-\t\t}\n \t};\n \n-\tfor (auto *p = luminances + pixStride, *e = luminances + (buffer.width() - 1) * pixStride; p < e; p += pixStride)\n-\t\tprocess((-*(p - pixStride) + (int(*p) * 4) - *(p + pixStride)) / 2 < blackPoint, p);\n+\t// the optimizer can generate a specialized version for pixStride==1 (non-rotated input) that is about 2x faster\n+\tif (pixStride == 1)\n+\t\tfor (auto *p = luminances + pixStride, *e = luminances + (buffer.width() - 1) * pixStride; p < e; p += pixStride)\n+\t\t\tprocess((-*(p - pixStride) + (int(*p) * 4) - *(p + pixStride)) / 2 < blackPoint, p);\n+\telse\n+\t\tfor (auto *p = luminances + pixStride, *e = luminances + (buffer.width() - 1) * pixStride; p < e; p += pixStride)\n+\t\t\tprocess((-*(p - pixStride) + (int(*p) * 4) - *(p + pixStride)) / 2 < blackPoint, p);\n \n \tauto* backPos = buffer.data(buffer.width() - 1, row);\n \tbool backVal = *backPos < blackPoint;\n \tprocess(backVal, backPos);\n \n-\tres.push_back(narrow_cast<PatternRow::value_type>((backPos - lastPos) / pixStride + 1));\n+\t*intPos++ = narrow_cast<PatternRow::value_type>((backPos - lastPos) / pixStride + 1);\n \n \tif (backVal)\n-\t\tres.push_back(0); // last value is number of white pixels, here 0\n+\t\tintPos++;\n \n+\tres.resize(intPos - res.data());\n \tassert(res.size() % 2 == 1);\n \n \treturn true;"
    ],
    "files_changed": [
      {
        "filename": "core/src/GlobalHistogramBinarizer.cpp",
        "status": "modified",
        "additions": 20,
        "deletions": 11,
        "changes": 31,
        "patch": "@@ -79,8 +79,6 @@ bool GlobalHistogramBinarizer::getPatternRow(int row, int rotation, PatternRow&\n \tif (buffer.width() < 3)\n \t\treturn false; // special casing the code below for a width < 3 makes no sense\n \n-\tres.clear();\n-\n \tconst uint8_t* luminances = buffer.data(0, row);\n \tconst int pixStride = buffer.pixStride();\n \tstd::array<int, LUMINANCE_BUCKETS> buckets = {};\n@@ -91,31 +89,42 @@ bool GlobalHistogramBinarizer::getPatternRow(int row, int rotation, PatternRow&\n \tif (blackPoint <= 0)\n \t\treturn false;\n \n+\tres.resize(buffer.width() + 2);\n+\tstd::fill(res.begin(), res.end(), 0);\n+\tauto* intPos = res.data();\n+\n \tauto* lastPos = luminances;\n \tbool lastVal = luminances[0] < blackPoint;\n \tif (lastVal)\n-\t\tres.push_back(0); // first value is number of white pixels, here 0\n+\t\tintPos++; // first value is number of white pixels, here 0\n \n \tauto process = [&](bool val, const uint8_t* p) {\n-\t\tif (val != lastVal) {\n-\t\t\tres.push_back(narrow_cast<PatternRow::value_type>((p - lastPos) / pixStride));\n-\t\t\tlastVal = val;\n+\t\tbool update = val != lastVal;\n+\t\t*intPos = update * narrow_cast<PatternRow::value_type>((p - lastPos) / pixStride);\n+\t\tintPos += update;\n+\t\tlastVal = val;\n+\t\tif (update)\n \t\t\tlastPos = p;\n-\t\t}\n \t};\n \n-\tfor (auto *p = luminances + pixStride, *e = luminances + (buffer.width() - 1) * pixStride; p < e; p += pixStride)\n-\t\tprocess((-*(p - pixStride) + (int(*p) * 4) - *(p + pixStride)) / 2 < blackPoint, p);\n+\t// the optimizer can generate a specialized version for pixStride==1 (non-rotated input) that is about 2x faster\n+\tif (pixStride == 1)\n+\t\tfor (auto *p = luminances + pixStride, *e = luminances + (buffer.width() - 1) * pixStride; p < e; p += pixStride)\n+\t\t\tprocess((-*(p - pixStride) + (int(*p) * 4) - *(p + pixStride)) / 2 < blackPoint, p);\n+\telse\n+\t\tfor (auto *p = luminances + pixStride, *e = luminances + (buffer.width() - 1) * pixStride; p < e; p += pixStride)\n+\t\t\tprocess((-*(p - pixStride) + (int(*p) * 4) - *(p + pixStride)) / 2 < blackPoint, p);\n \n \tauto* backPos = buffer.data(buffer.width() - 1, row);\n \tbool backVal = *backPos < blackPoint;\n \tprocess(backVal, backPos);\n \n-\tres.push_back(narrow_cast<PatternRow::value_type>((backPos - lastPos) / pixStride + 1));\n+\t*intPos++ = narrow_cast<PatternRow::value_type>((backPos - lastPos) / pixStride + 1);\n \n \tif (backVal)\n-\t\tres.push_back(0); // last value is number of white pixels, here 0\n+\t\tintPos++;\n \n+\tres.resize(intPos - res.data());\n \tassert(res.size() % 2 == 1);\n \n \treturn true;"
      }
    ],
    "lines_added": 20,
    "lines_removed": 11
  },
  "issues": [],
  "pull_requests": [],
  "build_info": {
    "old_build_script": "#!/bin/bash\n#!/bin/bash\ncmake -S /test_workspace/workspace/old -B /test_workspace/workspace/old/build -DCMAKE_BUILD_TYPE=Debug -DCMAKE_EXPORT_COMPILE_COMMANDS=ON -DBUILD_UNIT_TESTS=ON",
    "new_build_script": "#!/bin/bash\n#!/bin/bash\ncmake -S /test_workspace/workspace/old -B /test_workspace/workspace/old/build -DCMAKE_BUILD_TYPE=Debug -DCMAKE_EXPORT_COMPILE_COMMANDS=ON -DBUILD_UNIT_TESTS=ON",
    "old_test_script": "#!/bin/bash\ncmake --build /test_workspace/workspace/old/build -- -j 1",
    "new_test_script": "#!/bin/bash\ncmake --build /test_workspace/workspace/old/build -- -j 1",
    "build_system": "cmake"
  },
  "performance_analysis": {
    "is_significant": false,
    "p_value": 1.0,
    "is_pair_significant": false,
    "pair_p_value": 0.999999999999999,
    "is_binom_significant": false,
    "binom_p_value": 1.0,
    "is_wilcoxon_significant": false,
    "wilcoxon_p_value": 0.9999991382432266,
    "is_mannwhitney_significant": false,
    "mannwhitney_p_value": 0.018141475997364306,
    "relative_improvement": 0.004749282085266256,
    "absolute_improvement_ms": 43.00000000000104,
    "old_mean_ms": 9054.0,
    "new_mean_ms": 9011.0,
    "old_std_ms": 112.48294889939312,
    "new_std_ms": 97.10818709048179,
    "effect_size_cohens_d": 0.4092231382544793,
    "old_ci95_ms": [
      9011.998176600318,
      9096.001823399682
    ],
    "new_ci95_ms": [
      8974.73920701096,
      9047.26079298904
    ],
    "old_ci99_ms": [
      8997.393528256023,
      9110.606471743979
    ],
    "new_ci99_ms": [
      8962.130798912794,
      9059.869201087206
    ],
    "new_times_s": [
      8.96,
      9.08,
      9.05,
      9.06,
      8.98,
      9.09,
      9.2,
      9.17,
      8.95,
      9.03,
      8.69,
      9.06,
      9.03,
      8.98,
      8.94,
      9.07,
      8.85,
      8.99,
      9.15,
      9.06,
      8.99,
      9.06,
      8.96,
      8.98,
      9.02,
      8.94,
      8.97,
      9.01,
      9.07,
      8.9,
      9.0
    ],
    "old_times_s": [
      9.05,
      9.09,
      9.17,
      8.7,
      9.13,
      8.95,
      8.94,
      9.11,
      9.09,
      9.01,
      8.97,
      9.02,
      9.22,
      9.05,
      9.13,
      9.18,
      9.1,
      9.13,
      9.16,
      9.08,
      9.14,
      9.16,
      9.02,
      9.11,
      9.0,
      9.08,
      8.92,
      8.81,
      9.01,
      9.01,
      9.13
    ]
  },
  "tests": {
    "total_tests": 2,
    "significant_improvements": 0,
    "significant_improvements_tests": [],
    "significant_regressions": 0,
    "significant_regressions_tests": [],
    "significant_pair_improvements": 0,
    "significant_pair_improvements_tests": [],
    "significant_pair_regressions": 0,
    "significant_pair_regressions_tests": [],
    "significant_binom_improvements": 0,
    "significant_binom_improvements_tests": [],
    "significant_binom_regressions": 0,
    "significant_binom_regressions_tests": [],
    "significant_wilcoxon_improvements": 0,
    "significant_wilcoxon_improvements_tests": [],
    "significant_wilcoxon_regressions": 0,
    "significant_wilcoxon_regressions_tests": [],
    "significant_mannwhitney_improvements": 1,
    "significant_mannwhitney_improvements_tests": [
      "UnitTest"
    ],
    "significant_mannwhitney_regressions": 0,
    "significant_mannwhitney_regressions_tests": [],
    "tests": [
      {
        "test_name": "ZXingWriterTest",
        "is_significant": false,
        "p_value": 1.0,
        "is_pair_significant": false,
        "pair_p_value": 1.0,
        "is_binom_significant": false,
        "binom_p_value": 1.0,
        "is_wilcoxon_significant": false,
        "wilcoxon_p_value": 0.9999999638108507,
        "is_mannwhitney_significant": false,
        "mannwhitney_p_value": 1.0,
        "relative_improvement": 0.0,
        "absolute_improvement_ms": 0.0,
        "old_mean_ms": 10.000000000000002,
        "new_mean_ms": 10.000000000000002,
        "old_std_ms": 1.7654289301252243e-15,
        "new_std_ms": 1.7654289301252243e-15,
        "effect_size_cohens_d": 0.0,
        "old_ci95_ms": [
          10.000000000000002,
          10.000000000000002
        ],
        "new_ci95_ms": [
          10.000000000000002,
          10.000000000000002
        ],
        "old_ci99_ms": [
          10.0,
          10.000000000000004
        ],
        "new_ci99_ms": [
          10.0,
          10.000000000000004
        ],
        "new_times": [
          0.01,
          0.01,
          0.01,
          0.01,
          0.01,
          0.01,
          0.01,
          0.01,
          0.01,
          0.01,
          0.01,
          0.01,
          0.01,
          0.01,
          0.01,
          0.01,
          0.01,
          0.01,
          0.01,
          0.01,
          0.01,
          0.01,
          0.01,
          0.01,
          0.01,
          0.01,
          0.01,
          0.01,
          0.01
        ],
        "old_times": [
          0.01,
          0.01,
          0.01,
          0.01,
          0.01,
          0.01,
          0.01,
          0.01,
          0.01,
          0.01,
          0.01,
          0.01,
          0.01,
          0.01,
          0.01,
          0.01,
          0.01,
          0.01,
          0.01,
          0.01,
          0.01,
          0.01,
          0.01,
          0.01,
          0.01,
          0.01,
          0.01,
          0.01,
          0.01
        ]
      },
      {
        "test_name": "UnitTest",
        "is_significant": false,
        "p_value": 1.0,
        "is_pair_significant": false,
        "pair_p_value": 0.9999999999999961,
        "is_binom_significant": false,
        "binom_p_value": 1.0,
        "is_wilcoxon_significant": false,
        "wilcoxon_p_value": 0.9999987253468997,
        "is_mannwhitney_significant": false,
        "mannwhitney_p_value": 0.02230345043783154,
        "relative_improvement": 0.0048058585704477495,
        "absolute_improvement_ms": 43.4482758620689,
        "old_mean_ms": 9040.689655172415,
        "new_mean_ms": 8997.241379310346,
        "old_std_ms": 113.48162326004143,
        "new_std_ms": 97.06023725075286,
        "effect_size_cohens_d": 0.41147846012613953,
        "old_ci95_ms": [
          8997.523554250041,
          9083.855756094788
        ],
        "new_ci95_ms": [
          8960.321639564334,
          9034.161119056356
        ],
        "old_ci99_ms": [
          8982.459402214547,
          9098.919908130283
        ],
        "new_ci99_ms": [
          8947.437349328233,
          9047.04540929246
        ],
        "new_times": [
          9.04,
          9.05,
          8.97,
          9.07,
          9.19,
          9.15,
          8.94,
          9.02,
          8.68,
          9.05,
          9.02,
          8.97,
          8.93,
          9.06,
          8.84,
          8.98,
          9.14,
          9.05,
          8.98,
          9.05,
          8.94,
          8.97,
          9.01,
          8.93,
          8.96,
          9.0,
          9.05,
          8.89,
          8.99
        ],
        "old_times": [
          9.16,
          8.69,
          9.12,
          8.93,
          8.93,
          9.1,
          9.08,
          9.0,
          8.96,
          9.01,
          9.2,
          9.04,
          9.12,
          9.17,
          9.09,
          9.12,
          9.14,
          9.07,
          9.13,
          9.15,
          9.0,
          9.09,
          8.99,
          9.07,
          8.91,
          8.8,
          9.0,
          9.0,
          9.11
        ]
      }
    ]
  },
  "logs": {
    "full_log_path": "/logs/full.log",
    "config_log_path": "/logs/config.log",
    "build_log_path": "/logs/build.log",
    "test_log_path": "/logs/test.log",
    "build_success": true,
    "test_success": true
  },
  "raw_timing_data": {
    "warmup_runs": 1,
    "measurement_runs": 30,
    "min_exec_time_improvement": 0.05,
    "min_p_value": 0.05
  }
}