{
    "metadata": {
        "collection_date": "2026-01-14T18:38:10.143566",
        "repository": "https://github.com/quick-lint/quick-lint-js",
        "repository_name": "quick-lint/quick-lint-js"
    },
    "commit_info": {
        "old_sha": "9366ef72433da0984383fbf19b83e0c88e7e75d0",
        "new_sha": "814e8023467e7cd613561fb519db0b4f7cfb7a33",
        "commit_message": [
            "perf(lsp): improve compile times of simdjson uses even more!\n\ndebug compile times for lsp-server.cpp:\nbefore: 0.492s, 0.490s, 0.463s\nafter:  0.378s, 0.357s, 0.345s"
        ],
        "commit_date": "2023-01-08T21:55:40+00:00",
        "patch": [
            "--- src/quick-lint-js/lsp/lsp-server.cpp\n@@ -50,10 +50,6 @@ std::optional<string_json_token> maybe_get_string_token(\n     ::simdjson::ondemand::value& string);\n std::optional<string_json_token> maybe_get_string_token(\n     ::simdjson::simdjson_result<::simdjson::ondemand::value>&& string);\n-\n-// Returns std::nullopt on failure (e.g. missing key or not an integer).\n-std::optional<int> maybe_get_int(\n-    ::simdjson::simdjson_result<::simdjson::ondemand::value>&&);\n }\n \n lsp_overlay_configuration_filesystem::lsp_overlay_configuration_filesystem(\n@@ -591,29 +587,24 @@ void linting_lsp_server_handler::apply_document_changes(\n     ::simdjson::ondemand::object raw_range;\n     bool is_incremental = get_object(change, \"range\", &raw_range);\n     if (is_incremental) {\n-      auto start = raw_range[\"start\"];\n-      std::optional<int> start_line = maybe_get_int(start[\"line\"]);\n-      std::optional<int> start_character = maybe_get_int(start[\"character\"]);\n-      auto end = raw_range[\"end\"];\n-      std::optional<int> end_line = maybe_get_int(end[\"line\"]);\n-      std::optional<int> end_character = maybe_get_int(end[\"character\"]);\n-      if (!(start_line.has_value() && start_character.has_value() &&\n-            end_line.has_value() && end_character.has_value())) {\n+      lsp_range range;\n+\n+      ::simdjson::ondemand::object start;\n+      if (!(get_object(raw_range, \"start\", &start) &&\n+            get_int(start, \"line\", &range.start.line) &&\n+            get_int(start, \"character\", &range.start.character))) {\n         // Ignore invalid change.\n         continue;\n       }\n-      lsp_range range = {\n-          .start =\n-              {\n-                  .line = *start_line,\n-                  .character = *start_character,\n-              },\n-          .end =\n-              {\n-                  .line = *end_line,\n-                  .character = *end_character,\n-              },\n-      };\n+\n+      ::simdjson::ondemand::object end;\n+      if (!(get_object(raw_range, \"end\", &end) &&\n+            get_int(end, \"line\", &range.end.line) &&\n+            get_int(end, \"character\", &range.end.character))) {\n+        // Ignore invalid change.\n+        continue;\n+      }\n+\n       doc.replace_text(range, change_text);\n     } else {\n       doc.set_text(change_text);\n@@ -711,18 +702,6 @@ std::optional<string_json_token> maybe_get_string_token(\n   }\n   return maybe_get_string_token(s);\n }\n-\n-std::optional<int> maybe_get_int(\n-    ::simdjson::simdjson_result<::simdjson::ondemand::value>&& element) {\n-  std::int64_t int64;\n-  if (element.get(int64) != ::simdjson::error_code::SUCCESS) {\n-    return std::nullopt;\n-  }\n-  if (!in_range<int>(int64)) {\n-    QLJS_UNIMPLEMENTED();\n-  }\n-  return static_cast<int>(int64);\n-}\n }\n }\n \n--- src/quick-lint-js/simdjson.cpp\n@@ -3,6 +3,7 @@\n \n #include <quick-lint-js/assert.h>\n #include <quick-lint-js/port/char8.h>\n+#include <quick-lint-js/port/in-range.h>\n #include <quick-lint-js/port/unreachable.h>\n #include <quick-lint-js/simdjson.h>\n #include <simdjson.h>\n@@ -32,6 +33,11 @@ bool get_object(::simdjson::ondemand::object& root, const char* key1,\n   return root[key1][key2].get(*out) == ::simdjson::SUCCESS;\n }\n \n+bool get_object(::simdjson::ondemand::object& root, const char* key,\n+                ::simdjson::ondemand::object* out) {\n+  return root[key].get(*out) == ::simdjson::SUCCESS;\n+}\n+\n bool get_object(::simdjson::simdjson_result<::simdjson::ondemand::value>& root,\n                 const char* key, ::simdjson::ondemand::object* out) {\n   return root[key].get(*out) == ::simdjson::SUCCESS;\n@@ -91,6 +97,20 @@ bool get_string8(::simdjson::simdjson_result<::simdjson::ondemand::value>& root,\n   *out = to_string8_view(sv);\n   return true;\n }\n+\n+bool get_int(::simdjson::ondemand::object& root, const char* key, int* out) {\n+  std::int64_t int64;\n+  if (root[key].get(int64) != ::simdjson::error_code::SUCCESS) {\n+    return false;\n+  }\n+  if (!in_range<int>(int64)) {\n+    // TODO(strager): What should we do here? Return false? Return something\n+    // else?\n+    QLJS_UNIMPLEMENTED();\n+  }\n+  *out = static_cast<int>(int64);\n+  return true;\n+}\n }\n \n // quick-lint-js finds bugs in JavaScript programs.\n--- src/quick-lint-js/simdjson.h\n@@ -16,6 +16,8 @@ string8_view get_raw_json(::simdjson::ondemand::value&);\n // if root[key] is not an object.\n bool get_object(::simdjson::simdjson_result<::simdjson::ondemand::value>& root,\n                 const char* key, ::simdjson::ondemand::object* out);\n+bool get_object(::simdjson::ondemand::object& root, const char* key,\n+                ::simdjson::ondemand::object* out);\n \n // Returns true on success.\n //\n@@ -43,6 +45,10 @@ bool get_string8(::simdjson::ondemand::object& root, const char* key1,\n                  const char* key2, const char* key3, string8_view* out);\n bool get_string8(::simdjson::simdjson_result<::simdjson::ondemand::value>& root,\n                  const char* key, string8_view* out);\n+\n+// TODO(strager): What do we do if the value is integral but is out of range of\n+// 'int'?\n+bool get_int(::simdjson::ondemand::object& root, const char* key, int* out);\n }\n \n #endif"
        ],
        "files_changed": [
            {
                "filename": "src/quick-lint-js/lsp/lsp-server.cpp",
                "status": "modified",
                "additions": 15,
                "deletions": 36,
                "changes": 51,
                "patch": "@@ -50,10 +50,6 @@ std::optional<string_json_token> maybe_get_string_token(\n     ::simdjson::ondemand::value& string);\n std::optional<string_json_token> maybe_get_string_token(\n     ::simdjson::simdjson_result<::simdjson::ondemand::value>&& string);\n-\n-// Returns std::nullopt on failure (e.g. missing key or not an integer).\n-std::optional<int> maybe_get_int(\n-    ::simdjson::simdjson_result<::simdjson::ondemand::value>&&);\n }\n \n lsp_overlay_configuration_filesystem::lsp_overlay_configuration_filesystem(\n@@ -591,29 +587,24 @@ void linting_lsp_server_handler::apply_document_changes(\n     ::simdjson::ondemand::object raw_range;\n     bool is_incremental = get_object(change, \"range\", &raw_range);\n     if (is_incremental) {\n-      auto start = raw_range[\"start\"];\n-      std::optional<int> start_line = maybe_get_int(start[\"line\"]);\n-      std::optional<int> start_character = maybe_get_int(start[\"character\"]);\n-      auto end = raw_range[\"end\"];\n-      std::optional<int> end_line = maybe_get_int(end[\"line\"]);\n-      std::optional<int> end_character = maybe_get_int(end[\"character\"]);\n-      if (!(start_line.has_value() && start_character.has_value() &&\n-            end_line.has_value() && end_character.has_value())) {\n+      lsp_range range;\n+\n+      ::simdjson::ondemand::object start;\n+      if (!(get_object(raw_range, \"start\", &start) &&\n+            get_int(start, \"line\", &range.start.line) &&\n+            get_int(start, \"character\", &range.start.character))) {\n         // Ignore invalid change.\n         continue;\n       }\n-      lsp_range range = {\n-          .start =\n-              {\n-                  .line = *start_line,\n-                  .character = *start_character,\n-              },\n-          .end =\n-              {\n-                  .line = *end_line,\n-                  .character = *end_character,\n-              },\n-      };\n+\n+      ::simdjson::ondemand::object end;\n+      if (!(get_object(raw_range, \"end\", &end) &&\n+            get_int(end, \"line\", &range.end.line) &&\n+            get_int(end, \"character\", &range.end.character))) {\n+        // Ignore invalid change.\n+        continue;\n+      }\n+\n       doc.replace_text(range, change_text);\n     } else {\n       doc.set_text(change_text);\n@@ -711,18 +702,6 @@ std::optional<string_json_token> maybe_get_string_token(\n   }\n   return maybe_get_string_token(s);\n }\n-\n-std::optional<int> maybe_get_int(\n-    ::simdjson::simdjson_result<::simdjson::ondemand::value>&& element) {\n-  std::int64_t int64;\n-  if (element.get(int64) != ::simdjson::error_code::SUCCESS) {\n-    return std::nullopt;\n-  }\n-  if (!in_range<int>(int64)) {\n-    QLJS_UNIMPLEMENTED();\n-  }\n-  return static_cast<int>(int64);\n-}\n }\n }\n "
            },
            {
                "filename": "src/quick-lint-js/simdjson.cpp",
                "status": "modified",
                "additions": 20,
                "deletions": 0,
                "changes": 20,
                "patch": "@@ -3,6 +3,7 @@\n \n #include <quick-lint-js/assert.h>\n #include <quick-lint-js/port/char8.h>\n+#include <quick-lint-js/port/in-range.h>\n #include <quick-lint-js/port/unreachable.h>\n #include <quick-lint-js/simdjson.h>\n #include <simdjson.h>\n@@ -32,6 +33,11 @@ bool get_object(::simdjson::ondemand::object& root, const char* key1,\n   return root[key1][key2].get(*out) == ::simdjson::SUCCESS;\n }\n \n+bool get_object(::simdjson::ondemand::object& root, const char* key,\n+                ::simdjson::ondemand::object* out) {\n+  return root[key].get(*out) == ::simdjson::SUCCESS;\n+}\n+\n bool get_object(::simdjson::simdjson_result<::simdjson::ondemand::value>& root,\n                 const char* key, ::simdjson::ondemand::object* out) {\n   return root[key].get(*out) == ::simdjson::SUCCESS;\n@@ -91,6 +97,20 @@ bool get_string8(::simdjson::simdjson_result<::simdjson::ondemand::value>& root,\n   *out = to_string8_view(sv);\n   return true;\n }\n+\n+bool get_int(::simdjson::ondemand::object& root, const char* key, int* out) {\n+  std::int64_t int64;\n+  if (root[key].get(int64) != ::simdjson::error_code::SUCCESS) {\n+    return false;\n+  }\n+  if (!in_range<int>(int64)) {\n+    // TODO(strager): What should we do here? Return false? Return something\n+    // else?\n+    QLJS_UNIMPLEMENTED();\n+  }\n+  *out = static_cast<int>(int64);\n+  return true;\n+}\n }\n \n // quick-lint-js finds bugs in JavaScript programs."
            },
            {
                "filename": "src/quick-lint-js/simdjson.h",
                "status": "modified",
                "additions": 6,
                "deletions": 0,
                "changes": 6,
                "patch": "@@ -16,6 +16,8 @@ string8_view get_raw_json(::simdjson::ondemand::value&);\n // if root[key] is not an object.\n bool get_object(::simdjson::simdjson_result<::simdjson::ondemand::value>& root,\n                 const char* key, ::simdjson::ondemand::object* out);\n+bool get_object(::simdjson::ondemand::object& root, const char* key,\n+                ::simdjson::ondemand::object* out);\n \n // Returns true on success.\n //\n@@ -43,6 +45,10 @@ bool get_string8(::simdjson::ondemand::object& root, const char* key1,\n                  const char* key2, const char* key3, string8_view* out);\n bool get_string8(::simdjson::simdjson_result<::simdjson::ondemand::value>& root,\n                  const char* key, string8_view* out);\n+\n+// TODO(strager): What do we do if the value is integral but is out of range of\n+// 'int'?\n+bool get_int(::simdjson::ondemand::object& root, const char* key, int* out);\n }\n \n #endif"
            }
        ],
        "lines_added": 41,
        "lines_removed": 36
    },
    "issues": [],
    "pull_requests": [],
    "build_info": {
        "old_build_script": [
            "apt-get update",
            "cmake -S /test_workspace/workspace/old -B /test_workspace/workspace/old/build -DCMAKE_BUILD_TYPE=Debug -DCMAKE_EXPORT_COMPILE_COMMANDS=ON -DBENCHMARK_ENABLE_ASSEMBLY_TESTS=ON -DBUILD_TESTING=ON -DBENCHMARK_ENABLE_GTEST_TESTS=ON -DBENCHMARK_USE_BUNDLED_GTEST=ON -DBENCHMARK_ENABLE_TESTING=ON",
            "cmake --build /test_workspace/workspace/old/build -- -j 1"
        ],
        "new_build_script": [
            "apt-get update",
            "cmake -S /test_workspace/workspace/new -B /test_workspace/workspace/new/build -DCMAKE_BUILD_TYPE=Debug -DCMAKE_EXPORT_COMPILE_COMMANDS=ON -DBENCHMARK_ENABLE_ASSEMBLY_TESTS=ON -DBUILD_TESTING=ON -DBENCHMARK_ENABLE_GTEST_TESTS=ON -DBENCHMARK_USE_BUNDLED_GTEST=ON -DBENCHMARK_ENABLE_TESTING=ON",
            "cmake --build /test_workspace/workspace/new/build -- -j 1"
        ],
        "old_test_script": [
            "cd /test_workspace/workspace/old/build",
            "ctest --output-on-failure"
        ],
        "new_test_script": [
            "cd /test_workspace/workspace/new/build",
            "ctest --output-on-failure"
        ],
        "build_system": "cmake"
    },
    "performance_analysis": {
        "is_significant": false,
        "p_value": 1.0,
        "is_pair_significant": false,
        "pair_p_value": 1.0,
        "is_binom_significant": false,
        "binom_p_value": 1.0,
        "is_wilcoxon_significant": false,
        "wilcoxon_p_value": 0.9999995215611467,
        "is_mannwhitney_significant": false,
        "mannwhitney_p_value": 0.11347164875224691,
        "relative_improvement": 0.0014285714285713982,
        "absolute_improvement_ms": 1.3333333333334085,
        "old_mean_ms": 933.3333333333334,
        "new_mean_ms": 931.9999999999999,
        "old_std_ms": 5.466722735905295,
        "new_std_ms": 5.508613944197442,
        "effect_size_cohens_d": 0.24296723828618264,
        "old_ci95_ms": [
            931.2920255157912,
            935.3746411508754
        ],
        "new_ci95_ms": [
            929.9430497482055,
            934.0569502517944
        ],
        "old_ci99_ms": [
            930.5822329300272,
            936.0844337366395
        ],
        "new_ci99_ms": [
            929.2278180592544,
            934.7721819407454
        ],
        "new_times_s": [
            0.93,
            0.92,
            0.93,
            0.93,
            0.93,
            0.94,
            0.93,
            0.93,
            0.93,
            0.93,
            0.93,
            0.93,
            0.93,
            0.93,
            0.93,
            0.93,
            0.93,
            0.93,
            0.93,
            0.93,
            0.94,
            0.94,
            0.94,
            0.93,
            0.94,
            0.95,
            0.93,
            0.93,
            0.93,
            0.93,
            0.93
        ],
        "old_times_s": [
            0.93,
            0.93,
            0.93,
            0.93,
            0.93,
            0.93,
            0.93,
            0.92,
            0.94,
            0.93,
            0.93,
            0.94,
            0.93,
            0.94,
            0.93,
            0.94,
            0.93,
            0.94,
            0.93,
            0.94,
            0.94,
            0.94,
            0.94,
            0.93,
            0.93,
            0.93,
            0.93,
            0.93,
            0.94,
            0.93,
            0.94
        ]
    },
    "tests": {
        "total_tests": 2,
        "significant_improvements": 0,
        "significant_improvements_tests": [],
        "significant_regressions": 0,
        "significant_regressions_tests": [],
        "significant_pair_improvements": 0,
        "significant_pair_improvements_tests": [],
        "significant_pair_regressions": 0,
        "significant_pair_regressions_tests": [],
        "significant_binom_improvements": 0,
        "significant_binom_improvements_tests": [],
        "significant_binom_regressions": 0,
        "significant_binom_regressions_tests": [],
        "significant_wilcoxon_improvements": 0,
        "significant_wilcoxon_improvements_tests": [],
        "significant_wilcoxon_regressions": 0,
        "significant_wilcoxon_regressions_tests": [],
        "significant_mannwhitney_improvements": 0,
        "significant_mannwhitney_improvements_tests": [],
        "significant_mannwhitney_regressions": 0,
        "significant_mannwhitney_regressions_tests": [],
        "tests": [
            {
                "test_name": "quick-lint-js-test",
                "is_significant": false,
                "p_value": 1.0,
                "is_pair_significant": false,
                "pair_p_value": 1.0,
                "is_binom_significant": false,
                "binom_p_value": 1.0,
                "is_wilcoxon_significant": false,
                "wilcoxon_p_value": 0.9999996633559656,
                "is_mannwhitney_significant": false,
                "mannwhitney_p_value": 0.9273234134227388,
                "relative_improvement": -0.0021953896816686446,
                "absolute_improvement_ms": -1.3793103448277444,
                "old_mean_ms": 628.2758620689655,
                "new_mean_ms": 629.6551724137933,
                "old_std_ms": 3.844258722192451,
                "new_std_ms": 3.2544020963805513,
                "effect_size_cohens_d": -0.38727672379943023,
                "old_ci95_ms": [
                    626.8135842551063,
                    629.7381398828246
                ],
                "new_ci95_ms": [
                    628.4172640608924,
                    630.8930807666941
                ],
                "old_ci99_ms": [
                    626.3032769807543,
                    630.2484471571767
                ],
                "new_ci99_ms": [
                    627.9852574808299,
                    631.3250873467565
                ],
                "new_times": [
                    0.63,
                    0.63,
                    0.63,
                    0.63,
                    0.63,
                    0.63,
                    0.62,
                    0.63,
                    0.63,
                    0.63,
                    0.63,
                    0.63,
                    0.63,
                    0.63,
                    0.63,
                    0.63,
                    0.63,
                    0.63,
                    0.63,
                    0.63,
                    0.63,
                    0.63,
                    0.63,
                    0.64,
                    0.63,
                    0.63,
                    0.63,
                    0.63,
                    0.62
                ],
                "old_times": [
                    0.63,
                    0.63,
                    0.63,
                    0.63,
                    0.62,
                    0.62,
                    0.63,
                    0.63,
                    0.63,
                    0.63,
                    0.63,
                    0.63,
                    0.63,
                    0.63,
                    0.62,
                    0.63,
                    0.63,
                    0.63,
                    0.63,
                    0.63,
                    0.63,
                    0.62,
                    0.63,
                    0.62,
                    0.63,
                    0.63,
                    0.63,
                    0.63,
                    0.63
                ]
            },
            {
                "test_name": "quick-lint-js-test-cli",
                "is_significant": false,
                "p_value": 1.0,
                "is_pair_significant": false,
                "pair_p_value": 1.0,
                "is_binom_significant": false,
                "binom_p_value": 1.0,
                "is_wilcoxon_significant": false,
                "wilcoxon_p_value": 0.9999999638108507,
                "is_mannwhitney_significant": false,
                "mannwhitney_p_value": 1.0,
                "relative_improvement": 0.0,
                "absolute_improvement_ms": 0.0,
                "old_mean_ms": 100.00000000000003,
                "new_mean_ms": 100.00000000000003,
                "old_std_ms": 2.824686288200359e-14,
                "new_std_ms": 2.824686288200359e-14,
                "effect_size_cohens_d": 0.0,
                "old_ci95_ms": [
                    100.00000000000001,
                    100.00000000000004
                ],
                "new_ci95_ms": [
                    100.00000000000001,
                    100.00000000000004
                ],
                "old_ci99_ms": [
                    100.00000000000001,
                    100.00000000000004
                ],
                "new_ci99_ms": [
                    100.00000000000001,
                    100.00000000000004
                ],
                "new_times": [
                    0.1,
                    0.1,
                    0.1,
                    0.1,
                    0.1,
                    0.1,
                    0.1,
                    0.1,
                    0.1,
                    0.1,
                    0.1,
                    0.1,
                    0.1,
                    0.1,
                    0.1,
                    0.1,
                    0.1,
                    0.1,
                    0.1,
                    0.1,
                    0.1,
                    0.1,
                    0.1,
                    0.1,
                    0.1,
                    0.1,
                    0.1,
                    0.1,
                    0.1
                ],
                "old_times": [
                    0.1,
                    0.1,
                    0.1,
                    0.1,
                    0.1,
                    0.1,
                    0.1,
                    0.1,
                    0.1,
                    0.1,
                    0.1,
                    0.1,
                    0.1,
                    0.1,
                    0.1,
                    0.1,
                    0.1,
                    0.1,
                    0.1,
                    0.1,
                    0.1,
                    0.1,
                    0.1,
                    0.1,
                    0.1,
                    0.1,
                    0.1,
                    0.1,
                    0.1
                ]
            }
        ]
    },
    "logs": {
        "full_log_path": "/logs/full.log",
        "config_log_path": "/logs/config.log",
        "build_log_path": "/logs/build.log",
        "test_log_path": "/logs/test.log",
        "build_success": true,
        "test_success": true
    },
    "raw_timing_data": {
        "warmup_runs": 1,
        "measurement_runs": 30,
        "min_exec_time_improvement": 0.05,
        "min_p_value": 0.05
    }
}