{
    "metadata": {
        "collection_date": "2026-01-14T18:38:01.893379",
        "repository": "https://github.com/quick-lint/quick-lint-js",
        "repository_name": "quick-lint/quick-lint-js"
    },
    "commit_info": {
        "old_sha": "9c8c5884a1925212ed8f4ef1d80421057b26b483",
        "new_sha": "1c8371c844ef6d4874580043decc6d3c2470cb16",
        "commit_message": [
            "Slightly optimize output_stream::append_copy\n\nappend_copy needs to do some math to determine the pointer to write data\nto. Optimize this process by making output_stream::cursor_ a pointer\ninstead of an index.\n\nI didn't measure performance. I did measure instruction count though.\nWith Apple Clang 13.0.0 targeting macOS AArch64, an inlined call to\nappend_copy takes 4 fewer instructions with this commit. (It's difficult\nto succinctly show the differences in the ~50 instructions.)"
        ],
        "commit_date": "2021-12-26T08:35:37+00:00",
        "patch": [
            "--- src/output-stream.cpp\n@@ -45,19 +45,20 @@ void output_stream::append_copy(char8 data) {\n QLJS_WARNING_POP\n \n void output_stream::flush() {\n-  this->flush_impl(string8_view(this->buffer_.get(),\n-                                narrow_cast<std::size_t>(this->cursor_)));\n-  this->cursor_ = 0;\n+  this->flush_impl(string8_view(\n+      this->buffer_.get(),\n+      narrow_cast<std::size_t>(this->cursor_ - this->buffer_.get())));\n+  this->cursor_ = this->buffer_.get();\n }\n \n char8* output_stream::reserve(int byte_count) {\n   if (byte_count > this->buffer_size_) {\n     return nullptr;\n   }\n-  if (this->cursor_ + byte_count >= this->buffer_size_) {\n+  if (this->buffer_end_ - this->cursor_ < byte_count) {\n     this->flush();\n   }\n-  char8* out = this->buffer_.get() + this->cursor_;\n+  char8* out = this->cursor_;\n   this->cursor_ += byte_count;\n   return out;\n }\n--- src/quick-lint-js/output-stream.h\n@@ -68,7 +68,8 @@ class output_stream {\n \n   std::unique_ptr<char8[]> buffer_;\n   int buffer_size_;\n-  int cursor_ = 0;\n+  char8* cursor_ = this->buffer_.get();\n+  char8* buffer_end_ = this->buffer_.get() + this->buffer_size_;\n };\n \n #if defined(__EMSCRIPTEN__)"
        ],
        "files_changed": [
            {
                "filename": "src/output-stream.cpp",
                "status": "modified",
                "additions": 6,
                "deletions": 5,
                "changes": 11,
                "patch": "@@ -45,19 +45,20 @@ void output_stream::append_copy(char8 data) {\n QLJS_WARNING_POP\n \n void output_stream::flush() {\n-  this->flush_impl(string8_view(this->buffer_.get(),\n-                                narrow_cast<std::size_t>(this->cursor_)));\n-  this->cursor_ = 0;\n+  this->flush_impl(string8_view(\n+      this->buffer_.get(),\n+      narrow_cast<std::size_t>(this->cursor_ - this->buffer_.get())));\n+  this->cursor_ = this->buffer_.get();\n }\n \n char8* output_stream::reserve(int byte_count) {\n   if (byte_count > this->buffer_size_) {\n     return nullptr;\n   }\n-  if (this->cursor_ + byte_count >= this->buffer_size_) {\n+  if (this->buffer_end_ - this->cursor_ < byte_count) {\n     this->flush();\n   }\n-  char8* out = this->buffer_.get() + this->cursor_;\n+  char8* out = this->cursor_;\n   this->cursor_ += byte_count;\n   return out;\n }"
            },
            {
                "filename": "src/quick-lint-js/output-stream.h",
                "status": "modified",
                "additions": 2,
                "deletions": 1,
                "changes": 3,
                "patch": "@@ -68,7 +68,8 @@ class output_stream {\n \n   std::unique_ptr<char8[]> buffer_;\n   int buffer_size_;\n-  int cursor_ = 0;\n+  char8* cursor_ = this->buffer_.get();\n+  char8* buffer_end_ = this->buffer_.get() + this->buffer_size_;\n };\n \n #if defined(__EMSCRIPTEN__)"
            }
        ],
        "lines_added": 8,
        "lines_removed": 6
    },
    "issues": [],
    "pull_requests": [],
    "build_info": {
        "old_build_script": [
            "apt-get update",
            "cmake -S /test_workspace/workspace/old -B /test_workspace/workspace/old/build -DCMAKE_BUILD_TYPE=Debug -DCMAKE_EXPORT_COMPILE_COMMANDS=ON -DBENCHMARK_ENABLE_TESTING=ON -DBUILD_TESTING=ON -DBENCHMARK_ENABLE_GTEST_TESTS=ON -DBENCHMARK_ENABLE_ASSEMBLY_TESTS=ON",
            "cmake --build /test_workspace/workspace/old/build -- -j 1"
        ],
        "new_build_script": [
            "apt-get update",
            "cmake -S /test_workspace/workspace/new -B /test_workspace/workspace/new/build -DCMAKE_BUILD_TYPE=Debug -DCMAKE_EXPORT_COMPILE_COMMANDS=ON -DBENCHMARK_ENABLE_TESTING=ON -DBUILD_TESTING=ON -DBENCHMARK_ENABLE_GTEST_TESTS=ON -DBENCHMARK_ENABLE_ASSEMBLY_TESTS=ON",
            "cmake --build /test_workspace/workspace/new/build -- -j 1"
        ],
        "old_test_script": [
            "cd /test_workspace/workspace/old/build",
            "ctest --output-on-failure"
        ],
        "new_test_script": [
            "cd /test_workspace/workspace/new/build",
            "ctest --output-on-failure"
        ],
        "build_system": "cmake"
    },
    "performance_analysis": {
        "is_significant": false,
        "p_value": 1.0,
        "is_pair_significant": false,
        "pair_p_value": 1.0,
        "is_binom_significant": false,
        "binom_p_value": 1.0,
        "is_wilcoxon_significant": false,
        "wilcoxon_p_value": 0.9999992901334691,
        "is_mannwhitney_significant": false,
        "mannwhitney_p_value": 0.9785217451116021,
        "relative_improvement": -0.0058939096267190474,
        "absolute_improvement_ms": -6.000000000000005,
        "old_mean_ms": 1018.0,
        "new_mean_ms": 1024.0,
        "old_std_ms": 9.965457582448806,
        "new_std_ms": 12.484473115254707,
        "effect_size_cohens_d": -0.5311893844592173,
        "old_ci95_ms": [
            1014.2788369831111,
            1021.721163016889
        ],
        "new_ci95_ms": [
            1019.3382211245726,
            1028.6617788754274
        ],
        "old_ci99_ms": [
            1012.9849341737897,
            1023.0150658262103
        ],
        "new_ci99_ms": [
            1017.7172524231277,
            1030.2827475768722
        ],
        "new_times_s": [
            1.04,
            1.03,
            1.02,
            1.04,
            1.03,
            1.01,
            1.03,
            1.02,
            1.03,
            1.01,
            1.03,
            1.02,
            1.02,
            1.01,
            1.02,
            1.02,
            1.03,
            1.01,
            1.02,
            1.01,
            1.02,
            1.07,
            1.01,
            1.03,
            1.03,
            1.01,
            1.03,
            1.02,
            1.03,
            1.04,
            1.02
        ],
        "old_times_s": [
            1.03,
            1.0,
            1.01,
            1.01,
            1.02,
            1.01,
            1.03,
            1.01,
            1.02,
            1.02,
            1.03,
            1.04,
            1.01,
            1.02,
            1.02,
            1.01,
            1.02,
            1.03,
            1.01,
            1.04,
            1.01,
            1.01,
            1.01,
            1.03,
            1.02,
            1.02,
            1.03,
            1.02,
            1.01,
            1.01,
            1.01
        ]
    },
    "tests": {
        "total_tests": 2,
        "significant_improvements": 0,
        "significant_improvements_tests": [],
        "significant_regressions": 0,
        "significant_regressions_tests": [],
        "significant_pair_improvements": 0,
        "significant_pair_improvements_tests": [],
        "significant_pair_regressions": 0,
        "significant_pair_regressions_tests": [],
        "significant_binom_improvements": 0,
        "significant_binom_improvements_tests": [],
        "significant_binom_regressions": 0,
        "significant_binom_regressions_tests": [],
        "significant_wilcoxon_improvements": 0,
        "significant_wilcoxon_improvements_tests": [],
        "significant_wilcoxon_regressions": 0,
        "significant_wilcoxon_regressions_tests": [],
        "significant_mannwhitney_improvements": 0,
        "significant_mannwhitney_improvements_tests": [],
        "significant_mannwhitney_regressions": 0,
        "significant_mannwhitney_regressions_tests": [],
        "tests": [
            {
                "test_name": "quick-lint-js-test",
                "is_significant": false,
                "p_value": 1.0,
                "is_pair_significant": false,
                "pair_p_value": 0.9999999999999991,
                "is_binom_significant": false,
                "binom_p_value": 1.0,
                "is_wilcoxon_significant": false,
                "wilcoxon_p_value": 0.9999995961052155,
                "is_mannwhitney_significant": false,
                "mannwhitney_p_value": 0.9232913507916386,
                "relative_improvement": -0.0053937432578210045,
                "absolute_improvement_ms": -1.7241379310344307,
                "old_mean_ms": 319.65517241379314,
                "new_mean_ms": 321.37931034482756,
                "old_std_ms": 4.211174438061582,
                "new_std_ms": 4.411136823860462,
                "effect_size_cohens_d": -0.39981726814942836,
                "old_ci95_ms": [
                    318.0533273258132,
                    321.2570175017731
                ],
                "new_ci95_ms": [
                    319.70140363314056,
                    323.0572170565146
                ],
                "old_ci99_ms": [
                    317.49431371497,
                    321.8160311126163
                ],
                "new_ci99_ms": [
                    319.11584595556195,
                    323.6427747340932
                ],
                "new_times": [
                    0.32,
                    0.32,
                    0.33,
                    0.32,
                    0.32,
                    0.32,
                    0.32,
                    0.32,
                    0.32,
                    0.32,
                    0.32,
                    0.32,
                    0.32,
                    0.32,
                    0.32,
                    0.32,
                    0.32,
                    0.32,
                    0.32,
                    0.34,
                    0.32,
                    0.33,
                    0.32,
                    0.32,
                    0.32,
                    0.32,
                    0.32,
                    0.32,
                    0.32
                ],
                "old_times": [
                    0.31,
                    0.31,
                    0.32,
                    0.32,
                    0.31,
                    0.32,
                    0.32,
                    0.32,
                    0.32,
                    0.32,
                    0.32,
                    0.32,
                    0.32,
                    0.32,
                    0.32,
                    0.33,
                    0.32,
                    0.32,
                    0.32,
                    0.32,
                    0.32,
                    0.32,
                    0.32,
                    0.32,
                    0.32,
                    0.32,
                    0.32,
                    0.33,
                    0.32
                ]
            },
            {
                "test_name": "quick-lint-js-test-cli",
                "is_significant": false,
                "p_value": 0.9999998254123771,
                "is_pair_significant": false,
                "pair_p_value": 0.9999994182207194,
                "is_binom_significant": false,
                "binom_p_value": 0.9999999441206455,
                "is_wilcoxon_significant": false,
                "wilcoxon_p_value": 0.9999481246792291,
                "is_mannwhitney_significant": false,
                "mannwhitney_p_value": 0.7787565262098961,
                "relative_improvement": -0.007575757575757582,
                "absolute_improvement_ms": -0.6896551724137889,
                "old_mean_ms": 91.03448275862068,
                "new_mean_ms": 91.72413793103446,
                "old_std_ms": 3.0993404669460367,
                "new_std_ms": 3.8442587221924502,
                "effect_size_cohens_d": -0.19751151265555827,
                "old_ci95_ms": [
                    89.85555669512561,
                    92.21340882211575
                ],
                "new_ci95_ms": [
                    90.26186011717535,
                    93.18641574489358
                ],
                "old_ci99_ms": [
                    89.4441338174598,
                    92.62483169978155
                ],
                "new_ci99_ms": [
                    89.7515528428233,
                    93.69672301924564
                ],
                "new_times": [
                    0.09,
                    0.09,
                    0.1,
                    0.09,
                    0.09,
                    0.09,
                    0.09,
                    0.09,
                    0.1,
                    0.09,
                    0.09,
                    0.09,
                    0.1,
                    0.09,
                    0.09,
                    0.09,
                    0.09,
                    0.09,
                    0.09,
                    0.1,
                    0.09,
                    0.09,
                    0.09,
                    0.09,
                    0.09,
                    0.09,
                    0.1,
                    0.09,
                    0.09
                ],
                "old_times": [
                    0.09,
                    0.1,
                    0.1,
                    0.09,
                    0.09,
                    0.09,
                    0.09,
                    0.09,
                    0.09,
                    0.09,
                    0.09,
                    0.09,
                    0.09,
                    0.09,
                    0.09,
                    0.1,
                    0.09,
                    0.09,
                    0.09,
                    0.09,
                    0.09,
                    0.09,
                    0.09,
                    0.09,
                    0.09,
                    0.09,
                    0.09,
                    0.09,
                    0.09
                ]
            }
        ]
    },
    "logs": {
        "full_log_path": "/logs/full.log",
        "config_log_path": "/logs/config.log",
        "build_log_path": "/logs/build.log",
        "test_log_path": "/logs/test.log",
        "build_success": true,
        "test_success": true
    },
    "raw_timing_data": {
        "warmup_runs": 1,
        "measurement_runs": 30,
        "min_exec_time_improvement": 0.05,
        "min_p_value": 0.05
    }
}